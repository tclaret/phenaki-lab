import{f as fe,a as ae,c as Vt}from"../chunks/BPwTt6vP.js";import"../chunks/D4mQYNIE.js";import{G as Jt,v as pe,w as Kt,g as n,av as Zt,I as Qt,J as en,K as Ct,L as $t,M as ct,D as et,a3 as tn,aq as nn,aa as rn,x as We,C as yt,B as Gt,F as sn,T as te,a1 as Dt,ao as Ut,aI as an,aJ as on,y as zt,A as ln,aK as cn,aL as fn,aM as ft,ak as un,aN as dn,aO as hn,an as pn,z as vn,aP as gn,P as mn,aQ as wn,aR as yn,aS as _n,aT as xn,aU as bn,aG as Mn,b as xe,O as kn,aV as Sn,p as Ve,j as Je,s as L,k as z,l as j,aW as Ce,aX as Pt,i as _t,U as P,ab as nt,t as $e,aY as B}from"../chunks/zw_chER5.js";import{e as ce,s as Ee}from"../chunks/CfBDm7bY.js";import{i as rt}from"../chunks/CtND9pXO.js";import{w as oe,o as Et,a as Pn,g as ut}from"../chunks/BQFw1Q7y.js";import{i as Le,s as It,a as K,b as Lt}from"../chunks/BuQu0Dv8.js";function En(t,l,s){for(var d=[],p=l.length,a=0;a<p;a++)dn(l[a].e,d,!0);hn(d,()=>{var o=d.length===0&&s!==null;if(o){var u=s,b=u.parentNode;pn(b),b.append(u),t.items.clear(),we(t,l[0].prev,l[p-1].next)}for(var v=0;v<p;v++){var i=l[v];o||(t.items.delete(i.k),we(t,i.prev,i.next)),vn(i.e,!o)}t.first===l[0]&&(t.first=l[0].prev)})}function In(t,l,s,d,p,a=null){var o=t,u=new Map,b=null;pe&&Kt();var v=null,i=Zt(()=>{var r=s();return an(r)?r:r==null?[]:Ut(r)}),c,f=!0;function g(){Tn(h,c,o,l,d),v!==null&&(c.length===0?(v.fragment?(o.before(v.fragment),v.fragment=null):zt(v.effect),y.first=v.effect):ln(v.effect,()=>{v=null}))}var y=Jt(()=>{c=n(i);var r=c.length;let e=!1;if(pe){var w=Qt(o)===en;w!==(r===0)&&(o=Ct(),$t(o),ct(!1),e=!0)}for(var x=new Set,C=We,I=null,$=sn(),T=0;T<r;T+=1){pe&&et.nodeType===tn&&et.data===nn&&(o=et,e=!0,ct(!1));var D=c[T],ne=d(D,T),G=f?null:u.get(ne);G?(rn(G.v,D),G.i=T,$&&C.skipped_effects.delete(G.e)):(G=Cn(f?o:null,I,D,ne,T,p,l,s),f&&(G.o=!0,I===null?b=G:I.next=G,I=G),u.set(ne,G)),x.add(ne)}if(r===0&&a&&!v)if(f)v={fragment:null,effect:yt(()=>a(o))};else{var se=document.createDocumentFragment(),F=Gt();se.append(F),v={fragment:se,effect:yt(()=>a(F))}}if(pe&&r>0&&$t(Ct()),!f)if($){for(const[E,N]of u)x.has(E)||C.skipped_effects.add(N.e);C.oncommit(g),C.ondiscard(()=>{})}else g();e&&ct(!0),n(i)}),h={effect:y,items:u,first:b};f=!1,pe&&(o=et)}function Tn(t,l,s,d,p){var a=l.length,o=t.items,u=t.first,b,v=null,i=[],c=[],f,g,y,h;for(h=0;h<a;h+=1){if(f=l[h],g=p(f,h),y=o.get(g),t.first??=y,!y.o){y.o=!0;var r=v?v.next:u;we(t,v,y),we(t,y,r),dt(y,r,s),v=y,i=[],c=[],u=v.next;continue}if((y.e.f&ft)!==0&&zt(y.e),y!==u){if(b!==void 0&&b.has(y)){if(i.length<c.length){var e=c[0],w;v=e.prev;var x=i[0],C=i[i.length-1];for(w=0;w<i.length;w+=1)dt(i[w],e,s);for(w=0;w<c.length;w+=1)b.delete(c[w]);we(t,x.prev,C.next),we(t,v,x),we(t,C,e),u=e,v=C,h-=1,i=[],c=[]}else b.delete(y),dt(y,u,s),we(t,y.prev,y.next),we(t,y,v===null?t.first:v.next),we(t,v,y),v=y;continue}for(i=[],c=[];u!==null&&u.k!==g;)(u.e.f&ft)===0&&(b??=new Set).add(u),c.push(u),u=u.next;if(u===null)continue;y=u}i.push(y),v=y,u=y.next}let I=o.size>a;if(u!==null||b!==void 0){for(var $=b===void 0?[]:Ut(b);u!==null;)(u.e.f&ft)===0&&$.push(u),u=u.next;var T=$.length;if(I=o.size-T>a,T>0){var D=null;En(t,$,D)}}if(I)for(const ne of o.values())ne.o||(we(t,v,ne),v=ne);t.effect.last=v&&v.e}function Cn(t,l,s,d,p,a,o,u){var b=(o&cn)!==0,v=(o&fn)===0,i=b?v?te(s,!1,!1):Dt(s):s,c=(o&on)===0?p:Dt(p),f={i:c,v:i,k:d,a:null,e:null,o:!1,prev:l,next:null};try{if(t===null){var g=document.createDocumentFragment();g.append(t=Gt())}return f.e=yt(()=>a(t,i,c,u)),l!==null&&(l.next=f),f}finally{}}function dt(t,l,s){for(var d=t.next?t.next.e.nodes_start:s,p=l?l.e.nodes_start:s,a=t.e.nodes_start;a!==null&&a!==d;){var o=un(a);p.before(a),a=o}}function we(t,l,s){l===null?(t.first=s,t.effect.first=s&&s.e):(l.e.next&&(l.e.next.prev=null),l.next=s,l.e.next=s&&s.e),s!==null&&(s.e.prev&&(s.e.prev.next=null),s.prev=l,s.e.prev=l&&l.e)}function jt(t){var l,s,d="";if(typeof t=="string"||typeof t=="number")d+=t;else if(typeof t=="object")if(Array.isArray(t)){var p=t.length;for(l=0;l<p;l++)t[l]&&(s=jt(t[l]))&&(d&&(d+=" "),d+=s)}else for(s in t)t[s]&&(d&&(d+=" "),d+=s);return d}function $n(){for(var t,l,s=0,d="",p=arguments.length;s<p;s++)(t=arguments[s])&&(l=jt(t))&&(d&&(d+=" "),d+=l);return d}function At(t){return typeof t=="object"?$n(t):t??""}function Dn(t,l,s){var d=t==null?"":""+t;return d=d?d+" "+l:l,d===""?null:d}function Ln(t,l){return t==null?null:String(t)}function ht(t,l,s,d,p,a){var o=t.__className;if(pe||o!==s||o===void 0){var u=Dn(s,d);(!pe||u!==t.getAttribute("class"))&&(u==null?t.removeAttribute("class"):t.className=u),t.__className=s}return a}function An(t,l,s,d){var p=t.__style;if(pe||p!==l){var a=Ln(l);(!pe||a!==t.getAttribute("style"))&&(a==null?t.removeAttribute("style"):t.style.cssText=a),t.__style=l}return d}const On=Symbol("is custom element"),Rn=Symbol("is html");function pt(t){if(pe){var l=!1,s=()=>{if(!l){if(l=!0,t.hasAttribute("value")){var d=t.value;xt(t,"value",null),t.value=d}if(t.hasAttribute("checked")){var p=t.checked;xt(t,"checked",null),t.checked=p}}};t.__on_r=s,mn(s),wn()}}function Fn(t,l){var s=qt(t);s.checked!==(s.checked=l??void 0)&&(t.checked=l)}function xt(t,l,s,d){var p=qt(t);pe&&(p[l]=t.getAttribute(l),l==="src"||l==="srcset"||l==="href"&&t.nodeName==="LINK")||p[l]!==(p[l]=s)&&(l==="loading"&&(t[yn]=s),s==null?t.removeAttribute(l):typeof s!="string"&&Wn(t).includes(l)?t[l]=s:t.setAttribute(l,s))}function qt(t){return t.__attributes??={[On]:t.nodeName.includes("-"),[Rn]:t.namespaceURI===gn}}var Ot=new Map;function Wn(t){var l=t.getAttribute("is")||t.nodeName,s=Ot.get(l);if(s)return s;Ot.set(l,s=[]);for(var d,p=t,a=Element.prototype;a!==p;){d=xn(p);for(var o in d)d[o].set&&s.push(o);p=_n(p)}return s}function Rt(t,l,s=l){var d=new WeakSet;bn(t,"input",async p=>{var a=p?t.defaultValue:t.value;if(a=vt(t)?gt(a):a,s(a),We!==null&&d.add(We),await Mn(),a!==(a=l())){var o=t.selectionStart,u=t.selectionEnd,b=t.value.length;if(t.value=a??"",u!==null){var v=t.value.length;o===u&&u===b&&v>b?(t.selectionStart=v,t.selectionEnd=v):(t.selectionStart=o,t.selectionEnd=Math.min(u,v))}}}),(pe&&t.defaultValue!==t.value||xe(l)==null&&t.value)&&(s(vt(t)?gt(t.value):t.value),We!==null&&d.add(We)),kn(()=>{var p=l();if(t===document.activeElement){var a=Sn??We;if(d.has(a))return}vt(t)&&p===gt(t.value)||t.type==="date"&&!p&&!t.value||p!==t.value&&(t.value=p??"")})}function vt(t){var l=t.type;return l==="number"||l==="range"}function gt(t){return t===""?null:+t}const Tt=oe(null),Ne=oe(null),Ge=oe(!1),Te=oe(360),bt=oe(1),Mt=oe(null),Ft=oe(0),mt=oe(1),Ht=oe([]),kt=oe(!1),Xe=oe(!1),Be=oe({active:!1,progress:0,startTime:0}),St=oe(null),Nn=oe(!1),Gn=oe(10);var Un=fe('<label>Choose image: <input type="file" accept="image/*"/></label>');function zn(t,l){Ve(l,!1);function s(a){const o=a.target.files[0];if(!o)return;const u=URL.createObjectURL(o);Tt.set(u),Ne.set(u),Ge.set(!0)}rt();var d=Un(),p=L(z(d));j(d),ce("change",p,s),ae(t,d),Je()}var jn=fe('<div class="preview svelte-1th6cal"><img alt="Selected disc preview" class="svelte-1th6cal"/></div>f',1);function qn(t,l){Ve(l,!1);const s=()=>K(Tt,"$previewUrl",d),[d,p]=It(),a=te();Ce(()=>s(),()=>{P(a,s())}),Pt();var o=Vt(),u=_t(o);{var b=v=>{var i=jn(),c=_t(i),f=z(c);j(c),nt(),$e(()=>xt(f,"src",n(a))),ae(v,i)};Le(u,v=>{n(a)&&v(b)})}ae(t,o),Je(),p()}var Hn=fe('<div class="speed-hud svelte-byh4af"> </div>'),Yn=fe('<div class="canvas-wrapper svelte-byh4af"><canvas class="svelte-byh4af"></canvas> <!></div>');function Xn(t,l){Ve(l,!1);const s=()=>K(Ne,"$imageUrl",g),d=()=>K(Te,"$rotationSpeed",g),p=()=>K(Ge,"$isPlaying",g),a=()=>K(Be,"$detectionAnimation",g),o=()=>K(Xe,"$editMode",g),u=()=>K(bt,"$rotationDirection",g),b=()=>K(kt,"$overlayVisible",g),v=()=>K(Mt,"$detectedCircle",g),i=()=>K(Ht,"$detectedPositions",g),c=()=>K(Nn,"$flickerEnabled",g),f=()=>K(Gn,"$flickerFrequency",g),[g,y]=It();let h=te(),r=te(),e,w=0,x=1;const C=1,I=4;let $=0,T=0;const D=new Map;let ne=1,G=0,se=0,F=te(),E=te(0),N=0,Z=1,M=te(!1),Q,ie=0,ue=0,ve=0,A=te(null),ye=te(!1),be;function st(_){P(ye,!1),P(A,new Image),B(A,n(A).crossOrigin="anonymous"),B(A,n(A).onload=()=>{P(ye,!0),Ae(),de()}),B(A,n(A).onerror=S=>{console.error("Erreur chargement:",_,S),P(ye,!1)}),B(A,n(A).src=_)}function Ae(){if(!n(r)||!n(h))return;const _=n(h).getBoundingClientRect(),S=window.devicePixelRatio||1;if(n(A)&&n(A).width&&n(A).height){const R=n(A).width,q=n(A).height,H=Math.min(1400,Math.max(150,Math.round(_.width*Math.sqrt(R*R+q*q)/R)));B(h,n(h).style.height=H+"px");const U=n(h).getBoundingClientRect();B(r,n(r).style.width=U.width+"px"),B(r,n(r).style.height=U.height+"px"),B(r,n(r).width=Math.round(U.width*S)),B(r,n(r).height=Math.round(U.height*S))}else B(r,n(r).style.width=_.width+"px"),B(r,n(r).style.height=_.height+"px"),B(r,n(r).width=Math.round(_.width*S)),B(r,n(r).height=Math.round(_.height*S));e&&e.setTransform(S,0,0,S,0,0),de()}Et(()=>(n(r)&&(St.set(n(r)),e=n(r).getContext("2d"),n(h)&&B(h,n(h).style.touchAction="none"),n(h)&&n(h).addEventListener("wheel",Ke,{passive:!1}),Ae(),be=new ResizeObserver(()=>Ae()),n(h)&&be.observe(n(h)),n(h)&&(n(h).addEventListener("pointerdown",Ue),n(h).addEventListener("pointermove",De),n(h).addEventListener("pointerup",Oe),n(h).addEventListener("pointerleave",ze))),()=>{be&&be.disconnect()}));function Ue(_){if(!n(h))return;n(h).setPointerCapture(_.pointerId),D.set(_.pointerId,{x:_.clientX,y:_.clientY});const S=Date.now(),R=_.clientX-ue,q=_.clientY-ve,H=Math.sqrt(R*R+q*q);if(S-ie<300&&H<50){Ge.update(U=>!U),D.clear(),ie=0;return}if(ie=S,ue=_.clientX,ve=_.clientY,D.size===1&&(G=_.clientX,se=_.clientY,N=_.clientY,Z=d()||1),D.size===2){const U=Array.from(D.values());ne=x,De.pinchStartDist=Math.hypot(U[0].x-U[1].x,U[0].y-U[1].y)}}function De(_){if(n(h)){if(D.has(_.pointerId)&&D.set(_.pointerId,{x:_.clientX,y:_.clientY}),D.size===2){const S=Array.from(D.values()),R=S[0],q=S[1],H=Math.hypot(R.x-q.x,R.y-q.y),U=De.pinchStartDist||H,Me=H/U;let ke=Math.max(C,Math.min(I,ne*Me));const O={x:(R.x+q.x)/2,y:(R.y+q.y)/2},V=n(r).clientWidth,Y=n(r).clientHeight,X=n(h).getBoundingClientRect(),ee=O.x-(X.left+V/2)-$,le=O.y-(X.top+Y/2)-T,_e=x,he=ke;$=$-(he/_e-1)*ee,T=T-(he/_e-1)*le,x=ke,P(M,!0),clearTimeout(Q);return}if(D.size===1)if(D.values().next().value,x>1){const S=_.clientX-G,R=_.clientY-se;$+=S,T+=R,G=_.clientX,se=_.clientY,de();return}else{const S=N-_.clientY,q=Math.round(S*8),H=Math.max(10,Math.min(1e4,Math.round(Z+q)));Te.set(H),P(M,!0),clearTimeout(Q)}}}function Oe(_){if(n(h)){try{n(h).releasePointerCapture(_.pointerId)}catch{}clearTimeout(Q),P(M,!0),Q=setTimeout(()=>{P(M,!1)},4e3),D.delete(_.pointerId),D.size===0&&(clearTimeout(Q),P(M,!1))}}function ze(){clearTimeout(Q),P(M,!0),Q=setTimeout(()=>{P(M,!1)},4e3)}function Ke(_){if(!n(h)||!_.ctrlKey&&!_.metaKey)return;_.preventDefault();const R=1+(-_.deltaY>0?.1:-.1),q=Math.max(C,Math.min(I,x*R)),H=n(h).getBoundingClientRect(),U=_.clientX-(H.left+n(r).clientWidth/2)-$,Me=_.clientY-(H.top+n(r).clientHeight/2)-T;$=$-(q/x-1)*U,T=T-(q/x-1)*Me,x=q,de()}Pn(()=>{n(F)&&cancelAnimationFrame(n(F)),be&&be.disconnect(),Q&&clearTimeout(Q),n(h)&&(n(h).removeEventListener("pointerdown",Ue),n(h).removeEventListener("pointermove",De),n(h).removeEventListener("pointerup",Oe),n(h).removeEventListener("pointerleave",ze),n(h)&&n(h).removeEventListener("wheel",Ke)),St.set(null)});function Re(_){const S=p()||a().active||o();if(!S||!n(ye)){P(E,0),!S&&n(F)&&(cancelAnimationFrame(n(F)),P(F,null));return}n(E)||P(E,_);const R=_-n(E);if(P(E,_),p()&&!o()){const q=d()||0;w+=q*(u()||1)*(R/1e3)}de(),P(F,requestAnimationFrame(Re))}function de(){if(!n(ye)||!e||!n(A)||!n(r))return;const _=n(r).clientWidth,S=n(r).clientHeight;e.clearRect(0,0,_,S),e.save();const R=n(A).width/n(A).height,q=_/S;let H,U;R>q?(H=_,U=_/R):(U=S,H=S*R);const Me=H*x,ke=U*x;if(e.translate(_/2+$,S/2+T),e.rotate(w*Math.PI/180),e.drawImage(n(A),-Me/2,-ke/2,Me,ke),b()&&v())try{const O=v(),V=H*x/n(A).width,Y=(O.x-n(A).width/2)*V,X=(O.y-n(A).height/2)*V,ee=O.r*V;e.beginPath(),e.lineWidth=Math.max(2,2),e.strokeStyle="rgba(255,160,0,0.85)",e.arc(Y,X,ee,0,Math.PI*2),e.stroke(),e.strokeStyle="rgba(255,160,0,0.85)",e.lineWidth=Math.max(2,2);const le=Math.max(15,ee*.15);if(e.beginPath(),e.moveTo(Y-le,X),e.lineTo(Y+le,X),e.stroke(),e.beginPath(),e.moveTo(Y,X-le),e.lineTo(Y,X+le),e.stroke(),i()&&i().length){e.fillStyle="rgba(0,200,255,0.9)";for(const _e of i()){const he=_e.angle,qe=Y+Math.cos(he)*ee,Se=X+Math.sin(he)*ee;e.beginPath(),e.arc(qe,Se,Math.max(2,Math.round(ee*.03)),0,Math.PI*2),e.fill()}}}catch(O){console.warn("overlay draw failed",O)}if(a().active||o())try{let O;if(o()?O=(Date.now()-(a().startTime||Date.now()))%2e3/2e3:O=Math.min(1,(Date.now()-a().startTime)/2e3),e.fillStyle=o()?"rgba(0, 0, 0, 0.5)":"rgba(0, 0, 0, 0.3)",e.fillRect(-H/2-100,-U/2-100,H+200,U+200),v()){const V=v(),Y=H*x/n(A).width,X=(V.x-n(A).width/2)*Y,ee=(V.y-n(A).height/2)*Y,le=V.r*Y;e.strokeStyle=`rgba(100, 200, 255, ${.8*(1-O)})`,e.lineWidth=2;for(let Se=0;Se<3;Se++){const at=le*(.3+O*1.2+Se*.3);e.beginPath(),e.arc(X,ee,at,0,Math.PI*2),e.stroke()}e.strokeStyle="rgba(100, 200, 255, 0.9)",e.lineWidth=3;const _e=O*Math.PI*6,he=le*1.8;e.beginPath(),e.moveTo(X,ee),e.lineTo(X+Math.cos(_e)*he,ee+Math.sin(_e)*he),e.stroke();const qe=4+Math.sin(O*Math.PI*4)*2;e.fillStyle=`rgba(100, 200, 255, ${.9*Math.sin(O*Math.PI)})`,e.beginPath(),e.arc(X,ee,qe,0,Math.PI*2),e.fill(),e.fillStyle=`rgba(100, 200, 255, ${Math.sin(O*Math.PI)})`,e.font="bold 14px sans-serif",e.textAlign="center",e.fillText("SCANNING...",X,ee-le-20)}else{const V=Math.max(H,U)/2;e.strokeStyle=`rgba(100, 200, 255, ${.6})`,e.lineWidth=2;for(let X=0;X<4;X++){const ee=V*(O+X*.25)%1,le=1-ee;e.strokeStyle=`rgba(100, 200, 255, ${le*.6})`,e.beginPath(),e.arc(0,0,ee*V,0,Math.PI*2),e.stroke()}e.strokeStyle="rgba(100, 200, 255, 0.8)",e.lineWidth=3;const Y=O*Math.PI*4;e.beginPath(),e.moveTo(0,0),e.lineTo(Math.cos(Y)*V,Math.sin(Y)*V),e.stroke(),e.fillStyle=`rgba(100, 200, 255, ${.8+.2*Math.sin(O*Math.PI*4)})`,e.font="bold 18px sans-serif",e.textAlign="center",o()?(e.fillText("âš™ï¸ EDIT MODE - ADJUST POSITION & ZOOM",0,-60),e.font="bold 16px sans-serif",e.fillStyle="rgba(255, 200, 100, 0.95)",e.fillText("ðŸŽ¯ Align crosshair with rotation center",0,-20),e.font="14px sans-serif",e.fillStyle="rgba(200, 255, 200, 0.9)",e.fillText("ðŸ‘† Drag to move  â€¢  ðŸ” Scroll/Pinch to zoom",0,20),e.font="bold 14px sans-serif",e.fillStyle="rgba(100, 255, 100, 0.9)",e.fillText('Click "Confirm Detection" when ready',0,60)):(e.fillText("ANALYZING IMAGE...",0,-20),e.font="12px sans-serif",e.fillText(`${Math.round(O*100)}%`,0,10))}}catch(O){console.warn("radar animation failed",O)}if(c()&&p()){const O=1e3/f();n(E)%O/O>.5&&(e.fillStyle="rgba(0, 0, 0, 0.8)",e.fillRect(-_,-S,_*3,S*3))}if(o()){const O=Date.now()%1e3/1e3,V=.7+.3*Math.sin(O*Math.PI*2);e.strokeStyle=`rgba(255, 100, 0, ${V})`,e.lineWidth=4;const Y=Math.min(_,S)*.1;e.beginPath(),e.arc(0,0,Y*.7,0,Math.PI*2),e.stroke(),e.lineWidth=3,e.beginPath(),e.moveTo(-Y,0),e.lineTo(Y,0),e.stroke(),e.beginPath(),e.moveTo(0,-Y),e.lineTo(0,Y),e.stroke(),e.beginPath(),e.arc(0,0,10+3*Math.sin(O*Math.PI*2),0,Math.PI*2),e.fillStyle=`rgba(255, 100, 0, ${V})`,e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.stroke(),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="rgba(255, 255, 255, 0.95)",e.fill()}e.restore()}Ce(()=>(s(),n(A)),()=>{s()?st(s()):(n(A)&&P(A,null),P(ye,!1),de())}),Ce(()=>(p(),a(),o(),n(F)),()=>{p()||a().active||o()?n(F)||P(F,requestAnimationFrame(Re)):n(F)&&(cancelAnimationFrame(n(F)),P(F,null),P(E,0))}),Pt(),rt();var Fe=Yn(),je=z(Fe);Lt(je,_=>P(r,_),()=>n(r));var Ze=L(je,2);{var it=_=>{var S=Hn(),R=z(S);j(S),$e(q=>Ee(R,`Speed: ${q??""}Â°/s`),[()=>(d(),xe(()=>d().toFixed(0)))]),ae(_,S)};Le(Ze,_=>{n(M)&&_(it)})}j(Fe),Lt(Fe,_=>P(h,_),()=>n(h)),ae(t,Fe),Je(),y()}async function Bn(t,l,s={}){const{x:d,y:p,r:a}=l||{x:t.width/2,y:t.height/2,r:Math.min(t.width,t.height)/2},o=s.samples||720,u=s.innerOffset||-Math.max(2,Math.round(a*.06)),b=s.outerOffset||Math.max(2,Math.round(a*.06)),v=s.thresholdFactor||.6,i=document.createElement("canvas");i.width=t.width,i.height=t.height;const c=i.getContext("2d");c.drawImage(t,0,0);const f=c.getImageData(0,0,i.width,i.height).data,g=i.width,y=i.height;function h(E,N){const Z=Math.round(E),M=Math.round(N);if(Z<0||Z>=g||M<0||M>=y)return 0;const Q=(M*g+Z)*4,ie=f[Q],ue=f[Q+1],ve=f[Q+2];return .2126*ie+.7152*ue+.0722*ve}const r=new Array(o);for(let E=0;E<o;E++){const N=E/o*Math.PI*2,Z=[],M=3;for(let ie=0;ie<M;ie++){const ue=ie/(M-1),ve=a+u+(b-u)*ue,A=d+ve*Math.cos(N),ye=p+ve*Math.sin(N);Z.push(h(A,ye))}const Q=Z.reduce((ie,ue)=>ie+ue,0)/Z.length;r[E]=Q}const e=r.reduce((E,N)=>E+N,0)/r.length,w=Math.sqrt(r.reduce((E,N)=>E+(N-e)**2,0)/r.length),x=e+w*v,C=r.map(E=>E>x);let I=0,$=!1,T=[],D=0;for(let E=0;E<C.length*2;E++){const N=E%C.length;if(C[N]?(D++,$=!0):($&&(T.push(D),D=0),$=!1),E>=C.length&&!$)break}$&&D>0&&T.push(D);const ne=Math.max(2,Math.round(o/360*(s.minDegrees||5))),G=T.filter(E=>E>=ne);I=G.length;const se=[];let F=0;for(const E of T){const N=F%o,Z=(F+E-1)%o,M=(N+Math.floor(E/2))%o;se.push({start:N,end:Z,mid:M,angle:M/o*2*Math.PI}),F+=E+1}return{count:I,samples:r,mask:C,groups:G,positions:se,canvas:i}}function Wt(t){const l=new OffscreenCanvas(t.width,t.height);l.getContext("2d").drawImage(t,0,0);const d=cv.imread(l);cv.cvtColor(d,d,cv.COLOR_RGBA2GRAY);const p=new cv.Mat;cv.HoughCircles(d,p,cv.HOUGH_GRADIENT,1,50,100,40,t.width*.3,t.width*.6);const[a,o,u]=p.data32F;return d.delete(),p.delete(),{x:a,y:o,r:u}}function Vn(t,l=24,s={}){const d=[],{width:p,height:a}=t,o=s.circle||{x:p/2,y:a/2,r:Math.min(p,a)/2},u=Math.round(o.r*2),b=s.margin??1.05,v=s.outputSize||Math.max(32,Math.round(u*b)),i=s.fps||24,c=typeof s.rotationSpeed=="number"?s.rotationSpeed:0,f=s.direction==null?1:s.direction,g=document.createElement("canvas");g.width=u,g.height=u;const y=g.getContext("2d"),h=Math.round(o.x-o.r),r=Math.round(o.y-o.r);try{y.drawImage(t,h,r,u,u,0,0,u,u)}catch{y.drawImage(t,0,0)}y.globalCompositeOperation="destination-in",y.beginPath(),y.arc(u/2,u/2,u/2,0,Math.PI*2),y.fillStyle="black",y.fill(),y.globalCompositeOperation="source-over";const w=c/i*Math.PI/180*f;Math.round(u*(s.zoom||1));for(let x=0;x<l;x++){const C=x*w,I=document.createElement("canvas");I.width=v,I.height=v;const $=I.getContext("2d");$.translate(v/2,v/2),$.rotate(C);const T=Math.round(u*(s.zoom||1)),D=T;$.drawImage(g,-T/2,-D/2,T,D),d.push(I)}return d}function Jn(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function tt(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var wt={exports:{}},Nt;function Kn(){return Nt||(Nt=1,(function(t,l){(function(s){t.exports=s()})(function(){return(function s(d,p,a){function o(v,i){if(!p[v]){if(!d[v]){var c=typeof tt=="function"&&tt;if(!i&&c)return c(v,!0);if(u)return u(v,!0);var f=new Error("Cannot find module '"+v+"'");throw f.code="MODULE_NOT_FOUND",f}var g=p[v]={exports:{}};d[v][0].call(g.exports,function(y){var h=d[v][1][y];return o(h||y)},g,g.exports,s,d,p,a)}return p[v].exports}for(var u=typeof tt=="function"&&tt,b=0;b<a.length;b++)o(a[b]);return o})({1:[function(s,d,p){function a(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}d.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0,a.defaultMaxListeners=10,a.prototype.setMaxListeners=function(i){if(!u(i)||i<0||isNaN(i))throw TypeError("n must be a positive number");return this._maxListeners=i,this},a.prototype.emit=function(i){var c,f,g,y,h,r;if(this._events||(this._events={}),i==="error"&&(!this._events.error||b(this._events.error)&&!this._events.error.length)){if(c=arguments[1],c instanceof Error)throw c;var e=new Error('Uncaught, unspecified "error" event. ('+c+")");throw e.context=c,e}if(f=this._events[i],v(f))return!1;if(o(f))switch(arguments.length){case 1:f.call(this);break;case 2:f.call(this,arguments[1]);break;case 3:f.call(this,arguments[1],arguments[2]);break;default:y=Array.prototype.slice.call(arguments,1),f.apply(this,y)}else if(b(f))for(y=Array.prototype.slice.call(arguments,1),r=f.slice(),g=r.length,h=0;h<g;h++)r[h].apply(this,y);return!0},a.prototype.addListener=function(i,c){var f;if(!o(c))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",i,o(c.listener)?c.listener:c),this._events[i]?b(this._events[i])?this._events[i].push(c):this._events[i]=[this._events[i],c]:this._events[i]=c,b(this._events[i])&&!this._events[i].warned&&(v(this._maxListeners)?f=a.defaultMaxListeners:f=this._maxListeners,f&&f>0&&this._events[i].length>f&&(this._events[i].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[i].length),typeof console.trace=="function"&&console.trace())),this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(i,c){if(!o(c))throw TypeError("listener must be a function");var f=!1;function g(){this.removeListener(i,g),f||(f=!0,c.apply(this,arguments))}return g.listener=c,this.on(i,g),this},a.prototype.removeListener=function(i,c){var f,g,y,h;if(!o(c))throw TypeError("listener must be a function");if(!this._events||!this._events[i])return this;if(f=this._events[i],y=f.length,g=-1,f===c||o(f.listener)&&f.listener===c)delete this._events[i],this._events.removeListener&&this.emit("removeListener",i,c);else if(b(f)){for(h=y;h-- >0;)if(f[h]===c||f[h].listener&&f[h].listener===c){g=h;break}if(g<0)return this;f.length===1?(f.length=0,delete this._events[i]):f.splice(g,1),this._events.removeListener&&this.emit("removeListener",i,c)}return this},a.prototype.removeAllListeners=function(i){var c,f;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[i]&&delete this._events[i],this;if(arguments.length===0){for(c in this._events)c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events={},this}if(f=this._events[i],o(f))this.removeListener(i,f);else if(f)for(;f.length;)this.removeListener(i,f[f.length-1]);return delete this._events[i],this},a.prototype.listeners=function(i){var c;return!this._events||!this._events[i]?c=[]:o(this._events[i])?c=[this._events[i]]:c=this._events[i].slice(),c},a.prototype.listenerCount=function(i){if(this._events){var c=this._events[i];if(o(c))return 1;if(c)return c.length}return 0},a.listenerCount=function(i,c){return i.listenerCount(c)};function o(i){return typeof i=="function"}function u(i){return typeof i=="number"}function b(i){return typeof i=="object"&&i!==null}function v(i){return i===void 0}},{}],2:[function(s,d,p){var a,o,u,b,v;v=navigator.userAgent.toLowerCase(),b=navigator.platform.toLowerCase(),a=v.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],u=a[1]==="ie"&&document.documentMode,o={name:a[1]==="version"?a[3]:a[1],version:u||parseFloat(a[1]==="opera"&&a[4]?a[4]:a[2]),platform:{name:v.match(/ip(?:ad|od|hone)/)?"ios":(v.match(/(?:webos|android)/)||b.match(/mac|win|linux/)||["other"])[0]}},o[o.name]=!0,o[o.name+parseInt(o.version,10)]=!0,o.platform[o.platform.name]=!0,d.exports=o},{}],3:[function(s,d,p){var a,o,u,b=function(f,g){for(var y in g)v.call(g,y)&&(f[y]=g[y]);function h(){this.constructor=f}return h.prototype=g.prototype,f.prototype=new h,f.__super__=g.prototype,f},v={}.hasOwnProperty,i=[].indexOf||function(f){for(var g=0,y=this.length;g<y;g++)if(g in this&&this[g]===f)return g;return-1},c=[].slice;a=s("events").EventEmitter,u=s("./browser.coffee"),o=(function(f){var g,y;b(h,f),g={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},y={delay:500,copy:!1};function h(r){var e,w,x;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(r);for(w in g)x=g[w],(e=this.options)[w]==null&&(e[w]=x)}return h.prototype.setOption=function(r,e){if(this.options[r]=e,this._canvas!=null&&(r==="width"||r==="height"))return this._canvas[r]=e},h.prototype.setOptions=function(r){var e,w,x;w=[];for(e in r)v.call(r,e)&&(x=r[e],w.push(this.setOption(e,x)));return w},h.prototype.addFrame=function(r,e){var w,x;e==null&&(e={}),w={},w.transparent=this.options.transparent;for(x in y)w[x]=e[x]||y[x];if(this.options.width==null&&this.setOption("width",r.width),this.options.height==null&&this.setOption("height",r.height),typeof ImageData<"u"&&ImageData!==null&&r instanceof ImageData)w.data=r.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&r instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&r instanceof WebGLRenderingContext)e.copy?w.data=this.getContextData(r):w.context=r;else if(r.childNodes!=null)e.copy?w.data=this.getImageData(r):w.image=r;else throw new Error("Invalid image");return this.frames.push(w)},h.prototype.render=function(){var r,e,w;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var x,C,I;for(I=[],x=0,C=this.frames.length;0<=C?x<C:x>C;0<=C?++x:--x)I.push(null);return I}).call(this),e=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(r=0,w=e;0<=w?r<w:r>w;0<=w?++r:--r)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},h.prototype.abort=function(){for(var r;r=this.activeWorkers.shift(),r!=null;)this.log("killing active worker"),r.terminate();return this.running=!1,this.emit("abort")},h.prototype.spawnWorkers=function(){var r,e,w;return r=Math.min(this.options.workers,this.frames.length),(function(){w=[];for(var x=e=this.freeWorkers.length;e<=r?x<r:x>r;e<=r?x++:x--)w.push(x);return w}).apply(this).forEach((function(x){return function(C){var I;return x.log("spawning worker "+C),I=new Worker(x.options.workerScript),I.onmessage=function($){return x.activeWorkers.splice(x.activeWorkers.indexOf(I),1),x.freeWorkers.push(I),x.frameFinished($.data)},x.freeWorkers.push(I)}})(this)),r},h.prototype.frameFinished=function(r){var e,w;if(this.log("frame "+r.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[r.index]=r,this.options.globalPalette===!0&&(this.options.globalPalette=r.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(e=1,w=this.freeWorkers.length;1<=w?e<w:e>w;1<=w?++e:--e)this.renderNextFrame();return i.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},h.prototype.finishRendering=function(){var r,e,w,x,C,I,$,T,D,ne,G,se,F,E,N,Z;for(T=0,E=this.imageParts,C=0,D=E.length;C<D;C++)e=E[C],T+=(e.data.length-1)*e.pageSize+e.cursor;for(T+=e.pageSize-e.cursor,this.log("rendering finished - filesize "+Math.round(T/1e3)+"kb"),r=new Uint8Array(T),se=0,N=this.imageParts,I=0,ne=N.length;I<ne;I++)for(e=N[I],Z=e.data,w=$=0,G=Z.length;$<G;w=++$)F=Z[w],r.set(F,se),w===e.data.length-1?se+=e.cursor:se+=e.pageSize;return x=new Blob([r],{type:"image/gif"}),this.emit("finished",x,r)},h.prototype.renderNextFrame=function(){var r,e,w;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return r=this.frames[this.nextFrame++],w=this.freeWorkers.shift(),e=this.getTask(r),this.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(w),w.postMessage(e)},h.prototype.getContextData=function(r){return r.getImageData(0,0,this.options.width,this.options.height).data},h.prototype.getImageData=function(r){var e;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),e=this._canvas.getContext("2d"),e.setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(r,0,0),this.getContextData(e)},h.prototype.getTask=function(r){var e,w;if(e=this.frames.indexOf(r),w={index:e,last:e===this.frames.length-1,delay:r.delay,transparent:r.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:u.name==="chrome"},r.data!=null)w.data=r.data;else if(r.context!=null)w.data=this.getContextData(r.context);else if(r.image!=null)w.data=this.getImageData(r.image);else throw new Error("Invalid frame");return w},h.prototype.log=function(){var r;if(r=1<=arguments.length?c.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,r)},h})(a),d.exports=o},{"./browser.coffee":2,events:1}]},{},[3])(3)})})(wt)),wt.exports}var Zn=Kn();const Qn=Jn(Zn),er=""+new URL("../assets/gif.worker.CjkyQP34.js",import.meta.url).href;async function tr(t,l=24){if(!t||t.length===0)throw new Error("No frames to export");const s=new Qn({workers:2,quality:10,width:t[0].width,height:t[0].height,workerScript:er,repeat:0,background:null}),d=Math.round(1e3/l);for(const p of t){const a=p.width,o=p.height,u=document.createElement("canvas");u.width=a,u.height=o;const b=u.getContext("2d");b.fillStyle="#ffffff",b.fillRect(0,0,a,o),b.drawImage(p,0,0),s.addFrame(u,{delay:d,copy:!0})}return new Promise((p,a)=>{s.on("finished",function(o){const u=URL.createObjectURL(o);p(u)}),s.on("error",a),s.render()})}var nr=fe('<div class="export-overlay svelte-14nyow8" role="status" aria-live="polite"><div class="export-box svelte-14nyow8"><div class="spinner svelte-14nyow8" aria-hidden="true"></div> <div class="export-text svelte-14nyow8">Workingâ€¦ Exporting GIF â€” please wait</div></div></div>'),rr=fe('<button class="confirm-btn svelte-14nyow8">Confirm Detection</button> <button class="svelte-14nyow8">Cancel</button>',1),sr=fe("<button>Detect Circle & Count</button>"),ir=fe('<div class="drag-handle svelte-14nyow8" title="Drag to move"></div>'),ar=fe('<div><!> <div style="display:flex;gap:12px;align-items:center;" class="svelte-14nyow8"><button class="speed-btn svelte-14nyow8">âˆ’</button> <div style="text-align:center;min-width:120px;" class="svelte-14nyow8"><div class="speed-display svelte-14nyow8"> </div> <div style="font-size:11px;opacity:0.6;margin-top:4px;" class="svelte-14nyow8">Rotation Speed</div></div> <button class="speed-btn svelte-14nyow8">+</button></div></div>'),or=fe('<div class="svelte-14nyow8"><strong class="svelte-14nyow8">Circle:</strong> </div>'),lr=fe('<div class="panel svelte-14nyow8"><!> <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;" class="svelte-14nyow8"><button> </button> <button class="svelte-14nyow8">Reverse</button> <!> <button class="svelte-14nyow8">Apply Suggested Speed</button> <button class="svelte-14nyow8"> </button> <label style="display:flex;align-items:center;gap:6px;" class="svelte-14nyow8"><span style="font-size:12px;opacity:0.8;" class="svelte-14nyow8">Frames:</span> <input type="number" min="3" step="1" style="width:70px;padding:4px;border-radius:4px;border:1px solid #ccc;" class="svelte-14nyow8"/></label> <label style="display:flex;align-items:center;gap:6px;margin-left:6px;" class="svelte-14nyow8"><input type="checkbox" class="svelte-14nyow8"/> <span class="svelte-14nyow8">Show Overlay</span></label></div> <!> <div style="margin-top:12px;" class="svelte-14nyow8"><div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;" class="svelte-14nyow8"><div class="svelte-14nyow8"><strong class="svelte-14nyow8">Current Speed:</strong> <em style="font-size:12px;opacity:0.7;" class="svelte-14nyow8">(Touch: drag up to speed up, down to slow down)</em></div> <div style="display:flex;gap:6px;align-items:center;" class="svelte-14nyow8"><label for="manual-speed-input" style="font-size:12px;" class="svelte-14nyow8">Type speed:</label> <input id="manual-speed-input" type="number" min="1" step="1" style="width:100px;padding:6px;border-radius:4px;border:1px solid #ccc;" class="svelte-14nyow8"/> <button class="svelte-14nyow8">Set</button></div></div> <div class="svelte-14nyow8"><strong class="svelte-14nyow8">Detected count:</strong> </div> <div class="svelte-14nyow8"><strong class="svelte-14nyow8">Suggested speed:</strong> </div> <!></div></div>');function cr(t,l){Ve(l,!1);const s=()=>K(Ne,"$imageUrl",c),d=()=>K(Ge,"$isPlaying",c),p=()=>K(Te,"$rotationSpeed",c),a=()=>K(Mt,"$detectedCircle",c),o=()=>K(Ft,"$detectedCount",c),u=()=>K(mt,"$suggestedRotationSpeed",c),b=()=>K(kt,"$overlayVisible",c),v=()=>K(Xe,"$editMode",c),i=()=>K(St,"$playerCanvas",c),[c,f]=It(),g=te(),y=te(),h=te(),r=te();let e=te(!1);async function w(){Ge.update(m=>!m)}function x(){Te.update(m=>Math.min(1e4,m+60))}function C(){Te.update(m=>Math.max(10,m-60))}function I(){bt.update(m=>m*-1)}async function $(){if(!s())return;Xe.set(!0);const k=Date.now();Be.set({active:!0,progress:0,startTime:k})}async function T(){const m=s();if(!m)return;P(e,!0),Xe.set(!1);const k=Date.now();Be.set({active:!0,progress:0,startTime:k}),d()||requestAnimationFrame(()=>{});try{const W=await De(m);let J=null;try{typeof cv<"u"&&Wt&&(J=Wt(W))}catch(me){console.warn("cv detect failed, falling back",me)}J||(J={x:W.width/2,y:W.height/2,r:Math.min(W.width,W.height)/2*.9});const re=await Bn(W,J,{samples:720}),ge=2e3-(Date.now()-k);ge>0&&await new Promise(me=>setTimeout(me,ge)),Mt.set(J),Ft.set(re.count),Ht.set(re.positions||[]);const He=(re.count>0?360/re.count:1)*30;mt.set(He),Be.set({active:!1,progress:1,startTime:k})}finally{P(e,!1)}}function D(){mt.subscribe(m=>{m&&Te.set(m)})()}function ne(){Xe.set(!1),Be.set({active:!1,progress:0,startTime:0})}let G=te(0);function se(){const m=Number(n(G))||0;m<=0||Te.set(m)}let F=te(!1);async function E(){const m=s()||ut(Ne);if(!m)return alert("No image loaded to export.");if(!n(g))return alert("Please detect the circle before exporting the GIF.");const k=await De(m),W=document.createElement("canvas");W.width=k.width,W.height=k.height,W.getContext("2d").drawImage(k,0,0,k.width,k.height),P(F,!0);try{const re=n(N)||24,Pe=n(g),ge=Pe.r*2*1.1,Ie=Math.min(480,Math.round(ge)),Qe=Number(ut(Te)||0),He=Number(ut(bt)||1),me=Vn(W,re,{circle:Pe,outputSize:Ie,margin:1.05,zoom:1,fps:24,rotationSpeed:Qe,direction:He}),lt=await tr(me,24),Ye=document.createElement("a");Ye.href=lt,Ye.download="phenaki-export.gif",document.body.appendChild(Ye),Ye.click(),Ye.remove()}catch(re){console.error("GIF export failed",re),alert("GIF export failed: "+(re&&re.message))}finally{P(F,!1)}}let N=te(24);const Z="phenaki.speedControlPos";let M=te({left:null,top:null}),Q=te(!1),ie=te(!1),ue={x:0,y:0},ve={left:0,top:0},A=0;function ye(){try{const m=localStorage.getItem(Z);m&&P(M,JSON.parse(m))}catch{}}function be(){try{localStorage.setItem(Z,JSON.stringify(n(M)))}catch{}}function st(m){const k=Date.now(),W=k-A<300;if(A=k,m.target&&m.target.closest&&m.target.closest("button"))return;const J=m.target&&m.target.closest&&m.target.closest(".drag-handle");if(!(!W&&!J)){P(Q,!0),P(ie,!0),ue={x:m.clientX,y:m.clientY},ve={left:n(M).left??Math.round((window.innerWidth-200)/2),top:n(M).top??Math.round((window.innerHeight-80)/2)};try{m.target.setPointerCapture(m.pointerId)}catch{}window.addEventListener("pointermove",Ae),window.addEventListener("pointerup",Ue)}}function Ae(m){if(!n(ie))return;const k=m.clientX-ue.x,W=m.clientY-ue.y;B(M,n(M).left=Math.round(ve.left+k)),B(M,n(M).top=Math.round(ve.top+W))}function Ue(m){P(ie,!1),P(Q,!1);try{m.target.releasePointerCapture&&m.target.releasePointerCapture(m.pointerId)}catch{}window.removeEventListener("pointermove",Ae),window.removeEventListener("pointerup",Ue),be()}Et(()=>{ye(),n(M).left==null&&B(M,n(M).left=Math.round((window.innerWidth-200)/2)),n(M).top==null&&B(M,n(M).top=Math.round((window.innerHeight-80)/2));function m(){const ge=Math.max(8,window.innerWidth-200-8),Ie=Math.max(8,window.innerHeight-80-8);n(M).left==null&&B(M,n(M).left=ge),n(M).top==null&&B(M,n(M).top=Ie),B(M,n(M).left=Math.min(Math.max(n(M).left,8),ge)),B(M,n(M).top=Math.min(Math.max(n(M).top,8),Ie))}m();const k=()=>{m(),be()};return window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)});function De(m){return new Promise((k,W)=>{const J=new Image;J.crossOrigin="anonymous",J.onload=()=>k(J),J.onerror=W,J.src=m})}Ce(()=>p(),()=>{P(G,Number(p()||0))}),Ce(()=>a(),()=>{P(g,a())}),Ce(()=>o(),()=>{P(y,o())}),Ce(()=>u(),()=>{P(h,u())}),Ce(()=>b(),()=>{P(r,b())}),Pt(),rt();var Oe=lr(),ze=z(Oe);{var Ke=m=>{var k=nr();ae(m,k)};Le(ze,m=>{n(F)&&m(Ke)})}var Re=L(ze,2),de=z(Re),Fe=z(de,!0);j(de);var je=L(de,2),Ze=L(je,2);{var it=m=>{var k=rr(),W=_t(k),J=L(W,2);$e(()=>W.disabled=n(e)),ce("click",W,T),ce("click",J,ne),ae(m,k)},_=m=>{var k=sr();$e(()=>{ht(k,1,At(n(g)?"":"detect-btn-required"),"svelte-14nyow8"),k.disabled=n(e)||!s()}),ce("click",k,$),ae(m,k)};Le(Ze,m=>{v()?m(it):m(_,!1)})}var S=L(Ze,2),R=L(S,2),q=z(R,!0);j(R);var H=L(R,2),U=L(z(H),2);pt(U),j(H);var Me=L(H,2),ke=z(Me);pt(ke),nt(2),j(Me),j(Re);var O=L(Re,2);{var V=m=>{var k=ar(),W=z(k);{var J=me=>{var lt=ir();ae(me,lt)};Le(W,me=>{n(Q)&&me(J)})}var re=L(W,2),Pe=z(re),ge=L(Pe,2),Ie=z(ge),Qe=z(Ie);j(Ie),nt(2),j(ge);var He=L(ge,2);j(re),j(k),$e(me=>{ht(k,1,`speed-control ${n(Q)?"dragMode":""} ${n(ie)?"dragging":""}`,"svelte-14nyow8"),An(k,`left: ${n(M),xe(()=>n(M).left??16)??""}px; top: ${n(M),xe(()=>n(M).top??16)??""}px;`),Ee(Qe,`${me??""}Â°/s`)},[()=>(p(),xe(()=>p().toFixed(0)))]),ce("click",Pe,C),ce("click",He,x),ce("pointerdown",k,st),ae(m,k)};Le(O,m=>{a()&&m(V)})}var Y=L(O,2),X=z(Y),ee=z(X),le=L(z(ee));nt(),j(ee);var _e=L(ee,2),he=L(z(_e),2);pt(he);var qe=L(he,2);j(_e),j(X);var Se=L(X,2),at=L(z(Se));j(Se);var ot=L(Se,2),Yt=L(z(ot));j(ot);var Xt=L(ot,2);{var Bt=m=>{var k=or(),W=L(z(k));j(k),$e((J,re,Pe)=>Ee(W,` x=${J??""}, y=${re??""}, r=${Pe??""}`),[()=>(n(g),xe(()=>Math.round(n(g).x))),()=>(n(g),xe(()=>Math.round(n(g).y))),()=>(n(g),xe(()=>Math.round(n(g).r)))]),ae(m,k)};Le(Xt,m=>{n(g)&&m(Bt)})}j(Y),j(Oe),$e((m,k)=>{ht(de,1,At(n(g)&&!d()?"play-highlight":""),"svelte-14nyow8"),Ee(Fe,d()?"Pause":"Play"),S.disabled=!n(h),R.disabled=n(F)||!i(),Ee(q,n(F)?"Exporting...":"Save GIF"),Fn(ke,n(r)),Ee(le,` ${m??""}Â°/s | `),Ee(at,` ${n(y)??0??""}`),Ee(Yt,` ${k??""}Â°/s`)},[()=>(p(),xe(()=>p().toFixed(0))),()=>(n(h),xe(()=>n(h)?n(h).toFixed(0):"â€”"))]),ce("click",de,w),ce("click",je,I),ce("click",S,D),ce("click",R,E),Rt(U,()=>n(N),m=>P(N,m)),ce("change",ke,m=>kt.set(m.target.checked)),Rt(he,()=>n(G),m=>P(G,m)),ce("click",qe,se),ae(t,Oe),Je(),f()}var fr=fe("<option> </option>"),ur=fe('<div class="selector svelte-ai08gq"><label for="samples" class="svelte-ai08gq">Sample Images:</label> <select id="samples" class="svelte-ai08gq"><option>-- Choose a sample --</option><!></select></div>');function dr(t,l){Ve(l,!1);const s="https://raw.githubusercontent.com/tclaret/phenakistoscope-simulator/main/images",d="https://raw.githubusercontent.com/tclaret/phenaki-lab/main/img",p=[{name:"Woman Chopping Tree",file:"WomanChoppingTree.jpg",repo:"old"},{name:"Dancing",file:"Dancing.jpg",repo:"old"},{name:"Jongleur",file:"Jongleur.png",repo:"old"},{name:"a_cheval",file:"a_cheval.png",repo:"old"},{name:"McLean_1",file:"McLean_1.png",repo:"old"},{name:"Gernamy_1949",file:"Gernamy_1949_R_Balzer.png",repo:"old"},{name:"AEO175939",file:"AEO175939_PhenakistoscopeGiroux60.jpg",repo:"old"},{name:"AEO185553",file:"AEO185553_PhenakistiscopeDisc_ManInBlueAndRed.jpg",repo:"old"},{name:"medium_1990_5036_3369",file:"medium_1990_5036_3369.jpg",repo:"old"},{name:"medium_a001813b",file:"medium_a001813b.jpg",repo:"old"},{name:"tumblr_obd6fh",file:"tumblr_obd6fhGFSZ1r9jbwno1_500.png",repo:"old"},{name:"tumblr_oc1cz",file:"tumblr_oc1czn99ZM1r9jbwno1_500.png",repo:"old"},{name:"Phantasmascope Faces",file:"Phantasmascope_faces.png",repo:"old"},{name:"722a6790240569.5e126845d9b56",file:"722a6790240569.5e126845d9b56.png",repo:"old"},{name:"Fantascope Disc 1833",file:"fantascope-disc-1833.png",repo:"old"},{name:"Face",file:"_face__.jpg",repo:"new"},{name:"Culbute",file:"culbute.jpg",repo:"new"},{name:"Grenouille",file:"Grenouille__.jpg",repo:"new"},{name:"Oh Soccer",file:"oh_soccer.jpg",repo:"new"},{name:"Un Grand Un Petit",file:"un_grand_un_petit.jpg",repo:"new"},{name:"Autre Culbutte",file:"autre_culbutte.jpg",repo:"new"},{name:"Dancing 2",file:"dancing_.jpg",repo:"new"},{name:"Il Pompe de l'eau",file:"il_pompe_de_leau.jpg",repo:"new"},{name:"Porceline",file:"porceline.jpg",repo:"new"},{name:"Volants",file:"volants_.png",repo:"new"},{name:"Ce Qui",file:"ce_qui.jpg",repo:"new"},{name:"Des Anges",file:"des_anges.jpg",repo:"new"},{name:"Moulin",file:"moulin_.jpg",repo:"new"},{name:"Rats",file:"rats__.jpg",repo:"new"},{name:"Corde Ã  Danser",file:"corde_a_denser_.jpg",repo:"new"},{name:"Ecureuil",file:"ecureuil.jpg",repo:"new"},{name:"Noel Noel",file:"noel_noel.jpg",repo:"new"},{name:"Tirreur",file:"tirreur_.jpg",repo:"new"},{name:"C Pastel",file:"c_pastel.jpg",repo:"new"},{name:"GÃ©omÃ©trique",file:"geometrique.jpg",repo:"new"},{name:"Nuages en Scie",file:"nuages_en_scie.jpg",repo:"new"},{name:"Tons Pastels",file:"tons_pastels.jpg",repo:"new"}];function a(i){const f=`${i.repo==="new"?d:s}/${i.file}`;Ne.set(f),Tt.set(f),Ge.set(!0)}Et(()=>{let i=!1;if(Ne.subscribe(f=>{f&&(i=!0)})(),!i){const f=p[Math.floor(Math.random()*p.length)];f&&a(f)}}),rt();var o=ur(),u=L(z(o),2),b=z(u);b.value=b.__value="";var v=L(b);In(v,1,()=>p,i=>i.file,(i,c)=>{var f=fr(),g=z(f,!0);j(f);var y={};$e(()=>{Ee(g,n(c).name),y!==(y=n(c).file)&&(f.value=(f.__value=n(c).file)??"")}),ae(i,f)}),j(u),j(o),ce("change",u,i=>{const c=i.target.selectedIndex-1;c>=0&&a(p[c])}),ae(t,o),Je()}var hr=fe('<div class="container svelte-1uha8ag"><h1 class="svelte-1uha8ag">Phenakistoscope Lab</h1> <p class="sub svelte-1uha8ag">Convert old phenakistoscope discs into animated GIFs</p> <!> <!> <!> <!> <!></div>');function xr(t){var l=hr(),s=L(z(l),4);zn(s,{});var d=L(s,2);dr(d,{});var p=L(d,2);qn(p,{});var a=L(p,2);Xn(a,{});var o=L(a,2);cr(o,{}),j(l),ae(t,l)}export{xr as component};
