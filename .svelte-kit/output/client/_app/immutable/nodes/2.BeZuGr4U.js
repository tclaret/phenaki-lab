import{f as fe,a as ae,c as Vt}from"../chunks/BPwTt6vP.js";import"../chunks/D4mQYNIE.js";import{G as Jt,v as pe,w as Kt,g as n,av as Zt,I as Qt,J as en,K as It,L as $t,M as ct,D as et,a3 as tn,aq as nn,aa as rn,x as Ne,C as yt,B as Gt,F as sn,T as Q,a1 as Lt,ao as Ut,aI as an,aJ as on,y as jt,A as ln,aK as cn,aL as fn,aM as ft,ak as un,aN as dn,aO as hn,an as pn,z as vn,aP as gn,P as mn,aQ as wn,aR as yn,aS as _n,aT as xn,aU as bn,aG as Mn,b as xe,O as kn,aV as Sn,p as Ve,j as Je,s as D,k as j,l as z,aW as Ie,aX as Pt,i as _t,U as P,ab as nt,t as $e,aY as X}from"../chunks/zw_chER5.js";import{e as ce,s as Ee}from"../chunks/CfBDm7bY.js";import{i as rt}from"../chunks/CtND9pXO.js";import{w as oe,o as Et,a as Pn,g as ut}from"../chunks/BQFw1Q7y.js";import{i as Ae,s as Tt,a as V,b as At}from"../chunks/BuQu0Dv8.js";function En(e,o,s){for(var d=[],p=o.length,a=0;a<p;a++)dn(o[a].e,d,!0);hn(d,()=>{var l=d.length===0&&s!==null;if(l){var u=s,b=u.parentNode;pn(b),b.append(u),e.items.clear(),we(e,o[0].prev,o[p-1].next)}for(var v=0;v<p;v++){var i=o[v];l||(e.items.delete(i.k),we(e,i.prev,i.next)),vn(i.e,!l)}e.first===o[0]&&(e.first=o[0].prev)})}function Tn(e,o,s,d,p,a=null){var l=e,u=new Map,b=null;pe&&Kt();var v=null,i=Zt(()=>{var r=s();return an(r)?r:r==null?[]:Ut(r)}),c,f=!0;function g(){Cn(h,c,l,o,d),v!==null&&(c.length===0?(v.fragment?(l.before(v.fragment),v.fragment=null):jt(v.effect),y.first=v.effect):ln(v.effect,()=>{v=null}))}var y=Jt(()=>{c=n(i);var r=c.length;let t=!1;if(pe){var w=Qt(l)===en;w!==(r===0)&&(l=It(),$t(l),ct(!1),t=!0)}for(var x=new Set,I=Ne,T=null,L=sn(),C=0;C<r;C+=1){pe&&et.nodeType===tn&&et.data===nn&&(l=et,t=!0,ct(!1));var A=c[C],ee=d(A,C),G=f?null:u.get(ee);G?(rn(G.v,A),G.i=C,L&&I.skipped_effects.delete(G.e)):(G=In(f?l:null,T,A,ee,C,p,o,s),f&&(G.o=!0,T===null?b=G:T.next=G,T=G),u.set(ee,G)),x.add(ee)}if(r===0&&a&&!v)if(f)v={fragment:null,effect:yt(()=>a(l))};else{var se=document.createDocumentFragment(),F=Gt();se.append(F),v={fragment:se,effect:yt(()=>a(F))}}if(pe&&r>0&&$t(It()),!f)if(L){for(const[E,W]of u)x.has(E)||I.skipped_effects.add(W.e);I.oncommit(g),I.ondiscard(()=>{})}else g();t&&ct(!0),n(i)}),h={effect:y,items:u,first:b};f=!1,pe&&(l=et)}function Cn(e,o,s,d,p){var a=o.length,l=e.items,u=e.first,b,v=null,i=[],c=[],f,g,y,h;for(h=0;h<a;h+=1){if(f=o[h],g=p(f,h),y=l.get(g),e.first??=y,!y.o){y.o=!0;var r=v?v.next:u;we(e,v,y),we(e,y,r),dt(y,r,s),v=y,i=[],c=[],u=v.next;continue}if((y.e.f&ft)!==0&&jt(y.e),y!==u){if(b!==void 0&&b.has(y)){if(i.length<c.length){var t=c[0],w;v=t.prev;var x=i[0],I=i[i.length-1];for(w=0;w<i.length;w+=1)dt(i[w],t,s);for(w=0;w<c.length;w+=1)b.delete(c[w]);we(e,x.prev,I.next),we(e,v,x),we(e,I,t),u=t,v=I,h-=1,i=[],c=[]}else b.delete(y),dt(y,u,s),we(e,y.prev,y.next),we(e,y,v===null?e.first:v.next),we(e,v,y),v=y;continue}for(i=[],c=[];u!==null&&u.k!==g;)(u.e.f&ft)===0&&(b??=new Set).add(u),c.push(u),u=u.next;if(u===null)continue;y=u}i.push(y),v=y,u=y.next}let T=l.size>a;if(u!==null||b!==void 0){for(var L=b===void 0?[]:Ut(b);u!==null;)(u.e.f&ft)===0&&L.push(u),u=u.next;var C=L.length;if(T=l.size-C>a,C>0){var A=null;En(e,L,A)}}if(T)for(const ee of l.values())ee.o||(we(e,v,ee),v=ee);e.effect.last=v&&v.e}function In(e,o,s,d,p,a,l,u){var b=(l&cn)!==0,v=(l&fn)===0,i=b?v?Q(s,!1,!1):Lt(s):s,c=(l&on)===0?p:Lt(p),f={i:c,v:i,k:d,a:null,e:null,o:!1,prev:o,next:null};try{if(e===null){var g=document.createDocumentFragment();g.append(e=Gt())}return f.e=yt(()=>a(e,i,c,u)),o!==null&&(o.next=f),f}finally{}}function dt(e,o,s){for(var d=e.next?e.next.e.nodes_start:s,p=o?o.e.nodes_start:s,a=e.e.nodes_start;a!==null&&a!==d;){var l=un(a);p.before(a),a=l}}function we(e,o,s){o===null?(e.first=s,e.effect.first=s&&s.e):(o.e.next&&(o.e.next.prev=null),o.next=s,o.e.next=s&&s.e),s!==null&&(s.e.prev&&(s.e.prev.next=null),s.prev=o,s.e.prev=o&&o.e)}function zt(e){var o,s,d="";if(typeof e=="string"||typeof e=="number")d+=e;else if(typeof e=="object")if(Array.isArray(e)){var p=e.length;for(o=0;o<p;o++)e[o]&&(s=zt(e[o]))&&(d&&(d+=" "),d+=s)}else for(s in e)e[s]&&(d&&(d+=" "),d+=s);return d}function $n(){for(var e,o,s=0,d="",p=arguments.length;s<p;s++)(e=arguments[s])&&(o=zt(e))&&(d&&(d+=" "),d+=o);return d}function Dt(e){return typeof e=="object"?$n(e):e??""}function Ln(e,o,s){var d=e==null?"":""+e;return d=d?d+" "+o:o,d===""?null:d}function An(e,o){return e==null?null:String(e)}function ht(e,o,s,d,p,a){var l=e.__className;if(pe||l!==s||l===void 0){var u=Ln(s,d);(!pe||u!==e.getAttribute("class"))&&(u==null?e.removeAttribute("class"):e.className=u),e.__className=s}return a}function Dn(e,o,s,d){var p=e.__style;if(pe||p!==o){var a=An(o);(!pe||a!==e.getAttribute("style"))&&(a==null?e.removeAttribute("style"):e.style.cssText=a),e.__style=o}return d}const Rn=Symbol("is custom element"),On=Symbol("is html");function pt(e){if(pe){var o=!1,s=()=>{if(!o){if(o=!0,e.hasAttribute("value")){var d=e.value;xt(e,"value",null),e.value=d}if(e.hasAttribute("checked")){var p=e.checked;xt(e,"checked",null),e.checked=p}}};e.__on_r=s,mn(s),wn()}}function Fn(e,o){var s=qt(e);s.checked!==(s.checked=o??void 0)&&(e.checked=o)}function xt(e,o,s,d){var p=qt(e);pe&&(p[o]=e.getAttribute(o),o==="src"||o==="srcset"||o==="href"&&e.nodeName==="LINK")||p[o]!==(p[o]=s)&&(o==="loading"&&(e[yn]=s),s==null?e.removeAttribute(o):typeof s!="string"&&Nn(e).includes(o)?e[o]=s:e.setAttribute(o,s))}function qt(e){return e.__attributes??={[Rn]:e.nodeName.includes("-"),[On]:e.namespaceURI===gn}}var Rt=new Map;function Nn(e){var o=e.getAttribute("is")||e.nodeName,s=Rt.get(o);if(s)return s;Rt.set(o,s=[]);for(var d,p=e,a=Element.prototype;a!==p;){d=xn(p);for(var l in d)d[l].set&&s.push(l);p=_n(p)}return s}function Ot(e,o,s=o){var d=new WeakSet;bn(e,"input",async p=>{var a=p?e.defaultValue:e.value;if(a=vt(e)?gt(a):a,s(a),Ne!==null&&d.add(Ne),await Mn(),a!==(a=o())){var l=e.selectionStart,u=e.selectionEnd,b=e.value.length;if(e.value=a??"",u!==null){var v=e.value.length;l===u&&u===b&&v>b?(e.selectionStart=v,e.selectionEnd=v):(e.selectionStart=l,e.selectionEnd=Math.min(u,v))}}}),(pe&&e.defaultValue!==e.value||xe(o)==null&&e.value)&&(s(vt(e)?gt(e.value):e.value),Ne!==null&&d.add(Ne)),kn(()=>{var p=o();if(e===document.activeElement){var a=Sn??Ne;if(d.has(a))return}vt(e)&&p===gt(e.value)||e.type==="date"&&!p&&!e.value||p!==e.value&&(e.value=p??"")})}function vt(e){var o=e.type;return o==="number"||o==="range"}function gt(e){return e===""?null:+e}const Ct=oe(null),We=oe(null),Ge=oe(!1),Ce=oe(360),bt=oe(1),Mt=oe(null),Ft=oe(0),mt=oe(1),Ht=oe([]),kt=oe(!1),Xe=oe(!1),Be=oe({active:!1,progress:0,startTime:0}),St=oe(null),Wn=oe(!1),Gn=oe(10);var Un=fe('<label>Choose image: <input type="file" accept="image/*"/></label>');function jn(e,o){Ve(o,!1);function s(a){const l=a.target.files[0];if(!l)return;const u=URL.createObjectURL(l);Ct.set(u),We.set(u),Ge.set(!0)}rt();var d=Un(),p=D(j(d));z(d),ce("change",p,s),ae(e,d),Je()}var zn=fe('<div class="preview svelte-1th6cal"><img alt="Selected disc preview" class="svelte-1th6cal"/></div>f',1);function qn(e,o){Ve(o,!1);const s=()=>V(Ct,"$previewUrl",d),[d,p]=Tt(),a=Q();Ie(()=>s(),()=>{P(a,s())}),Pt();var l=Vt(),u=_t(l);{var b=v=>{var i=zn(),c=_t(i),f=j(c);z(c),nt(),$e(()=>xt(f,"src",n(a))),ae(v,i)};Ae(u,v=>{n(a)&&v(b)})}ae(e,l),Je(),p()}var Hn=fe('<div class="speed-hud svelte-byh4af"> </div>'),Yn=fe('<div class="canvas-wrapper svelte-byh4af"><canvas class="svelte-byh4af"></canvas> <!></div>');function Xn(e,o){Ve(o,!1);const s=()=>V(We,"$imageUrl",g),d=()=>V(Ce,"$rotationSpeed",g),p=()=>V(Ge,"$isPlaying",g),a=()=>V(Be,"$detectionAnimation",g),l=()=>V(bt,"$rotationDirection",g),u=()=>V(kt,"$overlayVisible",g),b=()=>V(Mt,"$detectedCircle",g),v=()=>V(Ht,"$detectedPositions",g),i=()=>V(Xe,"$editMode",g),c=()=>V(Wn,"$flickerEnabled",g),f=()=>V(Gn,"$flickerFrequency",g),[g,y]=Tt();let h=Q(),r=Q(),t,w=0,x=1;const I=1,T=4;let L=0,C=0;const A=new Map;let ee=1,G=0,se=0,F=Q(),E=Q(0),W=0,J=1,M=Q(!1),K,ie=0,ue=0,ve=0,R=Q(null),ye=Q(!1),be;function st(_){P(ye,!1),P(R,new Image),X(R,n(R).crossOrigin="anonymous"),X(R,n(R).onload=()=>{P(ye,!0),De(),de()}),X(R,n(R).onerror=S=>{console.error("Erreur chargement:",_,S),P(ye,!1)}),X(R,n(R).src=_)}function De(){if(!n(r)||!n(h))return;const _=n(h).getBoundingClientRect(),S=window.devicePixelRatio||1;if(n(R)&&n(R).width&&n(R).height){const O=n(R).width,q=n(R).height,H=Math.min(1400,Math.max(150,Math.round(_.width*Math.sqrt(O*O+q*q)/O)));X(h,n(h).style.height=H+"px");const U=n(h).getBoundingClientRect();X(r,n(r).style.width=U.width+"px"),X(r,n(r).style.height=U.height+"px"),X(r,n(r).width=Math.round(U.width*S)),X(r,n(r).height=Math.round(U.height*S))}else X(r,n(r).style.width=_.width+"px"),X(r,n(r).style.height=_.height+"px"),X(r,n(r).width=Math.round(_.width*S)),X(r,n(r).height=Math.round(_.height*S));t&&t.setTransform(S,0,0,S,0,0),de()}Et(()=>(n(r)&&(St.set(n(r)),t=n(r).getContext("2d"),n(h)&&X(h,n(h).style.touchAction="none"),n(h)&&n(h).addEventListener("wheel",Ke,{passive:!1}),De(),be=new ResizeObserver(()=>De()),n(h)&&be.observe(n(h)),n(h)&&(n(h).addEventListener("pointerdown",Ue),n(h).addEventListener("pointermove",Le),n(h).addEventListener("pointerup",Re),n(h).addEventListener("pointerleave",je))),()=>{be&&be.disconnect()}));function Ue(_){if(!n(h))return;n(h).setPointerCapture(_.pointerId),A.set(_.pointerId,{x:_.clientX,y:_.clientY});const S=Date.now(),O=_.clientX-ue,q=_.clientY-ve,H=Math.sqrt(O*O+q*q);if(S-ie<300&&H<50){Ge.update(U=>!U),A.clear(),ie=0;return}if(ie=S,ue=_.clientX,ve=_.clientY,A.size===1&&(G=_.clientX,se=_.clientY,W=_.clientY,J=d()||1),A.size===2){const U=Array.from(A.values());ee=x,Le.pinchStartDist=Math.hypot(U[0].x-U[1].x,U[0].y-U[1].y)}}function Le(_){if(n(h)){if(A.has(_.pointerId)&&A.set(_.pointerId,{x:_.clientX,y:_.clientY}),A.size===2){const S=Array.from(A.values()),O=S[0],q=S[1],H=Math.hypot(O.x-q.x,O.y-q.y),U=Le.pinchStartDist||H,Me=H/U;let ke=Math.max(I,Math.min(T,ee*Me));const $={x:(O.x+q.x)/2,y:(O.y+q.y)/2},te=n(r).clientWidth,ne=n(r).clientHeight,Y=n(h).getBoundingClientRect(),Z=$.x-(Y.left+te/2)-L,le=$.y-(Y.top+ne/2)-C,_e=x,he=ke;L=L-(he/_e-1)*Z,C=C-(he/_e-1)*le,x=ke,P(M,!0),clearTimeout(K);return}if(A.size===1)if(A.values().next().value,x>1){const S=_.clientX-G,O=_.clientY-se;L+=S,C+=O,G=_.clientX,se=_.clientY,de();return}else{const S=W-_.clientY,q=Math.round(S*8),H=Math.max(10,Math.min(1e4,Math.round(J+q)));Ce.set(H),P(M,!0),clearTimeout(K)}}}function Re(_){if(n(h)){try{n(h).releasePointerCapture(_.pointerId)}catch{}clearTimeout(K),P(M,!0),K=setTimeout(()=>{P(M,!1)},4e3),A.delete(_.pointerId),A.size===0&&(clearTimeout(K),P(M,!1))}}function je(){clearTimeout(K),P(M,!0),K=setTimeout(()=>{P(M,!1)},4e3)}function Ke(_){if(!n(h)||!_.ctrlKey&&!_.metaKey)return;_.preventDefault();const O=1+(-_.deltaY>0?.1:-.1),q=Math.max(I,Math.min(T,x*O)),H=n(h).getBoundingClientRect(),U=_.clientX-(H.left+n(r).clientWidth/2)-L,Me=_.clientY-(H.top+n(r).clientHeight/2)-C;L=L-(q/x-1)*U,C=C-(q/x-1)*Me,x=q,de()}Pn(()=>{n(F)&&cancelAnimationFrame(n(F)),be&&be.disconnect(),K&&clearTimeout(K),n(h)&&(n(h).removeEventListener("pointerdown",Ue),n(h).removeEventListener("pointermove",Le),n(h).removeEventListener("pointerup",Re),n(h).removeEventListener("pointerleave",je),n(h)&&n(h).removeEventListener("wheel",Ke)),St.set(null)});function Oe(_){const S=p()||a().active;if(!S||!n(ye)){P(E,0),!S&&n(F)&&(cancelAnimationFrame(n(F)),P(F,null));return}n(E)||P(E,_);const O=_-n(E);if(P(E,_),p()){const q=d()||0;w+=q*(l()||1)*(O/1e3)}de(),P(F,requestAnimationFrame(Oe))}function de(){if(!n(ye)||!t||!n(R)||!n(r))return;const _=n(r).clientWidth,S=n(r).clientHeight;t.clearRect(0,0,_,S),t.save();const O=n(R).width/n(R).height,q=_/S;let H,U;O>q?(H=_,U=_/O):(U=S,H=S*O);const Me=H*x,ke=U*x;if(t.translate(_/2+L,S/2+C),t.rotate(w*Math.PI/180),t.drawImage(n(R),-Me/2,-ke/2,Me,ke),u()&&b())try{const $=b(),te=H*x/n(R).width,ne=($.x-n(R).width/2)*te,Y=($.y-n(R).height/2)*te,Z=$.r*te;t.beginPath(),t.lineWidth=Math.max(2,2),t.strokeStyle="rgba(255,160,0,0.85)",t.arc(ne,Y,Z,0,Math.PI*2),t.stroke(),t.strokeStyle="rgba(255,160,0,0.85)",t.lineWidth=Math.max(2,2);const le=Math.max(15,Z*.15);if(t.beginPath(),t.moveTo(ne-le,Y),t.lineTo(ne+le,Y),t.stroke(),t.beginPath(),t.moveTo(ne,Y-le),t.lineTo(ne,Y+le),t.stroke(),v()&&v().length){t.fillStyle="rgba(0,200,255,0.9)";for(const _e of v()){const he=_e.angle,qe=ne+Math.cos(he)*Z,Se=Y+Math.sin(he)*Z;t.beginPath(),t.arc(qe,Se,Math.max(2,Math.round(Z*.03)),0,Math.PI*2),t.fill()}}}catch($){console.warn("overlay draw failed",$)}if(a().active)try{let $;if(i()?$=(Date.now()-a().startTime)%2e3/2e3:$=Math.min(1,(Date.now()-a().startTime)/2e3),t.fillStyle="rgba(0, 0, 0, 0.3)",t.fillRect(-H/2-100,-U/2-100,H+200,U+200),b()){const te=b(),ne=H*x/n(R).width,Y=(te.x-n(R).width/2)*ne,Z=(te.y-n(R).height/2)*ne,le=te.r*ne;t.strokeStyle=`rgba(100, 200, 255, ${.8*(1-$)})`,t.lineWidth=2;for(let Se=0;Se<3;Se++){const at=le*(.3+$*1.2+Se*.3);t.beginPath(),t.arc(Y,Z,at,0,Math.PI*2),t.stroke()}t.strokeStyle="rgba(100, 200, 255, 0.9)",t.lineWidth=3;const _e=$*Math.PI*6,he=le*1.8;t.beginPath(),t.moveTo(Y,Z),t.lineTo(Y+Math.cos(_e)*he,Z+Math.sin(_e)*he),t.stroke();const qe=4+Math.sin($*Math.PI*4)*2;t.fillStyle=`rgba(100, 200, 255, ${.9*Math.sin($*Math.PI)})`,t.beginPath(),t.arc(Y,Z,qe,0,Math.PI*2),t.fill(),t.fillStyle=`rgba(100, 200, 255, ${Math.sin($*Math.PI)})`,t.font="bold 14px sans-serif",t.textAlign="center",t.fillText("SCANNING...",Y,Z-le-20)}else{const te=Math.max(H,U)/2;t.strokeStyle=`rgba(100, 200, 255, ${.6})`,t.lineWidth=2;for(let Y=0;Y<4;Y++){const Z=te*($+Y*.25)%1,le=1-Z;t.strokeStyle=`rgba(100, 200, 255, ${le*.6})`,t.beginPath(),t.arc(0,0,Z*te,0,Math.PI*2),t.stroke()}t.strokeStyle="rgba(100, 200, 255, 0.8)",t.lineWidth=3;const ne=$*Math.PI*4;t.beginPath(),t.moveTo(0,0),t.lineTo(Math.cos(ne)*te,Math.sin(ne)*te),t.stroke(),t.fillStyle=`rgba(100, 200, 255, ${.8+.2*Math.sin($*Math.PI*4)})`,t.font="bold 16px sans-serif",t.textAlign="center",i()?(t.fillText("POSITION THE CENTER & ADJUST ZOOM",0,-30),t.font="14px sans-serif",t.fillText("Align the crosshair with rotation center",0,0)):(t.fillText("ANALYZING IMAGE...",0,-20),t.font="12px sans-serif",t.fillText(`${Math.round($*100)}%`,0,10))}}catch($){console.warn("radar animation failed",$)}if(c()&&p()){const $=1e3/f();n(E)%$/$>.5&&(t.fillStyle="rgba(0, 0, 0, 0.8)",t.fillRect(-_,-S,_*3,S*3))}if(i()){t.strokeStyle="rgba(255, 100, 0, 0.9)",t.lineWidth=3;const $=Math.min(_,S)*.08;t.beginPath(),t.moveTo(-$,0),t.lineTo($,0),t.stroke(),t.beginPath(),t.moveTo(0,-$),t.lineTo(0,$),t.stroke(),t.beginPath(),t.arc(0,0,8,0,Math.PI*2),t.fillStyle="rgba(255, 100, 0, 0.9)",t.fill(),t.strokeStyle="rgba(255, 255, 255, 0.8)",t.lineWidth=2,t.stroke()}t.restore()}Ie(()=>(s(),n(R)),()=>{s()?st(s()):(n(R)&&P(R,null),P(ye,!1),de())}),Ie(()=>(p(),a(),n(F)),()=>{p()||a().active?n(F)||P(F,requestAnimationFrame(Oe)):n(F)&&(cancelAnimationFrame(n(F)),P(F,null),P(E,0))}),Pt(),rt();var Fe=Yn(),ze=j(Fe);At(ze,_=>P(r,_),()=>n(r));var Ze=D(ze,2);{var it=_=>{var S=Hn(),O=j(S);z(S),$e(q=>Ee(O,`Speed: ${q??""}°/s`),[()=>(d(),xe(()=>d().toFixed(0)))]),ae(_,S)};Ae(Ze,_=>{n(M)&&_(it)})}z(Fe),At(Fe,_=>P(h,_),()=>n(h)),ae(e,Fe),Je(),y()}async function Bn(e,o,s={}){const{x:d,y:p,r:a}=o||{x:e.width/2,y:e.height/2,r:Math.min(e.width,e.height)/2},l=s.samples||720,u=s.innerOffset||-Math.max(2,Math.round(a*.06)),b=s.outerOffset||Math.max(2,Math.round(a*.06)),v=s.thresholdFactor||.6,i=document.createElement("canvas");i.width=e.width,i.height=e.height;const c=i.getContext("2d");c.drawImage(e,0,0);const f=c.getImageData(0,0,i.width,i.height).data,g=i.width,y=i.height;function h(E,W){const J=Math.round(E),M=Math.round(W);if(J<0||J>=g||M<0||M>=y)return 0;const K=(M*g+J)*4,ie=f[K],ue=f[K+1],ve=f[K+2];return .2126*ie+.7152*ue+.0722*ve}const r=new Array(l);for(let E=0;E<l;E++){const W=E/l*Math.PI*2,J=[],M=3;for(let ie=0;ie<M;ie++){const ue=ie/(M-1),ve=a+u+(b-u)*ue,R=d+ve*Math.cos(W),ye=p+ve*Math.sin(W);J.push(h(R,ye))}const K=J.reduce((ie,ue)=>ie+ue,0)/J.length;r[E]=K}const t=r.reduce((E,W)=>E+W,0)/r.length,w=Math.sqrt(r.reduce((E,W)=>E+(W-t)**2,0)/r.length),x=t+w*v,I=r.map(E=>E>x);let T=0,L=!1,C=[],A=0;for(let E=0;E<I.length*2;E++){const W=E%I.length;if(I[W]?(A++,L=!0):(L&&(C.push(A),A=0),L=!1),E>=I.length&&!L)break}L&&A>0&&C.push(A);const ee=Math.max(2,Math.round(l/360*(s.minDegrees||5))),G=C.filter(E=>E>=ee);T=G.length;const se=[];let F=0;for(const E of C){const W=F%l,J=(F+E-1)%l,M=(W+Math.floor(E/2))%l;se.push({start:W,end:J,mid:M,angle:M/l*2*Math.PI}),F+=E+1}return{count:T,samples:r,mask:I,groups:G,positions:se,canvas:i}}function Nt(e){const o=new OffscreenCanvas(e.width,e.height);o.getContext("2d").drawImage(e,0,0);const d=cv.imread(o);cv.cvtColor(d,d,cv.COLOR_RGBA2GRAY);const p=new cv.Mat;cv.HoughCircles(d,p,cv.HOUGH_GRADIENT,1,50,100,40,e.width*.3,e.width*.6);const[a,l,u]=p.data32F;return d.delete(),p.delete(),{x:a,y:l,r:u}}function Vn(e,o=24,s={}){const d=[],{width:p,height:a}=e,l=s.circle||{x:p/2,y:a/2,r:Math.min(p,a)/2},u=Math.round(l.r*2),b=s.margin??1.05,v=s.outputSize||Math.max(32,Math.round(u*b)),i=s.fps||24,c=typeof s.rotationSpeed=="number"?s.rotationSpeed:0,f=s.direction==null?1:s.direction,g=document.createElement("canvas");g.width=u,g.height=u;const y=g.getContext("2d"),h=Math.round(l.x-l.r),r=Math.round(l.y-l.r);try{y.drawImage(e,h,r,u,u,0,0,u,u)}catch{y.drawImage(e,0,0)}y.globalCompositeOperation="destination-in",y.beginPath(),y.arc(u/2,u/2,u/2,0,Math.PI*2),y.fillStyle="black",y.fill(),y.globalCompositeOperation="source-over";const w=c/i*Math.PI/180*f;Math.round(u*(s.zoom||1));for(let x=0;x<o;x++){const I=x*w,T=document.createElement("canvas");T.width=v,T.height=v;const L=T.getContext("2d");L.translate(v/2,v/2),L.rotate(I);const C=Math.round(u*(s.zoom||1)),A=C;L.drawImage(g,-C/2,-A/2,C,A),d.push(T)}return d}function Jn(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function tt(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var wt={exports:{}},Wt;function Kn(){return Wt||(Wt=1,(function(e,o){(function(s){e.exports=s()})(function(){return(function s(d,p,a){function l(v,i){if(!p[v]){if(!d[v]){var c=typeof tt=="function"&&tt;if(!i&&c)return c(v,!0);if(u)return u(v,!0);var f=new Error("Cannot find module '"+v+"'");throw f.code="MODULE_NOT_FOUND",f}var g=p[v]={exports:{}};d[v][0].call(g.exports,function(y){var h=d[v][1][y];return l(h||y)},g,g.exports,s,d,p,a)}return p[v].exports}for(var u=typeof tt=="function"&&tt,b=0;b<a.length;b++)l(a[b]);return l})({1:[function(s,d,p){function a(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}d.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0,a.defaultMaxListeners=10,a.prototype.setMaxListeners=function(i){if(!u(i)||i<0||isNaN(i))throw TypeError("n must be a positive number");return this._maxListeners=i,this},a.prototype.emit=function(i){var c,f,g,y,h,r;if(this._events||(this._events={}),i==="error"&&(!this._events.error||b(this._events.error)&&!this._events.error.length)){if(c=arguments[1],c instanceof Error)throw c;var t=new Error('Uncaught, unspecified "error" event. ('+c+")");throw t.context=c,t}if(f=this._events[i],v(f))return!1;if(l(f))switch(arguments.length){case 1:f.call(this);break;case 2:f.call(this,arguments[1]);break;case 3:f.call(this,arguments[1],arguments[2]);break;default:y=Array.prototype.slice.call(arguments,1),f.apply(this,y)}else if(b(f))for(y=Array.prototype.slice.call(arguments,1),r=f.slice(),g=r.length,h=0;h<g;h++)r[h].apply(this,y);return!0},a.prototype.addListener=function(i,c){var f;if(!l(c))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",i,l(c.listener)?c.listener:c),this._events[i]?b(this._events[i])?this._events[i].push(c):this._events[i]=[this._events[i],c]:this._events[i]=c,b(this._events[i])&&!this._events[i].warned&&(v(this._maxListeners)?f=a.defaultMaxListeners:f=this._maxListeners,f&&f>0&&this._events[i].length>f&&(this._events[i].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[i].length),typeof console.trace=="function"&&console.trace())),this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(i,c){if(!l(c))throw TypeError("listener must be a function");var f=!1;function g(){this.removeListener(i,g),f||(f=!0,c.apply(this,arguments))}return g.listener=c,this.on(i,g),this},a.prototype.removeListener=function(i,c){var f,g,y,h;if(!l(c))throw TypeError("listener must be a function");if(!this._events||!this._events[i])return this;if(f=this._events[i],y=f.length,g=-1,f===c||l(f.listener)&&f.listener===c)delete this._events[i],this._events.removeListener&&this.emit("removeListener",i,c);else if(b(f)){for(h=y;h-- >0;)if(f[h]===c||f[h].listener&&f[h].listener===c){g=h;break}if(g<0)return this;f.length===1?(f.length=0,delete this._events[i]):f.splice(g,1),this._events.removeListener&&this.emit("removeListener",i,c)}return this},a.prototype.removeAllListeners=function(i){var c,f;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[i]&&delete this._events[i],this;if(arguments.length===0){for(c in this._events)c!=="removeListener"&&this.removeAllListeners(c);return this.removeAllListeners("removeListener"),this._events={},this}if(f=this._events[i],l(f))this.removeListener(i,f);else if(f)for(;f.length;)this.removeListener(i,f[f.length-1]);return delete this._events[i],this},a.prototype.listeners=function(i){var c;return!this._events||!this._events[i]?c=[]:l(this._events[i])?c=[this._events[i]]:c=this._events[i].slice(),c},a.prototype.listenerCount=function(i){if(this._events){var c=this._events[i];if(l(c))return 1;if(c)return c.length}return 0},a.listenerCount=function(i,c){return i.listenerCount(c)};function l(i){return typeof i=="function"}function u(i){return typeof i=="number"}function b(i){return typeof i=="object"&&i!==null}function v(i){return i===void 0}},{}],2:[function(s,d,p){var a,l,u,b,v;v=navigator.userAgent.toLowerCase(),b=navigator.platform.toLowerCase(),a=v.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],u=a[1]==="ie"&&document.documentMode,l={name:a[1]==="version"?a[3]:a[1],version:u||parseFloat(a[1]==="opera"&&a[4]?a[4]:a[2]),platform:{name:v.match(/ip(?:ad|od|hone)/)?"ios":(v.match(/(?:webos|android)/)||b.match(/mac|win|linux/)||["other"])[0]}},l[l.name]=!0,l[l.name+parseInt(l.version,10)]=!0,l.platform[l.platform.name]=!0,d.exports=l},{}],3:[function(s,d,p){var a,l,u,b=function(f,g){for(var y in g)v.call(g,y)&&(f[y]=g[y]);function h(){this.constructor=f}return h.prototype=g.prototype,f.prototype=new h,f.__super__=g.prototype,f},v={}.hasOwnProperty,i=[].indexOf||function(f){for(var g=0,y=this.length;g<y;g++)if(g in this&&this[g]===f)return g;return-1},c=[].slice;a=s("events").EventEmitter,u=s("./browser.coffee"),l=(function(f){var g,y;b(h,f),g={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},y={delay:500,copy:!1};function h(r){var t,w,x;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(r);for(w in g)x=g[w],(t=this.options)[w]==null&&(t[w]=x)}return h.prototype.setOption=function(r,t){if(this.options[r]=t,this._canvas!=null&&(r==="width"||r==="height"))return this._canvas[r]=t},h.prototype.setOptions=function(r){var t,w,x;w=[];for(t in r)v.call(r,t)&&(x=r[t],w.push(this.setOption(t,x)));return w},h.prototype.addFrame=function(r,t){var w,x;t==null&&(t={}),w={},w.transparent=this.options.transparent;for(x in y)w[x]=t[x]||y[x];if(this.options.width==null&&this.setOption("width",r.width),this.options.height==null&&this.setOption("height",r.height),typeof ImageData<"u"&&ImageData!==null&&r instanceof ImageData)w.data=r.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&r instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&r instanceof WebGLRenderingContext)t.copy?w.data=this.getContextData(r):w.context=r;else if(r.childNodes!=null)t.copy?w.data=this.getImageData(r):w.image=r;else throw new Error("Invalid image");return this.frames.push(w)},h.prototype.render=function(){var r,t,w;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var x,I,T;for(T=[],x=0,I=this.frames.length;0<=I?x<I:x>I;0<=I?++x:--x)T.push(null);return T}).call(this),t=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(r=0,w=t;0<=w?r<w:r>w;0<=w?++r:--r)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},h.prototype.abort=function(){for(var r;r=this.activeWorkers.shift(),r!=null;)this.log("killing active worker"),r.terminate();return this.running=!1,this.emit("abort")},h.prototype.spawnWorkers=function(){var r,t,w;return r=Math.min(this.options.workers,this.frames.length),(function(){w=[];for(var x=t=this.freeWorkers.length;t<=r?x<r:x>r;t<=r?x++:x--)w.push(x);return w}).apply(this).forEach((function(x){return function(I){var T;return x.log("spawning worker "+I),T=new Worker(x.options.workerScript),T.onmessage=function(L){return x.activeWorkers.splice(x.activeWorkers.indexOf(T),1),x.freeWorkers.push(T),x.frameFinished(L.data)},x.freeWorkers.push(T)}})(this)),r},h.prototype.frameFinished=function(r){var t,w;if(this.log("frame "+r.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[r.index]=r,this.options.globalPalette===!0&&(this.options.globalPalette=r.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(t=1,w=this.freeWorkers.length;1<=w?t<w:t>w;1<=w?++t:--t)this.renderNextFrame();return i.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},h.prototype.finishRendering=function(){var r,t,w,x,I,T,L,C,A,ee,G,se,F,E,W,J;for(C=0,E=this.imageParts,I=0,A=E.length;I<A;I++)t=E[I],C+=(t.data.length-1)*t.pageSize+t.cursor;for(C+=t.pageSize-t.cursor,this.log("rendering finished - filesize "+Math.round(C/1e3)+"kb"),r=new Uint8Array(C),se=0,W=this.imageParts,T=0,ee=W.length;T<ee;T++)for(t=W[T],J=t.data,w=L=0,G=J.length;L<G;w=++L)F=J[w],r.set(F,se),w===t.data.length-1?se+=t.cursor:se+=t.pageSize;return x=new Blob([r],{type:"image/gif"}),this.emit("finished",x,r)},h.prototype.renderNextFrame=function(){var r,t,w;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return r=this.frames[this.nextFrame++],w=this.freeWorkers.shift(),t=this.getTask(r),this.log("starting frame "+(t.index+1)+" of "+this.frames.length),this.activeWorkers.push(w),w.postMessage(t)},h.prototype.getContextData=function(r){return r.getImageData(0,0,this.options.width,this.options.height).data},h.prototype.getImageData=function(r){var t;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),t=this._canvas.getContext("2d"),t.setFill=this.options.background,t.fillRect(0,0,this.options.width,this.options.height),t.drawImage(r,0,0),this.getContextData(t)},h.prototype.getTask=function(r){var t,w;if(t=this.frames.indexOf(r),w={index:t,last:t===this.frames.length-1,delay:r.delay,transparent:r.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:u.name==="chrome"},r.data!=null)w.data=r.data;else if(r.context!=null)w.data=this.getContextData(r.context);else if(r.image!=null)w.data=this.getImageData(r.image);else throw new Error("Invalid frame");return w},h.prototype.log=function(){var r;if(r=1<=arguments.length?c.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,r)},h})(a),d.exports=l},{"./browser.coffee":2,events:1}]},{},[3])(3)})})(wt)),wt.exports}var Zn=Kn();const Qn=Jn(Zn),er=""+new URL("../assets/gif.worker.CjkyQP34.js",import.meta.url).href;async function tr(e,o=24){if(!e||e.length===0)throw new Error("No frames to export");const s=new Qn({workers:2,quality:10,width:e[0].width,height:e[0].height,workerScript:er,repeat:0,background:null}),d=Math.round(1e3/o);for(const p of e){const a=p.width,l=p.height,u=document.createElement("canvas");u.width=a,u.height=l;const b=u.getContext("2d");b.fillStyle="#ffffff",b.fillRect(0,0,a,l),b.drawImage(p,0,0),s.addFrame(u,{delay:d,copy:!0})}return new Promise((p,a)=>{s.on("finished",function(l){const u=URL.createObjectURL(l);p(u)}),s.on("error",a),s.render()})}var nr=fe('<div class="export-overlay svelte-14nyow8" role="status" aria-live="polite"><div class="export-box svelte-14nyow8"><div class="spinner svelte-14nyow8" aria-hidden="true"></div> <div class="export-text svelte-14nyow8">Working… Exporting GIF — please wait</div></div></div>'),rr=fe('<button class="confirm-btn svelte-14nyow8">Confirm Detection</button> <button class="svelte-14nyow8">Cancel</button>',1),sr=fe("<button>Detect Circle & Count</button>"),ir=fe('<div class="drag-handle svelte-14nyow8" title="Drag to move"></div>'),ar=fe('<div><!> <div style="display:flex;gap:12px;align-items:center;" class="svelte-14nyow8"><button class="speed-btn svelte-14nyow8">−</button> <div style="text-align:center;min-width:120px;" class="svelte-14nyow8"><div class="speed-display svelte-14nyow8"> </div> <div style="font-size:11px;opacity:0.6;margin-top:4px;" class="svelte-14nyow8">Rotation Speed</div></div> <button class="speed-btn svelte-14nyow8">+</button></div></div>'),or=fe('<div class="svelte-14nyow8"><strong class="svelte-14nyow8">Circle:</strong> </div>'),lr=fe('<div class="panel svelte-14nyow8"><!> <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;" class="svelte-14nyow8"><button> </button> <button class="svelte-14nyow8">Reverse</button> <!> <button class="svelte-14nyow8">Apply Suggested Speed</button> <button class="svelte-14nyow8"> </button> <label style="display:flex;align-items:center;gap:6px;" class="svelte-14nyow8"><span style="font-size:12px;opacity:0.8;" class="svelte-14nyow8">Frames:</span> <input type="number" min="3" step="1" style="width:70px;padding:4px;border-radius:4px;border:1px solid #ccc;" class="svelte-14nyow8"/></label> <label style="display:flex;align-items:center;gap:6px;margin-left:6px;" class="svelte-14nyow8"><input type="checkbox" class="svelte-14nyow8"/> <span class="svelte-14nyow8">Show Overlay</span></label></div> <!> <div style="margin-top:12px;" class="svelte-14nyow8"><div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;" class="svelte-14nyow8"><div class="svelte-14nyow8"><strong class="svelte-14nyow8">Current Speed:</strong> <em style="font-size:12px;opacity:0.7;" class="svelte-14nyow8">(Touch: drag up to speed up, down to slow down)</em></div> <div style="display:flex;gap:6px;align-items:center;" class="svelte-14nyow8"><label for="manual-speed-input" style="font-size:12px;" class="svelte-14nyow8">Type speed:</label> <input id="manual-speed-input" type="number" min="1" step="1" style="width:100px;padding:6px;border-radius:4px;border:1px solid #ccc;" class="svelte-14nyow8"/> <button class="svelte-14nyow8">Set</button></div></div> <div class="svelte-14nyow8"><strong class="svelte-14nyow8">Detected count:</strong> </div> <div class="svelte-14nyow8"><strong class="svelte-14nyow8">Suggested speed:</strong> </div> <!></div></div>');function cr(e,o){Ve(o,!1);const s=()=>V(We,"$imageUrl",c),d=()=>V(Ge,"$isPlaying",c),p=()=>V(Ce,"$rotationSpeed",c),a=()=>V(Mt,"$detectedCircle",c),l=()=>V(Ft,"$detectedCount",c),u=()=>V(mt,"$suggestedRotationSpeed",c),b=()=>V(kt,"$overlayVisible",c),v=()=>V(Xe,"$editMode",c),i=()=>V(St,"$playerCanvas",c),[c,f]=Tt(),g=Q(),y=Q(),h=Q(),r=Q();let t=Q(!1);async function w(){Ge.update(m=>!m)}function x(){Ce.update(m=>Math.min(1e4,m+60))}function I(){Ce.update(m=>Math.max(10,m-60))}function T(){bt.update(m=>m*-1)}async function L(){if(!s())return;Xe.set(!0);const k=Date.now();Be.set({active:!0,progress:0,startTime:k})}async function C(){const m=s();if(!m)return;P(t,!0),Xe.set(!1);const k=Date.now();Be.set({active:!0,progress:0,startTime:k}),d()||requestAnimationFrame(()=>{});try{const N=await Le(m);let B=null;try{typeof cv<"u"&&Nt&&(B=Nt(N))}catch(me){console.warn("cv detect failed, falling back",me)}B||(B={x:N.width/2,y:N.height/2,r:Math.min(N.width,N.height)/2*.9});const re=await Bn(N,B,{samples:720}),ge=2e3-(Date.now()-k);ge>0&&await new Promise(me=>setTimeout(me,ge)),Mt.set(B),Ft.set(re.count),Ht.set(re.positions||[]);const He=(re.count>0?360/re.count:1)*30;mt.set(He),Be.set({active:!1,progress:1,startTime:k})}finally{P(t,!1)}}function A(){mt.subscribe(m=>{m&&Ce.set(m)})()}function ee(){Xe.set(!1),Be.set({active:!1,progress:0,startTime:0})}let G=Q(0);function se(){const m=Number(n(G))||0;m<=0||Ce.set(m)}let F=Q(!1);async function E(){const m=s()||ut(We);if(!m)return alert("No image loaded to export.");if(!n(g))return alert("Please detect the circle before exporting the GIF.");const k=await Le(m),N=document.createElement("canvas");N.width=k.width,N.height=k.height,N.getContext("2d").drawImage(k,0,0,k.width,k.height),P(F,!0);try{const re=n(W)||24,Pe=n(g),ge=Pe.r*2*1.1,Te=Math.min(480,Math.round(ge)),Qe=Number(ut(Ce)||0),He=Number(ut(bt)||1),me=Vn(N,re,{circle:Pe,outputSize:Te,margin:1.05,zoom:1,fps:24,rotationSpeed:Qe,direction:He}),lt=await tr(me,24),Ye=document.createElement("a");Ye.href=lt,Ye.download="phenaki-export.gif",document.body.appendChild(Ye),Ye.click(),Ye.remove()}catch(re){console.error("GIF export failed",re),alert("GIF export failed: "+(re&&re.message))}finally{P(F,!1)}}let W=Q(24);const J="phenaki.speedControlPos";let M=Q({left:null,top:null}),K=Q(!1),ie=Q(!1),ue={x:0,y:0},ve={left:0,top:0},R=0;function ye(){try{const m=localStorage.getItem(J);m&&P(M,JSON.parse(m))}catch{}}function be(){try{localStorage.setItem(J,JSON.stringify(n(M)))}catch{}}function st(m){const k=Date.now(),N=k-R<300;if(R=k,m.target&&m.target.closest&&m.target.closest("button"))return;const B=m.target&&m.target.closest&&m.target.closest(".drag-handle");if(!(!N&&!B)){P(K,!0),P(ie,!0),ue={x:m.clientX,y:m.clientY},ve={left:n(M).left??Math.round((window.innerWidth-200)/2),top:n(M).top??Math.round((window.innerHeight-80)/2)};try{m.target.setPointerCapture(m.pointerId)}catch{}window.addEventListener("pointermove",De),window.addEventListener("pointerup",Ue)}}function De(m){if(!n(ie))return;const k=m.clientX-ue.x,N=m.clientY-ue.y;X(M,n(M).left=Math.round(ve.left+k)),X(M,n(M).top=Math.round(ve.top+N))}function Ue(m){P(ie,!1),P(K,!1);try{m.target.releasePointerCapture&&m.target.releasePointerCapture(m.pointerId)}catch{}window.removeEventListener("pointermove",De),window.removeEventListener("pointerup",Ue),be()}Et(()=>{ye(),n(M).left==null&&X(M,n(M).left=Math.round((window.innerWidth-200)/2)),n(M).top==null&&X(M,n(M).top=Math.round((window.innerHeight-80)/2));function m(){const ge=Math.max(8,window.innerWidth-200-8),Te=Math.max(8,window.innerHeight-80-8);n(M).left==null&&X(M,n(M).left=ge),n(M).top==null&&X(M,n(M).top=Te),X(M,n(M).left=Math.min(Math.max(n(M).left,8),ge)),X(M,n(M).top=Math.min(Math.max(n(M).top,8),Te))}m();const k=()=>{m(),be()};return window.addEventListener("resize",k),()=>window.removeEventListener("resize",k)});function Le(m){return new Promise((k,N)=>{const B=new Image;B.crossOrigin="anonymous",B.onload=()=>k(B),B.onerror=N,B.src=m})}Ie(()=>p(),()=>{P(G,Number(p()||0))}),Ie(()=>a(),()=>{P(g,a())}),Ie(()=>l(),()=>{P(y,l())}),Ie(()=>u(),()=>{P(h,u())}),Ie(()=>b(),()=>{P(r,b())}),Pt(),rt();var Re=lr(),je=j(Re);{var Ke=m=>{var k=nr();ae(m,k)};Ae(je,m=>{n(F)&&m(Ke)})}var Oe=D(je,2),de=j(Oe),Fe=j(de,!0);z(de);var ze=D(de,2),Ze=D(ze,2);{var it=m=>{var k=rr(),N=_t(k),B=D(N,2);$e(()=>N.disabled=n(t)),ce("click",N,C),ce("click",B,ee),ae(m,k)},_=m=>{var k=sr();$e(()=>{ht(k,1,Dt(n(g)?"":"detect-btn-required"),"svelte-14nyow8"),k.disabled=n(t)||!s()}),ce("click",k,L),ae(m,k)};Ae(Ze,m=>{v()?m(it):m(_,!1)})}var S=D(Ze,2),O=D(S,2),q=j(O,!0);z(O);var H=D(O,2),U=D(j(H),2);pt(U),z(H);var Me=D(H,2),ke=j(Me);pt(ke),nt(2),z(Me),z(Oe);var $=D(Oe,2);{var te=m=>{var k=ar(),N=j(k);{var B=me=>{var lt=ir();ae(me,lt)};Ae(N,me=>{n(K)&&me(B)})}var re=D(N,2),Pe=j(re),ge=D(Pe,2),Te=j(ge),Qe=j(Te);z(Te),nt(2),z(ge);var He=D(ge,2);z(re),z(k),$e(me=>{ht(k,1,`speed-control ${n(K)?"dragMode":""} ${n(ie)?"dragging":""}`,"svelte-14nyow8"),Dn(k,`left: ${n(M),xe(()=>n(M).left??16)??""}px; top: ${n(M),xe(()=>n(M).top??16)??""}px;`),Ee(Qe,`${me??""}°/s`)},[()=>(p(),xe(()=>p().toFixed(0)))]),ce("click",Pe,I),ce("click",He,x),ce("pointerdown",k,st),ae(m,k)};Ae($,m=>{a()&&m(te)})}var ne=D($,2),Y=j(ne),Z=j(Y),le=D(j(Z));nt(),z(Z);var _e=D(Z,2),he=D(j(_e),2);pt(he);var qe=D(he,2);z(_e),z(Y);var Se=D(Y,2),at=D(j(Se));z(Se);var ot=D(Se,2),Yt=D(j(ot));z(ot);var Xt=D(ot,2);{var Bt=m=>{var k=or(),N=D(j(k));z(k),$e((B,re,Pe)=>Ee(N,` x=${B??""}, y=${re??""}, r=${Pe??""}`),[()=>(n(g),xe(()=>Math.round(n(g).x))),()=>(n(g),xe(()=>Math.round(n(g).y))),()=>(n(g),xe(()=>Math.round(n(g).r)))]),ae(m,k)};Ae(Xt,m=>{n(g)&&m(Bt)})}z(ne),z(Re),$e((m,k)=>{ht(de,1,Dt(n(g)&&!d()?"play-highlight":""),"svelte-14nyow8"),Ee(Fe,d()?"Pause":"Play"),S.disabled=!n(h),O.disabled=n(F)||!i(),Ee(q,n(F)?"Exporting...":"Save GIF"),Fn(ke,n(r)),Ee(le,` ${m??""}°/s | `),Ee(at,` ${n(y)??0??""}`),Ee(Yt,` ${k??""}°/s`)},[()=>(p(),xe(()=>p().toFixed(0))),()=>(n(h),xe(()=>n(h)?n(h).toFixed(0):"—"))]),ce("click",de,w),ce("click",ze,T),ce("click",S,A),ce("click",O,E),Ot(U,()=>n(W),m=>P(W,m)),ce("change",ke,m=>kt.set(m.target.checked)),Ot(he,()=>n(G),m=>P(G,m)),ce("click",qe,se),ae(e,Re),Je(),f()}var fr=fe("<option> </option>"),ur=fe('<div class="selector svelte-ai08gq"><label for="samples" class="svelte-ai08gq">Sample Images:</label> <select id="samples" class="svelte-ai08gq"><option>-- Choose a sample --</option><!></select></div>');function dr(e,o){Ve(o,!1);const s="https://raw.githubusercontent.com/tclaret/phenakistoscope-simulator/main/images",d="https://raw.githubusercontent.com/tclaret/phenaki-lab/main/img",p=[{name:"Woman Chopping Tree",file:"WomanChoppingTree.jpg",repo:"old"},{name:"Dancing",file:"Dancing.jpg",repo:"old"},{name:"Jongleur",file:"Jongleur.png",repo:"old"},{name:"a_cheval",file:"a_cheval.png",repo:"old"},{name:"McLean_1",file:"McLean_1.png",repo:"old"},{name:"Gernamy_1949",file:"Gernamy_1949_R_Balzer.png",repo:"old"},{name:"AEO175939",file:"AEO175939_PhenakistoscopeGiroux60.jpg",repo:"old"},{name:"AEO185553",file:"AEO185553_PhenakistiscopeDisc_ManInBlueAndRed.jpg",repo:"old"},{name:"medium_1990_5036_3369",file:"medium_1990_5036_3369.jpg",repo:"old"},{name:"medium_a001813b",file:"medium_a001813b.jpg",repo:"old"},{name:"tumblr_obd6fh",file:"tumblr_obd6fhGFSZ1r9jbwno1_500.png",repo:"old"},{name:"tumblr_oc1cz",file:"tumblr_oc1czn99ZM1r9jbwno1_500.png",repo:"old"},{name:"Phantasmascope Faces",file:"Phantasmascope_faces.png",repo:"old"},{name:"722a6790240569.5e126845d9b56",file:"722a6790240569.5e126845d9b56.png",repo:"old"},{name:"Fantascope Disc 1833",file:"fantascope-disc-1833.png",repo:"old"},{name:"Face",file:"_face__.jpg",repo:"new"},{name:"Culbute",file:"culbute.jpg",repo:"new"},{name:"Grenouille",file:"Grenouille__.jpg",repo:"new"},{name:"Oh Soccer",file:"oh_soccer.jpg",repo:"new"},{name:"Un Grand Un Petit",file:"un_grand_un_petit.jpg",repo:"new"},{name:"Autre Culbutte",file:"autre_culbutte.jpg",repo:"new"},{name:"Dancing 2",file:"dancing_.jpg",repo:"new"},{name:"Il Pompe de l'eau",file:"il_pompe_de_leau.jpg",repo:"new"},{name:"Porceline",file:"porceline.jpg",repo:"new"},{name:"Volants",file:"volants_.png",repo:"new"},{name:"Ce Qui",file:"ce_qui.jpg",repo:"new"},{name:"Des Anges",file:"des_anges.jpg",repo:"new"},{name:"Moulin",file:"moulin_.jpg",repo:"new"},{name:"Rats",file:"rats__.jpg",repo:"new"},{name:"Corde à Danser",file:"corde_a_denser_.jpg",repo:"new"},{name:"Ecureuil",file:"ecureuil.jpg",repo:"new"},{name:"Noel Noel",file:"noel_noel.jpg",repo:"new"},{name:"Tirreur",file:"tirreur_.jpg",repo:"new"},{name:"C Pastel",file:"c_pastel.jpg",repo:"new"},{name:"Géométrique",file:"geometrique.jpg",repo:"new"},{name:"Nuages en Scie",file:"nuages_en_scie.jpg",repo:"new"},{name:"Tons Pastels",file:"tons_pastels.jpg",repo:"new"}];function a(i){const f=`${i.repo==="new"?d:s}/${i.file}`;We.set(f),Ct.set(f),Ge.set(!0)}Et(()=>{let i=!1;if(We.subscribe(f=>{f&&(i=!0)})(),!i){const f=p[Math.floor(Math.random()*p.length)];f&&a(f)}}),rt();var l=ur(),u=D(j(l),2),b=j(u);b.value=b.__value="";var v=D(b);Tn(v,1,()=>p,i=>i.file,(i,c)=>{var f=fr(),g=j(f,!0);z(f);var y={};$e(()=>{Ee(g,n(c).name),y!==(y=n(c).file)&&(f.value=(f.__value=n(c).file)??"")}),ae(i,f)}),z(u),z(l),ce("change",u,i=>{const c=i.target.selectedIndex-1;c>=0&&a(p[c])}),ae(e,l),Je()}var hr=fe('<div class="container svelte-1uha8ag"><h1 class="svelte-1uha8ag">Phenakistoscope Lab</h1> <p class="sub svelte-1uha8ag">Convert old phenakistoscope discs into animated GIFs</p> <!> <!> <!> <!> <!></div>');function xr(e){var o=hr(),s=D(j(o),4);jn(s,{});var d=D(s,2);dr(d,{});var p=D(d,2);qn(p,{});var a=D(p,2);Xn(a,{});var l=D(a,2);cr(l,{}),z(o),ae(e,o)}export{xr as component};
