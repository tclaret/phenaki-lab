import{f as he,a as F,c as ct,t as we}from"../chunks/DidSmI2s.js";import"../chunks/BfDn8e9k.js";import{G as La,v as ze,w as Ra,g as e,av as za,I as Oa,J as Ha,K as aa,L as ia,M as En,D as rn,a3 as Wa,aq as Na,aa as ja,x as ft,C as On,B as pa,F as Ga,Q as ee,a1 as sa,ao as ha,aI as Bn,aJ as Ua,y as va,A as Ya,aK as Xa,aL as Ba,aM as An,ak as Va,aN as Ja,aO as Ka,an as Za,z as Qa,aP as Vn,N as ei,R as ti,aQ as ni,aR as ai,aS as ga,aT as ii,aU as si,aV as ri,P as oi,aW as li,aX as ci,b as Ve,O as ma,aG as fi,p as Kt,j as Zt,s as x,k as D,l as q,aY as Ie,aZ as Jn,i as Xe,U as T,t as Te,a_ as re,ab as cn,a$ as ba}from"../chunks/CkcJ_p-v.js";import{e as W,s as Re}from"../chunks/EstrOUTn.js";import{i as un}from"../chunks/BeJGQpUk.js";import{w as oe,o as Kn,a as di,g as on}from"../chunks/BzLubvRb.js";import{i as ae,s as pn,a as B,b as ra,d as ui}from"../chunks/CgM4jgzu.js";function pi(t,s,a){for(var o=[],d=s.length,r=0;r<d;r++)Ja(s[r].e,o,!0);Ka(o,()=>{var c=o.length===0&&a!==null;if(c){var u=a,M=u.parentNode;Za(M),M.append(u),t.items.clear(),Be(t,s[0].prev,s[d-1].next)}for(var h=0;h<d;h++){var l=s[h];c||(t.items.delete(l.k),Be(t,l.prev,l.next)),Qa(l.e,!c)}t.first===s[0]&&(t.first=s[0].prev)})}function hi(t,s,a,o,d,r=null){var c=t,u=new Map,M=null;ze&&Ra();var h=null,l=za(()=>{var i=a();return Bn(i)?i:i==null?[]:ha(i)}),_,m=!0;function $(){vi(b,_,c,s,o),h!==null&&(_.length===0?(h.fragment?(c.before(h.fragment),h.fragment=null):va(h.effect),P.first=h.effect):Ya(h.effect,()=>{h=null}))}var P=La(()=>{_=e(l);var i=_.length;let v=!1;if(ze){var g=Oa(c)===Ha;g!==(i===0)&&(c=aa(),ia(c),En(!1),v=!0)}for(var y=new Set,A=ft,w=null,C=Ga(),n=0;n<i;n+=1){ze&&rn.nodeType===Wa&&rn.data===Na&&(c=rn,v=!0,En(!1));var te=_[n],L=o(te,n),ie=m?null:u.get(L);ie?(ja(ie.v,te),ie.i=n,C&&A.skipped_effects.delete(ie.e)):(ie=gi(m?c:null,w,te,L,n,d,s,a),m&&(ie.o=!0,w===null?M=ie:w.next=ie,w=ie),u.set(L,ie)),y.add(L)}if(i===0&&r&&!h)if(m)h={fragment:null,effect:On(()=>r(c))};else{var fe=document.createDocumentFragment(),ne=pa();fe.append(ne),h={fragment:fe,effect:On(()=>r(ne))}}if(ze&&i>0&&ia(aa()),!m)if(C){for(const[E,N]of u)y.has(E)||A.skipped_effects.add(N.e);A.oncommit($),A.ondiscard(()=>{})}else $();v&&En(!0),e(l)}),b={effect:P,items:u,first:M};m=!1,ze&&(c=rn)}function vi(t,s,a,o,d){var r=s.length,c=t.items,u=t.first,M,h=null,l=[],_=[],m,$,P,b;for(b=0;b<r;b+=1){if(m=s[b],$=d(m,b),P=c.get($),t.first??=P,!P.o){P.o=!0;var i=h?h.next:u;Be(t,h,P),Be(t,P,i),Dn(P,i,a),h=P,l=[],_=[],u=h.next;continue}if((P.e.f&An)!==0&&va(P.e),P!==u){if(M!==void 0&&M.has(P)){if(l.length<_.length){var v=_[0],g;h=v.prev;var y=l[0],A=l[l.length-1];for(g=0;g<l.length;g+=1)Dn(l[g],v,a);for(g=0;g<_.length;g+=1)M.delete(_[g]);Be(t,y.prev,A.next),Be(t,h,y),Be(t,A,v),u=v,h=A,b-=1,l=[],_=[]}else M.delete(P),Dn(P,u,a),Be(t,P.prev,P.next),Be(t,P,h===null?t.first:h.next),Be(t,h,P),h=P;continue}for(l=[],_=[];u!==null&&u.k!==$;)(u.e.f&An)===0&&(M??=new Set).add(u),_.push(u),u=u.next;if(u===null)continue;P=u}l.push(P),h=P,u=P.next}let w=c.size>r;if(u!==null||M!==void 0){for(var C=M===void 0?[]:ha(M);u!==null;)(u.e.f&An)===0&&C.push(u),u=u.next;var n=C.length;if(w=c.size-n>r,n>0){var te=null;pi(t,C,te)}}if(w)for(const L of c.values())L.o||(Be(t,h,L),h=L);t.effect.last=h&&h.e}function gi(t,s,a,o,d,r,c,u){var M=(c&Xa)!==0,h=(c&Ba)===0,l=M?h?ee(a,!1,!1):sa(a):a,_=(c&Ua)===0?d:sa(d),m={i:_,v:l,k:o,a:null,e:null,o:!1,prev:s,next:null};try{if(t===null){var $=document.createDocumentFragment();$.append(t=pa())}return m.e=On(()=>r(t,l,_,u)),s!==null&&(s.next=m),m}finally{}}function Dn(t,s,a){for(var o=t.next?t.next.e.nodes_start:a,d=s?s.e.nodes_start:a,r=t.e.nodes_start;r!==null&&r!==o;){var c=Va(r);d.before(r),r=c}}function Be(t,s,a){s===null?(t.first=a,t.effect.first=a&&a.e):(s.e.next&&(s.e.next.prev=null),s.next=a,s.e.next=a&&a.e),a!==null&&(a.e.prev&&(a.e.prev.next=null),a.prev=s,a.e.prev=s&&s.e)}function wa(t){var s,a,o="";if(typeof t=="string"||typeof t=="number")o+=t;else if(typeof t=="object")if(Array.isArray(t)){var d=t.length;for(s=0;s<d;s++)t[s]&&(a=wa(t[s]))&&(o&&(o+=" "),o+=a)}else for(a in t)t[a]&&(o&&(o+=" "),o+=a);return o}function mi(){for(var t,s,a=0,o="",d=arguments.length;a<d;a++)(t=arguments[a])&&(s=wa(t))&&(o&&(o+=" "),o+=s);return o}function oa(t){return typeof t=="object"?mi(t):t??""}const la=[...` 	
\r\fÂ \v\uFEFF`];function bi(t,s,a){var o=t==null?"":""+t;if(s&&(o=o?o+" "+s:s),a){for(var d in a)if(a[d])o=o?o+" "+d:d;else if(o.length)for(var r=d.length,c=0;(c=o.indexOf(d,c))>=0;){var u=c+r;(c===0||la.includes(o[c-1]))&&(u===o.length||la.includes(o[u]))?o=(c===0?"":o.substring(0,c))+o.substring(u+1):c=u}}return o===""?null:o}function wi(t,s){return t==null?null:String(t)}function fn(t,s,a,o,d,r){var c=t.__className;if(ze||c!==a||c===void 0){var u=bi(a,o,r);(!ze||u!==t.getAttribute("class"))&&(u==null?t.removeAttribute("class"):t.className=u),t.__className=a}else if(r&&d!==r)for(var M in r){var h=!!r[M];(d==null||h!==!!d[M])&&t.classList.toggle(M,h)}return r}function lt(t,s,a,o){var d=t.__style;if(ze||d!==s){var r=wi(s);(!ze||r!==t.getAttribute("style"))&&(r==null?t.removeAttribute("style"):t.style.cssText=r),t.__style=s}return o}function _a(t,s,a=!1){if(t.multiple){if(s==null)return;if(!Bn(s))return ni();for(var o of t.options)o.selected=s.includes(Bt(o));return}for(o of t.options){var d=Bt(o);if(ai(d,s)){o.selected=!0;return}}(!a||s!==void 0)&&(t.selectedIndex=-1)}function _i(t){var s=new MutationObserver(()=>{_a(t,t.__value)});s.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),ti(()=>{s.disconnect()})}function ya(t,s,a=s){var o=new WeakSet,d=!0;Vn(t,"change",r=>{var c=r?"[selected]":":checked",u;if(t.multiple)u=[].map.call(t.querySelectorAll(c),Bt);else{var M=t.querySelector(c)??t.querySelector("option:not([disabled])");u=M&&Bt(M)}a(u),ft!==null&&o.add(ft)}),ei(()=>{var r=s();if(t===document.activeElement){var c=ga??ft;if(o.has(c))return}if(_a(t,r,d),d&&r===void 0){var u=t.querySelector(":checked");u!==null&&(r=Bt(u),a(r))}t.__value=r,d=!1}),_i(t)}function Bt(t){return"__value"in t?t.__value:t.value}const yi=Symbol("is custom element"),xi=Symbol("is html");function Gt(t){if(ze){var s=!1,a=()=>{if(!s){if(s=!0,t.hasAttribute("value")){var o=t.value;dn(t,"value",null),t.value=o}if(t.hasAttribute("checked")){var d=t.checked;dn(t,"checked",null),t.checked=d}}};t.__on_r=a,oi(a),li()}}function ca(t,s){var a=Zn(t);a.value===(a.value=s??void 0)||t.value===s&&(s!==0||t.nodeName!=="PROGRESS")||(t.value=s??"")}function Mi(t,s){var a=Zn(t);a.checked!==(a.checked=s??void 0)&&(t.checked=s)}function dn(t,s,a,o){var d=Zn(t);ze&&(d[s]=t.getAttribute(s),s==="src"||s==="srcset"||s==="href"&&t.nodeName==="LINK")||d[s]!==(d[s]=a)&&(s==="loading"&&(t[ci]=a),a==null?t.removeAttribute(s):typeof a!="string"&&ki(t).includes(s)?t[s]=a:t.setAttribute(s,a))}function Zn(t){return t.__attributes??={[yi]:t.nodeName.includes("-"),[xi]:t.namespaceURI===ii}}var fa=new Map;function ki(t){var s=t.getAttribute("is")||t.nodeName,a=fa.get(s);if(a)return a;fa.set(s,a=[]);for(var o,d=t,r=Element.prototype;r!==d;){o=ri(d);for(var c in o)o[c].set&&a.push(c);d=si(d)}return a}function Si(t,s,a=s){var o=new WeakSet;Vn(t,"input",async d=>{var r=d?t.defaultValue:t.value;if(r=qn(t)?Fn(r):r,a(r),ft!==null&&o.add(ft),await fi(),r!==(r=s())){var c=t.selectionStart,u=t.selectionEnd,M=t.value.length;if(t.value=r??"",u!==null){var h=t.value.length;c===u&&u===M&&h>M?(t.selectionStart=h,t.selectionEnd=h):(t.selectionStart=c,t.selectionEnd=Math.min(u,h))}}}),(ze&&t.defaultValue!==t.value||Ve(s)==null&&t.value)&&(a(qn(t)?Fn(t.value):t.value),ft!==null&&o.add(ft)),ma(()=>{var d=s();if(t===document.activeElement){var r=ga??ft;if(o.has(r))return}qn(t)&&d===Fn(t.value)||t.type==="date"&&!d&&!t.value||d!==t.value&&(t.value=d??"")})}function Pi(t,s,a=s){Vn(t,"change",o=>{var d=o?t.defaultChecked:t.checked;a(d)}),(ze&&t.defaultChecked!==t.checked||Ve(s)==null)&&a(t.checked),ma(()=>{var o=s();t.checked=!!o})}function qn(t){var s=t.type;return s==="number"||s==="range"}function Fn(t){return t===""?null:+t}function ke(t){return function(...s){var a=s[0];return a.stopPropagation(),t?.apply(this,s)}}function It(t,s){var a=t.$$events?.[s.type],o=Bn(a)?a.slice():a==null?[]:[a];for(var d of o)d.call(this,s)}const Qn=oe(null),$t=oe(null),da=oe(null),wt=oe(!1),ht=oe(0),Hn=oe(1),Ut=oe(!1),Wn=oe(null),Nn=oe(0),Ln=oe(1),xa=oe([]),jn=oe(!1),Tt=oe(!1),Vt=oe(!1),Gn=oe({translateX:0,translateY:0,scale:1}),Yt=oe({active:!1,progress:0,startTime:0}),Un=oe(null),Yn=oe(!1),Ye=oe(50),Xn=oe(!1),Jt=oe(null),Xt=oe(0),Rn=oe("move-center");var Ci=he('<label>Choose image: <input type="file" accept="image/*"/></label>');function Ii(t,s){Kt(s,!1);function a(r){const c=r.target.files[0];if(!c)return;const u=URL.createObjectURL(c);Qn.set(u),$t.set(u),wt.set(!0)}un();var o=Ci(),d=x(D(o));q(o),W("change",d,a),F(t,o),Zt()}var Ti=he('<div class="preview svelte-1th6cal"><img alt="Selected disc preview" class="svelte-1th6cal"/></div>');function $i(t,s){Kt(s,!1);const a=()=>B(Qn,"$previewUrl",o),[o,d]=pn(),r=ee();Ie(()=>a(),()=>{T(r,a())}),Jn();var c=ct(),u=Xe(c);{var M=h=>{var l=Ti(),_=D(l);q(l),Te(()=>dn(_,"src",e(r))),F(h,l)};ae(u,h=>{e(r)&&h(M)})}F(t,c),Zt(),d()}var Ei=he('<div class="speed-hud svelte-byh4af"> </div>'),Ai=he('<div class="edit-mode-indicator svelte-byh4af"><!></div> <div class="frame-counter svelte-byh4af"><div class="frame-info svelte-byh4af"><div style="font-size: 0.7em; color: #aaa; margin-bottom: 4px; text-align: center;" class="svelte-byh4af">How many scenes on the disc?</div> <div style="font-size: 0.65em; color: #888; text-align: center; margin-bottom: 8px;" class="svelte-byh4af">Set frame count = number of animation scenes</div></div> <div style="display: flex; align-items: center; gap: 8px;" class="svelte-byh4af"><button class="frame-btn svelte-byh4af" title="Decrease frame count">âˆ’</button> <div class="frame-display svelte-byh4af"><div class="frame-number svelte-byh4af"> </div> <div class="frame-label svelte-byh4af">frames</div></div> <button class="frame-btn svelte-byh4af" title="Increase frame count">+</button></div></div>',1),Di=he('<div><canvas class="svelte-byh4af"></canvas> <!> <!></div>');function qi(t,s){Kt(s,!1);const a=()=>B(Tt,"$editMode",y),o=()=>B(wt,"$isPlaying",y),d=()=>B($t,"$imageUrl",y),r=()=>B(Jt,"$gifFrameCount",y),c=()=>B(Xn,"$isMobile",y),u=()=>B(ht,"$rotationSpeed",y),M=()=>B(Rn,"$editModeInteraction",y),h=()=>B(Xt,"$sliceRotationAngle",y),l=()=>B(Yt,"$detectionAnimation",y),_=()=>B(Hn,"$rotationDirection",y),m=()=>B(Wn,"$detectedCircle",y),$=()=>B(jn,"$overlayVisible",y),P=()=>B(Nn,"$detectedCount",y),b=()=>B(xa,"$detectedPositions",y),i=()=>B(Vt,"$confirmedDetection",y),v=()=>B(Yn,"$flickerEnabled",y),g=()=>B(Ye,"$flickerFrequency",y),[y,A]=pn();let w=ee(),C=ee(),n,te=0,L=ee(1);const ie=1,fe=4;let ne=ee(0),E=ee(0);const N=new Map;let de=1,Se=0,We=0,Ae=0,ue=ee(),Ne=1,tt=0,je=ee(0),dt=0,Je=1,Ke=ee(!1),Oe,U=0,vt=0,gt=0,_t=0,yt=0,G=ee(null),nt=ee(!1),at;function hn(p){T(nt,!1),T(G,new Image),re(G,e(G).crossOrigin="anonymous"),re(G,e(G).onload=()=>{console.log("Image loaded:",p,"Size:",e(G).width,"x",e(G).height),T(nt,!0),xt(),ve()}),re(G,e(G).onerror=I=>{console.error("Erreur chargement:",p,I),T(nt,!1)}),re(G,e(G).src=p)}function xt(){if(!e(C)||!e(w))return;const p=e(w).getBoundingClientRect(),I=window.devicePixelRatio||1;if(e(G)&&e(G).width&&e(G).height){const H=e(G).width,K=e(G).height,Q=Math.min(1400,Math.max(150,Math.round(p.width*Math.sqrt(H*H+K*K)/H)));re(w,e(w).style.height=Q+"px");const j=e(w).getBoundingClientRect();re(C,e(C).style.width=j.width+"px"),re(C,e(C).style.height=j.height+"px"),re(C,e(C).width=Math.round(j.width*I)),re(C,e(C).height=Math.round(j.height*I))}else re(C,e(C).style.width=p.width+"px"),re(C,e(C).style.height=p.height+"px"),re(C,e(C).width=Math.round(p.width*I)),re(C,e(C).height=Math.round(p.height*I));n&&n.setTransform(I,0,0,I,0,0),ve()}Kn(()=>{const p=()=>{const H="ontouchstart"in window||navigator.maxTouchPoints>0||window.innerWidth<768;Xn.set(H)};if(p(),window.addEventListener("resize",p),e(C)){if(Un.set(e(C)),n=e(C).getContext("2d"),e(w)){const I=()=>{c()?e(L)>1||a()?re(w,e(w).style.touchAction="none"):re(w,e(w).style.touchAction="pan-y"):re(w,e(w).style.touchAction="none")};I(),Gn.subscribe(I),Tt.subscribe(I)}e(w)&&e(w).addEventListener("wheel",Qt,{passive:!1}),xt(),at=new ResizeObserver(()=>xt()),e(w)&&at.observe(e(w)),e(w)&&(e(w).addEventListener("pointerdown",Et),e(w).addEventListener("pointermove",At),e(w).addEventListener("pointerup",Mt),e(w).addEventListener("pointerleave",Dt))}return()=>{at&&at.disconnect(),window.removeEventListener("resize",p)}});function Et(p){if(!e(w))return;(a()||e(L)>1)&&(p.preventDefault(),p.stopPropagation()),e(w).setPointerCapture(p.pointerId),N.set(p.pointerId,{x:p.clientX,y:p.clientY});const I=Date.now(),H=p.clientX-vt,K=p.clientY-gt,Q=Math.sqrt(H*H+K*K);if(I-U<300&&Q<50){a()?(Rn.update(j=>j==="move-center"?"rotate-slices":"move-center"),ve()):wt.update(j=>!j),N.clear(),U=0;return}if(U=I,vt=p.clientX,gt=p.clientY,N.size===1&&(We=p.clientX,Ae=p.clientY,dt=p.clientY,Je=u()||1,a()&&M()==="rotate-slices")){const j=e(w).getBoundingClientRect(),ge=e(C).clientWidth,$e=e(C).clientHeight,xe=j.left+ge/2,Pe=j.top+$e/2,O=p.clientX-xe,Y=p.clientY-Pe;yt=Math.atan2(Y,O),_t=h()}if(N.size===2){const j=Array.from(N.values());de=e(L),Ne=e(L),Se=Math.hypot(j[0].x-j[1].x,j[0].y-j[1].y)}}function At(p){if(e(w)){if((a()||e(L)>1)&&N.has(p.pointerId)&&(p.preventDefault(),p.stopPropagation()),N.has(p.pointerId)&&N.set(p.pointerId,{x:p.clientX,y:p.clientY}),N.size===2){const I=Array.from(N.values()),H=I[0],K=I[1],j=Math.hypot(H.x-K.x,H.y-K.y)/Se;let ge=Math.max(ie,Math.min(fe,de*j));c()&&(Ne=ge,ge=e(L)+(Ne-e(L))*.3);const $e={x:(H.x+K.x)/2,y:(H.y+K.y)/2},xe=e(C).clientWidth,Pe=e(C).clientHeight,O=e(w).getBoundingClientRect(),Y=$e.x-(O.left+xe/2)-e(ne),z=$e.y-(O.top+Pe/2)-e(E),k=e(L),R=ge;if(T(ne,e(ne)-(R/k-1)*Y),T(E,e(E)-(R/k-1)*z),T(L,ge),c()){const se=Date.now();se-tt>16&&(ve(),tt=se)}else ve();T(Ke,!0),clearTimeout(Oe);return}if(N.size===1){if(N.values().next().value,a()&&M()==="rotate-slices"){const I=e(w).getBoundingClientRect(),H=e(C).clientWidth,K=e(C).clientHeight,Q=I.left+H/2,j=I.top+K/2,ge=p.clientX-Q,$e=p.clientY-j,Pe=Math.atan2($e,ge)-yt;Xt.set(_t+Pe),ve();return}if(e(L)>1||a()&&M()==="move-center"){const I=p.clientX-We,H=p.clientY-Ae;T(ne,e(ne)+I),T(E,e(E)+H),We=p.clientX,Ae=p.clientY,ve();return}else if(!c()){const I=dt-p.clientY,K=Math.round(I*8),Q=Math.max(10,Math.min(1e4,Math.round(Je+K)));ht.set(Q),Ut.set(!0),T(Ke,!0),clearTimeout(Oe)}}}}function Mt(p){if(e(w)){try{e(w).releasePointerCapture(p.pointerId)}catch{}clearTimeout(Oe),T(Ke,!0),Oe=setTimeout(()=>{T(Ke,!1)},4e3),N.delete(p.pointerId),N.size===0&&(clearTimeout(Oe),T(Ke,!1),Se=0,Ne=e(L))}}function Dt(){clearTimeout(Oe),T(Ke,!0),Oe=setTimeout(()=>{T(Ke,!1)},4e3)}function Qt(p){if(!e(w)||!p.ctrlKey&&!p.metaKey)return;p.preventDefault();const H=1+(-p.deltaY>0?.1:-.1),K=Math.max(ie,Math.min(fe,e(L)*H)),Q=e(w).getBoundingClientRect(),j=p.clientX-(Q.left+e(C).clientWidth/2)-e(ne),ge=p.clientY-(Q.top+e(C).clientHeight/2)-e(E);T(ne,e(ne)-(K/e(L)-1)*j),T(E,e(E)-(K/e(L)-1)*ge),T(L,K),ve()}di(()=>{e(ue)&&cancelAnimationFrame(e(ue)),at&&at.disconnect(),Oe&&clearTimeout(Oe),e(w)&&(e(w).removeEventListener("pointerdown",Et),e(w).removeEventListener("pointermove",At),e(w).removeEventListener("pointerup",Mt),e(w).removeEventListener("pointerleave",Dt),e(w)&&e(w).removeEventListener("wheel",Qt)),Un.set(null)});function kt(p){const I=o()||l().active||a();if(!I||!e(nt)){T(je,0),!I&&e(ue)&&(cancelAnimationFrame(e(ue)),T(ue,null));return}e(je)||T(je,p);const H=p-e(je);if(T(je,p),o()&&!a()){const K=u()||0;te+=K*(_()||1)*(H/1e3)}ve(),T(ue,requestAnimationFrame(kt))}function ve(){if(!e(nt)||!n||!e(G)||!e(C)){console.log("DrawFrame skipped:",{imageReady:e(nt),ctx:!!n,htmlImg:!!e(G),canvas:!!e(C)});return}const p=e(C).clientWidth,I=e(C).clientHeight;n.clearRect(0,0,p,I),n.save();const H=e(G).width/e(G).height,K=p/I;let Q,j;H>K?(Q=p,j=p/H):(j=I,Q=I*H);const ge=Q*e(L),$e=j*e(L);let xe=0,Pe=0;if(m()){const O=Q/e(G).width;xe=(m().x-e(G).width/2)*O*e(L),Pe=(m().y-e(G).height/2)*O*e(L)}if(n.translate(p/2+e(ne),I/2+e(E)),n.translate(xe,Pe),n.rotate(te*Math.PI/180),n.translate(-xe,-Pe),n.drawImage(e(G),-ge/2,-$e/2,ge,$e),$()&&m())try{const O=m(),Y=Q*e(L)/e(G).width,z=(O.x-e(G).width/2)*Y,k=(O.y-e(G).height/2)*Y,R=O.r*Y,se=Date.now()/1e3,Me=se*Math.PI*.5%(Math.PI*2),me=se*.8%2,be=R*(.8+me*.4),Ze=Math.max(0,.3*(1-me/2));n.beginPath(),n.strokeStyle=`rgba(0, 255, 255, ${Ze})`,n.lineWidth=2,n.arc(z,k,be,0,Math.PI*2),n.stroke(),n.save(),n.translate(z,k),n.rotate(Me),n.strokeStyle="rgba(0, 255, 255, 0.4)",n.lineWidth=2,n.beginPath(),n.moveTo(0,0),n.lineTo(R*1.1,0),n.stroke(),n.restore(),n.strokeStyle="rgba(0, 255, 255, 0.1)",n.lineWidth=1;for(let Ce=0;Ce<8;Ce++){const _e=Ce/8*Math.PI*2;if(n.beginPath(),n.moveTo(z,k),n.lineTo(z+Math.cos(_e)*R,k+Math.sin(_e)*R),n.stroke(),Ce%2===0){const st=Math.round(_e*180/Math.PI%360),Ge=R*1.12,Lt=z+Math.cos(_e)*Ge,Rt=k+Math.sin(_e)*Ge;n.font="bold 10px monospace",n.fillStyle="rgba(0, 255, 255, 0.7)",n.textAlign="center",n.textBaseline="middle",n.fillText(`${st}Â°`,Lt,Rt)}}const it=.6;n.font="11px monospace",n.textAlign="left";const St=z+R*.3,Ft=k-R*.8,Pt=14,nn=[`r = ${Math.round(O.r)}px`,`Î¸ = ${Math.round(Me*180/Math.PI%360)}Â°`,`Ï‰ = ${u()}Â°/s`,`n = ${P()||0}`];n.fillStyle="rgba(0, 0, 0, 0.7)",n.fillRect(St-2,Ft-8,95,nn.length*Pt),nn.forEach((Ce,_e)=>{const st=Ft+_e*Pt,Ge=["rgba(0, 255, 255, ","rgba(255, 0, 255, ","rgba(255, 255, 0, "];n.fillStyle=Ge[_e%3]+it+")",n.fillText(Ce,St,st)}),n.font="bold 10px sans-serif",n.textAlign="center";const an=k+R+25;n.fillStyle="rgba(0, 0, 0, 0.7)",n.fillRect(z-70,an-8,140,16),n.fillStyle="rgba(100, 255, 200, 0.8)",n.fillText("CIRCLE DETECTION",z,an);for(let Ce=0;Ce<6;Ce++){const _e=Ce/6*Math.PI*2+se*.3,st=z+Math.cos(_e)*R,Ge=k+Math.sin(_e)*R;n.beginPath(),n.arc(st,Ge,2,0,Math.PI*2),n.fillStyle=Ce%2===0?"rgba(0, 255, 255, 0.8)":"rgba(255, 0, 255, 0.8)",n.fill()}n.beginPath(),n.lineWidth=2,n.strokeStyle="rgba(0, 255, 255, 0.8)",n.arc(z,k,R,0,Math.PI*2),n.stroke(),n.lineWidth=2;const mt=Math.max(15,R*.15);if(n.beginPath(),n.strokeStyle="rgba(0, 255, 255, 0.9)",n.moveTo(z-mt,k),n.lineTo(z+mt,k),n.moveTo(z,k-mt),n.lineTo(z,k+mt),n.stroke(),b()&&b().length){n.fillStyle="rgba(255, 0, 255, 0.9)";for(const Ce of b()){const _e=Ce.angle,st=z+Math.cos(_e)*R,Ge=k+Math.sin(_e)*R;n.beginPath(),n.arc(st,Ge,2.5,0,Math.PI*2),n.fill()}}}catch(O){console.warn("overlay draw failed",O)}if(a()&&!i())try{let O;if(a()){const Y=l().startTime||0;O=(Y>0?Date.now()-Y:Date.now())%2e3/2e3}else O=Math.min(1,(Date.now()-l().startTime)/2e3);if(n.fillStyle=a()?"rgba(0, 0, 0, 0.5)":"rgba(0, 0, 0, 0.3)",n.fillRect(-Q/2-100,-j/2-100,Q+200,j+200),m()){const Y=m(),z=Q*e(L)/e(G).width,k=(Y.x-e(G).width/2)*z,R=(Y.y-e(G).height/2)*z,se=Y.r*z;n.strokeStyle=`rgba(100, 200, 255, ${.8*(1-O)})`,n.lineWidth=2;for(let Ze=0;Ze<3;Ze++){const it=se*(.3+O*1.2+Ze*.3);n.beginPath(),n.arc(k,R,it,0,Math.PI*2),n.stroke()}n.strokeStyle="rgba(100, 200, 255, 0.9)",n.lineWidth=3;const Me=O*Math.PI*6,me=se*1.8;n.beginPath(),n.moveTo(k,R),n.lineTo(k+Math.cos(Me)*me,R+Math.sin(Me)*me),n.stroke();const be=4+Math.sin(O*Math.PI*4)*2;n.fillStyle=`rgba(100, 200, 255, ${.9*Math.sin(O*Math.PI)})`,n.beginPath(),n.arc(k,R,be,0,Math.PI*2),n.fill(),n.fillStyle=`rgba(100, 200, 255, ${Math.sin(O*Math.PI)})`,n.font="bold 14px sans-serif",n.textAlign="center",n.fillText("SCANNING...",k,R-se-20)}else{const Y=Math.max(Q,j)/2;n.strokeStyle=`rgba(100, 200, 255, ${.6})`,n.lineWidth=2;for(let k=0;k<4;k++){const R=Y*(O+k*.25)%1,se=1-R;n.strokeStyle=`rgba(100, 200, 255, ${se*.6})`,n.beginPath(),n.arc(0,0,R*Y,0,Math.PI*2),n.stroke()}n.strokeStyle="rgba(100, 200, 255, 0.8)",n.lineWidth=3;const z=O*Math.PI*4;n.beginPath(),n.moveTo(0,0),n.lineTo(Math.cos(z)*Y,Math.sin(z)*Y),n.stroke(),n.fillStyle=`rgba(100, 200, 255, ${.8+.2*Math.sin(O*Math.PI*4)})`,n.font="bold 18px sans-serif",n.textAlign="center",a()?(n.fillText("âš™ï¸ EDIT MODE - ADJUST POSITION & ZOOM",0,-60),n.font="bold 16px sans-serif",n.fillStyle="rgba(255, 200, 100, 0.95)",n.fillText("ðŸŽ¯ Align crosshair with rotation center",0,-20),n.font="14px sans-serif",n.fillStyle="rgba(200, 255, 200, 0.9)",n.fillText("ðŸ‘† Drag to move  â€¢  ðŸ” Scroll/Pinch to zoom",0,20),n.font="bold 14px sans-serif",n.fillStyle="rgba(100, 255, 100, 0.9)",n.fillText('Click "Confirm Detection" when ready',0,60)):(n.fillText("ANALYZING IMAGE...",0,-20),n.font="12px sans-serif",n.fillText(`${Math.round(O*100)}%`,0,10))}}catch(O){console.warn("radar animation failed",O)}if(v()&&o()){const O=1e3/g(),Y=e(je)%O/O,z=Math.max(0,Math.min(1,(g()-40)/30));let k;if(z<.33?k=Y>.5?.85:0:z<.67?k=Math.sin(Y*Math.PI*2)*.5+.5>.6?.6:0:k=(Math.sin(Y*Math.PI*2)*.5+.5)*.3,k>.05){const be=n.createRadialGradient(p/2,I/2,0,p/2,I/2,Math.max(p,I)*.8);be.addColorStop(0,`rgba(0, 0, 0, ${k*.7})`),be.addColorStop(.5,`rgba(0, 0, 0, ${k})`),be.addColorStop(1,`rgba(0, 0, 0, ${k*.9})`),n.fillStyle=be,n.fillRect(-p,-I,p*3,I*3),z<.5&&(n.fillStyle=`rgba(20, 20, 40, ${k*.15})`,n.fillRect(-p,-I,p*3,I*3))}n.save(),n.translate(p/2,I/2);const R=-p/2+15,se=-I/2+15;let Me,me;g()<50?(Me="rgba(255, 100, 100, 0.9)",me="FLICKER"):g()<60?(Me="rgba(255, 180, 50, 0.9)",me="THRESHOLD"):(Me="rgba(100, 220, 100, 0.9)",me="FUSED"),n.fillStyle="rgba(0, 0, 0, 0.75)",n.beginPath(),n.roundRect(R,se,85,18,4),n.fill(),n.font="bold 11px monospace",n.fillStyle=Me,n.textAlign="left",n.textBaseline="middle",n.fillText(`${g()}Hz`,R+5,se+9),n.font="9px sans-serif",n.fillStyle="rgba(255, 255, 255, 0.7)",n.fillText(me,R+42,se+9),n.restore()}if(n.restore(),a()||i()){const O=Date.now()%1e3/1e3,Y=.7+.3*Math.sin(O*Math.PI*2);n.save(),n.translate(p/2,I/2);const z=r()||P()||12;if(a()&&z>0){const R=Math.min(p,I)*.3,se=Math.PI*2/z,Me=h();for(let me=0;me<z;me++){const be=me*se-Math.PI/2+Me,Ze=be+se,it=.15+.1*(me%2*.5);n.fillStyle=`rgba(100, 200, 255, ${it})`,n.beginPath(),n.moveTo(0,0),n.arc(0,0,R,be,Ze),n.closePath(),n.fill(),n.strokeStyle=`rgba(100, 200, 255, ${.4*Y})`,n.lineWidth=2,n.beginPath(),n.moveTo(0,0),n.lineTo(Math.cos(be)*R,Math.sin(be)*R),n.stroke()}n.strokeStyle=`rgba(100, 200, 255, ${.5*Y})`,n.lineWidth=3,n.beginPath(),n.arc(0,0,R,0,Math.PI*2),n.stroke()}n.strokeStyle=`rgba(255, 100, 0, ${Y})`,n.lineWidth=4;const k=Math.min(p,I)*.1;n.beginPath(),n.arc(0,0,k*.7,0,Math.PI*2),n.stroke(),n.lineWidth=3,n.beginPath(),n.moveTo(-k,0),n.lineTo(k,0),n.stroke(),n.beginPath(),n.moveTo(0,-k),n.lineTo(0,k),n.stroke(),n.beginPath(),n.arc(0,0,10+3*Math.sin(O*Math.PI*2),0,Math.PI*2),n.fillStyle=`rgba(255, 100, 0, ${Y})`,n.fill(),n.strokeStyle="rgba(255, 255, 255, 0.9)",n.lineWidth=2,n.stroke(),n.beginPath(),n.arc(0,0,3,0,Math.PI*2),n.fillStyle="rgba(255, 255, 255, 0.95)",n.fill(),n.restore()}}Ie(()=>(a(),Xt),()=>{a()?(T(ne,0),T(E,0),T(L,1),Rn.set("move-center"),ve()):Xt.set(0)}),Ie(()=>(e(ne),e(E),e(L)),()=>{Gn.set({translateX:e(ne),translateY:e(E),scale:e(L)})}),Ie(()=>(o(),Vt),()=>{o()&&Vt.set(!1)}),Ie(()=>(d(),e(G)),()=>{d()?hn(d()):(e(G)&&T(G,null),T(nt,!1),ve())}),Ie(()=>r(),()=>{r()!==void 0&&ve()}),Ie(()=>(o(),l(),a(),e(ue)),()=>{o()||l().active||a()?e(ue)||T(ue,requestAnimationFrame(kt)):e(ue)&&(cancelAnimationFrame(e(ue)),T(ue,null),T(je,0))}),Jn(),un();var ut=Di(),en=D(ut);ra(en,p=>T(C,p),()=>e(C));var qt=x(en,2);{var tn=p=>{var I=Ei(),H=D(I);q(I),Te(K=>Re(H,`Speed: ${K??""}Â°/s`),[()=>(u(),Ve(()=>u().toFixed(0)))]),F(p,I)};ae(qt,p=>{(e(Ke)||c())&&p(tn)})}var vn=x(qt,2);{var gn=p=>{var I=Ai(),H=Xe(I),K=D(H);{var Q=k=>{var R=we("ðŸŽ¯ EDIT MODE - Drag to position â€¢ Scroll to zoom â€¢ Double-tap to rotate slices");F(k,R)},j=k=>{var R=we("ðŸ”„ ROTATE SLICES - Drag to rotate â€¢ Double-tap to move center");F(k,R)};ae(K,k=>{M()==="move-center"?k(Q):k(j,!1)})}q(H);var ge=x(H,2),$e=x(D(ge),2),xe=D($e),Pe=x(xe,2),O=D(Pe),Y=D(O,!0);q(O),cn(2),q(Pe);var z=x(Pe,2);q($e),q(ge),Te(()=>Re(Y,r()||12)),W("click",xe,ke(()=>Jt.set(Math.max(6,(r()||12)-1)))),W("pointerdown",xe,ke(function(k){It.call(this,s,k)})),W("pointermove",xe,ke(function(k){It.call(this,s,k)})),W("pointerup",xe,ke(function(k){It.call(this,s,k)})),W("click",z,ke(()=>Jt.set(Math.min(100,(r()||12)+1)))),W("pointerdown",z,ke(function(k){It.call(this,s,k)})),W("pointermove",z,ke(function(k){It.call(this,s,k)})),W("pointerup",z,ke(function(k){It.call(this,s,k)})),F(p,I)};ae(vn,p=>{a()&&p(gn)})}q(ut),ra(ut,p=>T(w,p),()=>e(w)),Te(()=>fn(ut,1,`canvas-wrapper ${a()?"edit-mode":""}`,"svelte-byh4af")),F(t,ut),Zt(),A()}async function Fi(t,s,a={}){const{x:o,y:d,r}=s||{x:t.width/2,y:t.height/2,r:Math.min(t.width,t.height)/2},c=a.samples||720,u=a.innerOffset||-Math.max(2,Math.round(r*.06)),M=a.outerOffset||Math.max(2,Math.round(r*.06)),h=a.thresholdFactor||.6,l=document.createElement("canvas");l.width=t.width,l.height=t.height;const _=l.getContext("2d");_.drawImage(t,0,0);const m=_.getImageData(0,0,l.width,l.height).data,$=l.width,P=l.height;function b(E,N){const de=Math.round(E),Se=Math.round(N);if(de<0||de>=$||Se<0||Se>=P)return 0;const We=(Se*$+de)*4,Ae=m[We],ue=m[We+1],Ne=m[We+2];return .2126*Ae+.7152*ue+.0722*Ne}const i=new Array(c);for(let E=0;E<c;E++){const N=E/c*Math.PI*2,de=[],Se=3;for(let Ae=0;Ae<Se;Ae++){const ue=Ae/(Se-1),Ne=r+u+(M-u)*ue,tt=o+Ne*Math.cos(N),je=d+Ne*Math.sin(N);de.push(b(tt,je))}const We=de.reduce((Ae,ue)=>Ae+ue,0)/de.length;i[E]=We}const v=i.reduce((E,N)=>E+N,0)/i.length,g=Math.sqrt(i.reduce((E,N)=>E+(N-v)**2,0)/i.length),y=v+g*h,A=i.map(E=>E>y);let w=0,C=!1,n=[],te=0;for(let E=0;E<A.length*2;E++){const N=E%A.length;if(A[N]?(te++,C=!0):(C&&(n.push(te),te=0),C=!1),E>=A.length&&!C)break}C&&te>0&&n.push(te);const L=Math.max(2,Math.round(c/360*(a.minDegrees||5))),ie=n.filter(E=>E>=L);w=ie.length;const fe=[];let ne=0;for(const E of n){const N=ne%c,de=(ne+E-1)%c,Se=(N+Math.floor(E/2))%c;fe.push({start:N,end:de,mid:Se,angle:Se/c*2*Math.PI}),ne+=E+1}return{count:w,samples:i,mask:A,groups:ie,positions:fe,canvas:l}}function Li(t,s=24,a={}){const o=[],{width:d,height:r}=t,c=a.circle||{x:d/2,y:r/2,r:Math.min(d,r)/2},u=a.margin??1.05,M=Math.round(c.r*u),h=M*2,l=a.outputSize||Math.max(32,Math.round(h)),_=a.fps||24,m=typeof a.rotationSpeed=="number"?a.rotationSpeed:0,$=a.direction==null?1:a.direction,P=a.initialRotation||0,b=document.createElement("canvas");b.width=h,b.height=h;const i=b.getContext("2d"),v=Math.round(c.x-M),g=Math.round(c.y-M);try{i.drawImage(t,v,g,h,h,0,0,h,h)}catch{i.drawImage(t,0,0)}const A=m/_*Math.PI/180*$;Math.round(h*(a.zoom||1));for(let w=0;w<s;w++){const C=w*A+P,n=document.createElement("canvas");n.width=l,n.height=l;const te=n.getContext("2d");te.translate(l/2,l/2),te.rotate(C);const L=Math.round(h*(a.zoom||1)),ie=L;te.drawImage(b,-L/2,-ie/2,L,ie),o.push(n)}return o}function Ri(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ln(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var zn={exports:{}},ua;function zi(){return ua||(ua=1,(function(t,s){(function(a){t.exports=a()})(function(){return(function a(o,d,r){function c(h,l){if(!d[h]){if(!o[h]){var _=typeof ln=="function"&&ln;if(!l&&_)return _(h,!0);if(u)return u(h,!0);var m=new Error("Cannot find module '"+h+"'");throw m.code="MODULE_NOT_FOUND",m}var $=d[h]={exports:{}};o[h][0].call($.exports,function(P){var b=o[h][1][P];return c(b||P)},$,$.exports,a,o,d,r)}return d[h].exports}for(var u=typeof ln=="function"&&ln,M=0;M<r.length;M++)c(r[M]);return c})({1:[function(a,o,d){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}o.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(l){if(!u(l)||l<0||isNaN(l))throw TypeError("n must be a positive number");return this._maxListeners=l,this},r.prototype.emit=function(l){var _,m,$,P,b,i;if(this._events||(this._events={}),l==="error"&&(!this._events.error||M(this._events.error)&&!this._events.error.length)){if(_=arguments[1],_ instanceof Error)throw _;var v=new Error('Uncaught, unspecified "error" event. ('+_+")");throw v.context=_,v}if(m=this._events[l],h(m))return!1;if(c(m))switch(arguments.length){case 1:m.call(this);break;case 2:m.call(this,arguments[1]);break;case 3:m.call(this,arguments[1],arguments[2]);break;default:P=Array.prototype.slice.call(arguments,1),m.apply(this,P)}else if(M(m))for(P=Array.prototype.slice.call(arguments,1),i=m.slice(),$=i.length,b=0;b<$;b++)i[b].apply(this,P);return!0},r.prototype.addListener=function(l,_){var m;if(!c(_))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",l,c(_.listener)?_.listener:_),this._events[l]?M(this._events[l])?this._events[l].push(_):this._events[l]=[this._events[l],_]:this._events[l]=_,M(this._events[l])&&!this._events[l].warned&&(h(this._maxListeners)?m=r.defaultMaxListeners:m=this._maxListeners,m&&m>0&&this._events[l].length>m&&(this._events[l].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[l].length),typeof console.trace=="function"&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(l,_){if(!c(_))throw TypeError("listener must be a function");var m=!1;function $(){this.removeListener(l,$),m||(m=!0,_.apply(this,arguments))}return $.listener=_,this.on(l,$),this},r.prototype.removeListener=function(l,_){var m,$,P,b;if(!c(_))throw TypeError("listener must be a function");if(!this._events||!this._events[l])return this;if(m=this._events[l],P=m.length,$=-1,m===_||c(m.listener)&&m.listener===_)delete this._events[l],this._events.removeListener&&this.emit("removeListener",l,_);else if(M(m)){for(b=P;b-- >0;)if(m[b]===_||m[b].listener&&m[b].listener===_){$=b;break}if($<0)return this;m.length===1?(m.length=0,delete this._events[l]):m.splice($,1),this._events.removeListener&&this.emit("removeListener",l,_)}return this},r.prototype.removeAllListeners=function(l){var _,m;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[l]&&delete this._events[l],this;if(arguments.length===0){for(_ in this._events)_!=="removeListener"&&this.removeAllListeners(_);return this.removeAllListeners("removeListener"),this._events={},this}if(m=this._events[l],c(m))this.removeListener(l,m);else if(m)for(;m.length;)this.removeListener(l,m[m.length-1]);return delete this._events[l],this},r.prototype.listeners=function(l){var _;return!this._events||!this._events[l]?_=[]:c(this._events[l])?_=[this._events[l]]:_=this._events[l].slice(),_},r.prototype.listenerCount=function(l){if(this._events){var _=this._events[l];if(c(_))return 1;if(_)return _.length}return 0},r.listenerCount=function(l,_){return l.listenerCount(_)};function c(l){return typeof l=="function"}function u(l){return typeof l=="number"}function M(l){return typeof l=="object"&&l!==null}function h(l){return l===void 0}},{}],2:[function(a,o,d){var r,c,u,M,h;h=navigator.userAgent.toLowerCase(),M=navigator.platform.toLowerCase(),r=h.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],u=r[1]==="ie"&&document.documentMode,c={name:r[1]==="version"?r[3]:r[1],version:u||parseFloat(r[1]==="opera"&&r[4]?r[4]:r[2]),platform:{name:h.match(/ip(?:ad|od|hone)/)?"ios":(h.match(/(?:webos|android)/)||M.match(/mac|win|linux/)||["other"])[0]}},c[c.name]=!0,c[c.name+parseInt(c.version,10)]=!0,c.platform[c.platform.name]=!0,o.exports=c},{}],3:[function(a,o,d){var r,c,u,M=function(m,$){for(var P in $)h.call($,P)&&(m[P]=$[P]);function b(){this.constructor=m}return b.prototype=$.prototype,m.prototype=new b,m.__super__=$.prototype,m},h={}.hasOwnProperty,l=[].indexOf||function(m){for(var $=0,P=this.length;$<P;$++)if($ in this&&this[$]===m)return $;return-1},_=[].slice;r=a("events").EventEmitter,u=a("./browser.coffee"),c=(function(m){var $,P;M(b,m),$={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},P={delay:500,copy:!1};function b(i){var v,g,y;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(i);for(g in $)y=$[g],(v=this.options)[g]==null&&(v[g]=y)}return b.prototype.setOption=function(i,v){if(this.options[i]=v,this._canvas!=null&&(i==="width"||i==="height"))return this._canvas[i]=v},b.prototype.setOptions=function(i){var v,g,y;g=[];for(v in i)h.call(i,v)&&(y=i[v],g.push(this.setOption(v,y)));return g},b.prototype.addFrame=function(i,v){var g,y;v==null&&(v={}),g={},g.transparent=this.options.transparent;for(y in P)g[y]=v[y]||P[y];if(this.options.width==null&&this.setOption("width",i.width),this.options.height==null&&this.setOption("height",i.height),typeof ImageData<"u"&&ImageData!==null&&i instanceof ImageData)g.data=i.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&i instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&i instanceof WebGLRenderingContext)v.copy?g.data=this.getContextData(i):g.context=i;else if(i.childNodes!=null)v.copy?g.data=this.getImageData(i):g.image=i;else throw new Error("Invalid image");return this.frames.push(g)},b.prototype.render=function(){var i,v,g;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var y,A,w;for(w=[],y=0,A=this.frames.length;0<=A?y<A:y>A;0<=A?++y:--y)w.push(null);return w}).call(this),v=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(i=0,g=v;0<=g?i<g:i>g;0<=g?++i:--i)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},b.prototype.abort=function(){for(var i;i=this.activeWorkers.shift(),i!=null;)this.log("killing active worker"),i.terminate();return this.running=!1,this.emit("abort")},b.prototype.spawnWorkers=function(){var i,v,g;return i=Math.min(this.options.workers,this.frames.length),(function(){g=[];for(var y=v=this.freeWorkers.length;v<=i?y<i:y>i;v<=i?y++:y--)g.push(y);return g}).apply(this).forEach((function(y){return function(A){var w;return y.log("spawning worker "+A),w=new Worker(y.options.workerScript),w.onmessage=function(C){return y.activeWorkers.splice(y.activeWorkers.indexOf(w),1),y.freeWorkers.push(w),y.frameFinished(C.data)},y.freeWorkers.push(w)}})(this)),i},b.prototype.frameFinished=function(i){var v,g;if(this.log("frame "+i.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[i.index]=i,this.options.globalPalette===!0&&(this.options.globalPalette=i.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(v=1,g=this.freeWorkers.length;1<=g?v<g:v>g;1<=g?++v:--v)this.renderNextFrame();return l.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},b.prototype.finishRendering=function(){var i,v,g,y,A,w,C,n,te,L,ie,fe,ne,E,N,de;for(n=0,E=this.imageParts,A=0,te=E.length;A<te;A++)v=E[A],n+=(v.data.length-1)*v.pageSize+v.cursor;for(n+=v.pageSize-v.cursor,this.log("rendering finished - filesize "+Math.round(n/1e3)+"kb"),i=new Uint8Array(n),fe=0,N=this.imageParts,w=0,L=N.length;w<L;w++)for(v=N[w],de=v.data,g=C=0,ie=de.length;C<ie;g=++C)ne=de[g],i.set(ne,fe),g===v.data.length-1?fe+=v.cursor:fe+=v.pageSize;return y=new Blob([i],{type:"image/gif"}),this.emit("finished",y,i)},b.prototype.renderNextFrame=function(){var i,v,g;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return i=this.frames[this.nextFrame++],g=this.freeWorkers.shift(),v=this.getTask(i),this.log("starting frame "+(v.index+1)+" of "+this.frames.length),this.activeWorkers.push(g),g.postMessage(v)},b.prototype.getContextData=function(i){return i.getImageData(0,0,this.options.width,this.options.height).data},b.prototype.getImageData=function(i){var v;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),v=this._canvas.getContext("2d"),v.setFill=this.options.background,v.fillRect(0,0,this.options.width,this.options.height),v.drawImage(i,0,0),this.getContextData(v)},b.prototype.getTask=function(i){var v,g;if(v=this.frames.indexOf(i),g={index:v,last:v===this.frames.length-1,delay:i.delay,transparent:i.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:u.name==="chrome"},i.data!=null)g.data=i.data;else if(i.context!=null)g.data=this.getContextData(i.context);else if(i.image!=null)g.data=this.getImageData(i.image);else throw new Error("Invalid frame");return g},b.prototype.log=function(){var i;if(i=1<=arguments.length?_.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,i)},b})(r),o.exports=c},{"./browser.coffee":2,events:1}]},{},[3])(3)})})(zn)),zn.exports}var Oi=zi();const Hi=Ri(Oi),Wi=""+new URL("../assets/gif.worker.CjkyQP34.js",import.meta.url).href;async function Ni(t,s=24){if(!t||t.length===0)throw new Error("No frames to export");const a=new Hi({workers:2,quality:10,width:t[0].width,height:t[0].height,workerScript:Wi,repeat:0,background:null,comment:"Created with Phenakistoscope Lab - https://tclaret.github.io/phenaki-lab/"}),o=Math.round(1e3/s);for(const d of t){const r=d.width,c=d.height,u=document.createElement("canvas");u.width=r,u.height=c;const M=u.getContext("2d");M.fillStyle="#ffffff",M.fillRect(0,0,r,c),M.drawImage(d,0,0),a.addFrame(u,{delay:o,copy:!0})}return new Promise((d,r)=>{a.on("finished",function(c){const u=URL.createObjectURL(c);d(u)}),a.on("error",r),a.render()})}var ji=he('<div class="export-overlay svelte-14nyow8" role="status" aria-live="polite"><div class="export-box svelte-14nyow8"><div class="spinner svelte-14nyow8" aria-hidden="true"></div> <div class="export-text svelte-14nyow8">Workingâ€¦ Exporting GIF â€” please wait</div></div></div>'),Gi=he('<button class="confirm-btn svelte-14nyow8">Confirm Detection</button> <button class="svelte-14nyow8">Cancel</button>',1),Ui=he("<button>Detect Circle & Count</button>"),Yi=he('<span style="background: #4a9eff; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75em; font-weight: bold; margin-left: 4px;" class="svelte-14nyow8"> </span>'),Xi=he('<div style="margin-top: 16px; padding: 12px; background: rgba(74, 158, 255, 0.08); border-radius: 6px; border: 1px solid rgba(74, 158, 255, 0.2);" class="svelte-14nyow8"><div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;" class="svelte-14nyow8"><div style="font-weight: 600; color: #4a9eff; font-size: 0.95em;" class="svelte-14nyow8">âš¡ Flicker Fusion Threshold</div> <a href="https://en.wikipedia.org/wiki/Flicker_fusion_threshold" target="_blank" rel="noopener noreferrer" style="display: flex; align-items: center; gap: 4px; font-size: 0.75em; color: #aaa; text-decoration: none; opacity: 0.7; transition: opacity 0.2s;" title="Learn more on Wikipedia" class="svelte-14nyow8"><svg width="14" height="14" viewBox="0 0 240 240" xmlns="http://www.w3.org/2000/svg" class="svelte-14nyow8"><path fill="currentColor" d="M120 0C53.8 0 0 53.8 0 120s53.8 120 120 120 120-53.8 120-120S186.2 0 120 0zm0 217.5c-53.8 0-97.5-43.7-97.5-97.5S66.2 22.5 120 22.5s97.5 43.7 97.5 97.5-43.7 97.5-97.5 97.5zm-7.5-165h15v90h-15zm0 105h15v15h-15z" class="svelte-14nyow8"></path></svg> <span class="svelte-14nyow8">Wikipedia</span></a></div> <div style="font-size: 0.8em; color: #888; font-style: italic; margin-bottom: 10px;" class="svelte-14nyow8">Note: This test only affects visualization, not the exported GIF</div> <div style="margin-bottom: 12px;" class="svelte-14nyow8"><div style="font-size: 0.85em; color: #aaa; margin-bottom: 6px;" class="svelte-14nyow8">Quick Presets:</div> <div style="display: flex; gap: 6px; flex-wrap: wrap;" class="svelte-14nyow8"><button class="flicker-preset-btn svelte-14nyow8">30 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">42 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">50 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">55 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">60 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">70 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">80 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">100 Hz</button></div></div> <div style="margin-top: 12px;" class="svelte-14nyow8"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;" class="svelte-14nyow8"><span style="font-size: 0.85em; color: #ccc;" class="svelte-14nyow8">Fine Tune:</span> <span style="font-size: 1.1em; font-weight: bold; color: #4a9eff;" class="svelte-14nyow8"> </span></div> <input type="range" min="20" max="100" step="0.5" style="width: 100%; cursor: pointer;" class="svelte-14nyow8"/> <div style="display: flex; justify-content: space-between; font-size: 0.7em; color: #666; margin-top: 4px;" class="svelte-14nyow8"><span class="svelte-14nyow8">20 Hz</span> <span style="color: #4a9eff; font-weight: 500;" class="svelte-14nyow8"><!></span> <span class="svelte-14nyow8">100 Hz</span></div></div> <div style="margin-top: 10px; padding: 8px; background: rgba(74, 158, 255, 0.12); border-radius: 4px; font-size: 0.8em;" class="svelte-14nyow8"><div style="font-weight: 500; color: #4a9eff; margin-bottom: 3px;" class="svelte-14nyow8"><!></div> <div style="color: #aaa; font-size: 0.9em;" class="svelte-14nyow8"><!></div></div></div>'),Bi=he('<div class="drag-handle svelte-14nyow8" title="Drag to move">â‹®â‹®</div>'),Vi=he('<div><!> <div style="display:flex;gap:12px;align-items:center;" class="svelte-14nyow8"><button class="speed-btn svelte-14nyow8">âˆ’</button> <div style="text-align:center;min-width:120px;" class="svelte-14nyow8"><div class="speed-display svelte-14nyow8"> </div> <div style="font-size:11px;opacity:0.6;margin-top:4px;" class="svelte-14nyow8">Rotation Speed</div></div> <button class="speed-btn svelte-14nyow8">+</button></div></div>'),Ji=he('<em style="font-size:12px;opacity:0.7;" class="svelte-14nyow8">(Use +/âˆ’ buttons above to adjust speed)</em>'),Ki=he('<em style="font-size:12px;opacity:0.7;" class="svelte-14nyow8">(Touch: drag up to speed up, down to slow down)</em>'),Zi=he('<div class="svelte-14nyow8"><strong class="svelte-14nyow8">Circle:</strong> </div>'),Qi=he('<div class="panel svelte-14nyow8"><!> <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;" class="svelte-14nyow8"><button> </button> <button class="svelte-14nyow8">Reverse</button> <!> <button class="svelte-14nyow8">Apply Suggested Speed</button> <div class="gif-export-group svelte-14nyow8"><button class="save-gif-btn svelte-14nyow8"> </button> <label style="display:flex;align-items:center;gap:6px;" class="svelte-14nyow8"><span style="font-size:12px;opacity:0.8;" class="svelte-14nyow8">Frames:</span> <input type="number" min="6" step="1" style="width:80px;padding:4px;border-radius:4px;border:1px solid #ccc;" class="svelte-14nyow8"/> <span style="font-size:11px;opacity:0.6;" title="Leave empty for auto-detection" class="svelte-14nyow8"><!></span></label> <label style="display:flex;align-items:center;gap:6px;" class="svelte-14nyow8"><span style="font-size:12px;opacity:0.8;" class="svelte-14nyow8">FPS:</span> <select style="padding:4px;border-radius:4px;border:1px solid #ccc;background:#333;color:white;" class="svelte-14nyow8"><option class="svelte-14nyow8">3 (Ultra Slow)</option><option class="svelte-14nyow8">5 (Very Slow)</option><option class="svelte-14nyow8">8 (Slow)</option><option class="svelte-14nyow8">10 (Classic)</option><option class="svelte-14nyow8">15 (Natural)</option><option class="svelte-14nyow8">20 (Smooth)</option><option class="svelte-14nyow8">24 (Cinema)</option><option class="svelte-14nyow8">30 (Fast)</option></select></label></div> <label style="display:flex;align-items:center;gap:6px;margin-left:6px;" class="svelte-14nyow8"><input type="checkbox" class="svelte-14nyow8"/> <span class="svelte-14nyow8">Show Overlay</span></label> <label style="display:flex;align-items:center;gap:6px;margin-left:6px;" class="svelte-14nyow8"><input type="checkbox" class="svelte-14nyow8"/> <span class="svelte-14nyow8">Flicker Effect</span> <!></label></div> <!> <!> <div style="margin-top:12px;" class="svelte-14nyow8"><div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;" class="svelte-14nyow8"><div class="svelte-14nyow8"><strong class="svelte-14nyow8">Current Speed:</strong> <!></div> <div style="display:flex;gap:6px;align-items:center;" class="svelte-14nyow8"><label for="manual-speed-input" style="font-size:12px;" class="svelte-14nyow8">Type speed:</label> <input id="manual-speed-input" type="number" min="1" step="1" style="width:100px;padding:6px;border-radius:4px;border:1px solid #ccc;" class="svelte-14nyow8"/> <button class="svelte-14nyow8">Set</button></div></div> <div class="svelte-14nyow8"><strong class="svelte-14nyow8">Selected scenes count:</strong> </div> <div class="svelte-14nyow8"><strong class="svelte-14nyow8">Suggested speed:</strong> </div> <!></div></div>');function es(t,s){Kt(s,!1);const a=()=>B(wt,"$isPlaying",i),o=()=>B(Wn,"$detectedCircle",i),d=()=>B(ht,"$rotationSpeed",i),r=()=>B($t,"$imageUrl",i),c=()=>B(Gn,"$canvasTransform",i),u=()=>B(Un,"$playerCanvas",i),M=()=>B(Jt,"$gifFrameCount",i),h=()=>B(Xn,"$isMobile",i),l=()=>B(Nn,"$detectedCount",i),_=()=>B(Ln,"$suggestedRotationSpeed",i),m=()=>B(jn,"$overlayVisible",i),$=()=>B(Tt,"$editMode",i),P=()=>B(Yn,"$flickerEnabled",i),b=()=>B(Ye,"$flickerFrequency",i),[i,v]=pn(),g=ee(),y=ee(),A=ee(),w=ee(),C=ee(),n=ee();let te=ee(!1),L=ee(!1);async function ie(){wt.update(f=>!f)}let fe=null;function ne(f){f==="increase"?N():de(),fe&&clearInterval(fe),fe=setInterval(()=>{f==="increase"?N():de()},100)}function E(){fe&&(clearInterval(fe),fe=null)}function N(){ht.update(f=>Math.min(1e4,f+60)),Ut.set(!0)}function de(){ht.update(f=>Math.max(10,f-60)),Ut.set(!0)}function Se(){Hn.update(f=>f*-1)}async function We(){if(!r())return;const S=Date.now();Yt.set({active:!0,progress:0,startTime:S}),Tt.set(!0)}async function Ae(){const f=r();if(!f)return;T(te,!0);const S=c();Tt.set(!1);const V=Date.now();Yt.set({active:!0,progress:0,startTime:V}),a()||requestAnimationFrame(()=>{});try{const X=await At(f);let J=null;const Z=u();if(Z){const ye=Z.clientWidth,rt=Z.clientHeight,Ct=X.width/X.height,_n=ye/rt;let pt,zt;Ct>_n?(pt=ye,zt=ye/Ct):(zt=rt,pt=rt*Ct);const sn=-S.translateX,yn=-S.translateY,xn=sn/S.scale,Mn=yn/S.scale,Ot=X.width/pt,Ht=xn*Ot+X.width/2,kn=Mn*Ot+X.height/2;J={x:Ht,y:kn,r:Math.min(X.width,X.height)/2*.9}}J||(J={x:X.width/2,y:X.height/2,r:Math.min(X.width,X.height)/2*.9});const ce=await Fi(X,J,{samples:720}),Qe=2e3-(Date.now()-V);Qe>0&&await new Promise(ye=>setTimeout(ye,Qe)),Wn.set(J),Nn.set(ce.count),xa.set(ce.positions||[]);const et=(ce.count>0?360/ce.count:1)*30;Ln.set(et),Yt.set({active:!1,progress:1,startTime:V}),Vt.set(!0),wt.set(!1)}finally{T(te,!1)}}function ue(){Ln.subscribe(f=>{f&&(ht.set(f),Ut.set(!0))})()}function Ne(){Tt.set(!1),Vt.set(!1),Yt.set({active:!1,progress:0,startTime:0})}let tt=ee(0);function je(){const f=Number(e(tt))||0;f<0||(ht.set(f),Ut.set(!0))}let dt=ee(!1),Je=ee(15);async function Ke(){const f=r()||on($t);if(!f)return alert("No image loaded to export.");if(!e(A))return alert("Please detect the circle before exporting the GIF.");const S=await At(f),V=document.createElement("canvas");V.width=S.width,V.height=S.height,V.getContext("2d").drawImage(S,0,0,S.width,S.height),T(dt,!0);try{let J;e(y)&&e(y)!==e(w)*2?J=e(y):e(w)&&e(w)>0?J=Math.max(12,e(w)*2):J=e(y)||24;const Z=e(A),ce=Number(on(ht)||0),He=Number(on(Hn)||1),Qe=360/J,Ue=on(Xt)||0,De=Li(V,J,{circle:Z,margin:1.1,zoom:1,fps:e(Je),rotationSpeed:Qe*e(Je),direction:He,initialRotation:Ue}),et=await Ni(De,e(Je)),ye=document.createElement("a");ye.href=et;const rt=new Date().toISOString().slice(0,19).replace(/:/g,"-");ye.download=`phenaki-lab_${rt}_${De.length}frames_${e(Je)}fps.gif`,document.body.appendChild(ye),ye.click(),ye.remove()}catch(J){console.error("GIF export failed",J),alert("GIF export failed: "+(J&&J.message))}finally{T(dt,!1)}}const Oe="phenaki.speedControlPos";let U=ee({left:null,top:null}),vt=ee(!1),gt=ee(!1),_t={x:0,y:0},yt={left:0,top:0},G=0;function nt(){try{const f=localStorage.getItem(Oe);f&&T(U,JSON.parse(f))}catch{}}function at(){try{localStorage.setItem(Oe,JSON.stringify(e(U)))}catch{}}function hn(f){const S=Date.now(),V=S-G<300;if(G=S,f.target&&f.target.closest&&f.target.closest("button"))return;const X=f.target&&f.target.closest&&f.target.closest(".drag-handle"),J=h(),Z=f.target&&f.target.closest&&(f.target.classList.contains("speed-display")||f.target.closest(".speed-display"));if(!(!X&&!V&&!J&&!Z)&&!(J&&!X&&!Z)){T(vt,!0),T(gt,!0),_t={x:f.clientX,y:f.clientY},yt={left:e(U).left??Math.round((window.innerWidth-200)/2),top:e(U).top??Math.round((window.innerHeight-80)/2)};try{f.target.setPointerCapture(f.pointerId)}catch{}window.addEventListener("pointermove",xt),window.addEventListener("pointerup",Et)}}function xt(f){if(!e(gt))return;const S=f.clientX-_t.x,V=f.clientY-_t.y;re(U,e(U).left=Math.round(yt.left+S)),re(U,e(U).top=Math.round(yt.top+V))}function Et(f){T(gt,!1),T(vt,!1);try{f.target.releasePointerCapture&&f.target.releasePointerCapture(f.pointerId)}catch{}window.removeEventListener("pointermove",xt),window.removeEventListener("pointerup",Et),at()}Kn(()=>{nt(),e(U).left==null&&re(U,e(U).left=Math.round((window.innerWidth-200)/2)),e(U).top==null&&re(U,e(U).top=Math.round((window.innerHeight-80)/2));function f(){const ce=Math.max(8,window.innerWidth-200-8),He=Math.max(8,window.innerHeight-80-8);e(U).left==null&&re(U,e(U).left=ce),e(U).top==null&&re(U,e(U).top=He),re(U,e(U).left=Math.min(Math.max(e(U).left,8),ce)),re(U,e(U).top=Math.min(Math.max(e(U).top,8),He))}f();const S=()=>{f(),at()};return window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)});function At(f){return new Promise((S,V)=>{const X=new Image;X.crossOrigin="anonymous",X.onload=()=>S(X),X.onerror=V,X.src=f})}Ie(()=>a(),()=>{a()&&T(L,!0)}),Ie(()=>(o(),a(),d()),()=>{T(g,!!o()&&a()&&d()>0)}),Ie(()=>d(),()=>{T(tt,Number(d()||0))}),Ie(()=>M(),()=>{T(y,M())}),Ie(()=>o(),()=>{T(A,o())}),Ie(()=>l(),()=>{T(w,l())}),Ie(()=>_(),()=>{T(C,_())}),Ie(()=>m(),()=>{T(n,m())}),Jn(),un();var Mt=Qi(),Dt=D(Mt);{var Qt=f=>{var S=ji();F(f,S)};ae(Dt,f=>{e(dt)&&f(Qt)})}var kt=x(Dt,2),ve=D(kt);let ut;var en=D(ve,!0);q(ve);var qt=x(ve,2),tn=x(qt,2);{var vn=f=>{var S=Gi(),V=Xe(S),X=x(V,2);Te(()=>V.disabled=e(te)),W("click",V,Ae),W("click",X,Ne),F(f,S)},gn=f=>{var S=Ui();Te(()=>{fn(S,1,oa(e(A)?"":"detect-btn-required"),"svelte-14nyow8"),S.disabled=e(te)||!r()}),W("click",S,We),F(f,S)};ae(tn,f=>{$()?f(vn):f(gn,!1)})}var p=x(tn,2),I=x(p,2),H=D(I),K=D(H,!0);q(H);var Q=x(H,2),j=x(D(Q),2);Gt(j);var ge=x(j,2),$e=D(ge);{var xe=f=>{var S=we("Manual");F(f,S)},Pe=f=>{var S=ct(),V=Xe(S);{var X=Z=>{var ce=we("Auto (x2)");F(Z,ce)},J=Z=>{var ce=we("Auto");F(Z,ce)};ae(V,Z=>{e(w)?Z(X):Z(J,!1)},!0)}F(f,S)};ae($e,f=>{e(y)?f(xe):f(Pe,!1)})}q(ge),q(Q);var O=x(Q,2),Y=x(D(O),2);Te(()=>{e(Je),ba(()=>{})});var z=D(Y);z.value=z.__value=3;var k=x(z);k.value=k.__value=5;var R=x(k);R.value=R.__value=8;var se=x(R);se.value=se.__value=10;var Me=x(se);Me.value=Me.__value=15;var me=x(Me);me.value=me.__value=20;var be=x(me);be.value=be.__value=24;var Ze=x(be);Ze.value=Ze.__value=30,q(Y),q(O),q(I);var it=x(I,2),St=D(it);Gt(St),cn(2),q(it);var Ft=x(it,2),Pt=D(Ft);Gt(Pt);var nn=x(Pt,4);{var an=f=>{var S=Yi(),V=D(S);q(S),Te(()=>Re(V,`${b()??""} Hz`)),F(f,S)};ae(nn,f=>{P()&&f(an)})}q(Ft),q(kt);var mt=x(kt,2);{var Ce=f=>{var S=Xi(),V=x(D(S),4),X=x(D(V),2),J=D(X),Z=x(J,2),ce=x(Z,2),He=x(ce,2),Qe=x(He,2),Ue=x(Qe,2),De=x(Ue,2),et=x(De,2);q(X),q(V);var ye=x(V,2),rt=D(ye),Ct=x(D(rt),2),_n=D(Ct);q(Ct),q(rt);var pt=x(rt,2);Gt(pt);var zt=x(pt,2),sn=x(D(zt),2),yn=D(sn);{var xn=le=>{var Ee=we("ðŸ”´ Flicker");F(le,Ee)},Mn=le=>{var Ee=ct(),Wt=Xe(Ee);{var Nt=pe=>{var qe=we("ðŸŸ¡ Fusion");F(pe,qe)},jt=pe=>{var qe=we("ðŸŸ¢ Smooth");F(pe,qe)};ae(Wt,pe=>{b()<60?pe(Nt):pe(jt,!1)},!0)}F(le,Ee)};ae(yn,le=>{b()<40?le(xn):le(Mn,!1)})}q(sn),cn(2),q(zt),q(ye);var Ot=x(ye,2),Ht=D(Ot),kn=D(Ht);{var Ea=le=>{var Ee=we("âš¡ Strong Flicker");F(le,Ee)},Aa=le=>{var Ee=ct(),Wt=Xe(Ee);{var Nt=pe=>{var qe=we("ðŸŽ¯ Critical Threshold");F(pe,qe)},jt=pe=>{var qe=ct(),Sn=Xe(qe);{var Pn=Fe=>{var ot=we("âœ¨ Near-Fusion");F(Fe,ot)},Cn=Fe=>{var ot=ct(),In=Xe(ot);{var Tn=Le=>{var bt=we("ðŸŽ¬ Cinema (60 Hz)");F(Le,bt)},$n=Le=>{var bt=we("ðŸŒŸ Ultra Smooth");F(Le,bt)};ae(In,Le=>{b()<62?Le(Tn):Le($n,!1)},!0)}F(Fe,ot)};ae(Sn,Fe=>{b()<58?Fe(Pn):Fe(Cn,!1)},!0)}F(pe,qe)};ae(Wt,pe=>{b()<52?pe(Nt):pe(jt,!1)},!0)}F(le,Ee)};ae(kn,le=>{b()<48?le(Ea):le(Aa,!1)})}q(Ht);var na=x(Ht,2),Da=D(na);{var qa=le=>{var Ee=we("Noticeable flicker - classic phenakistoscope effect");F(le,Ee)},Fa=le=>{var Ee=ct(),Wt=Xe(Ee);{var Nt=pe=>{var qe=we("Flicker begins to fuse - critical threshold");F(pe,qe)},jt=pe=>{var qe=ct(),Sn=Xe(qe);{var Pn=Fe=>{var ot=we("Subtle pulsing - artistic sweet spot");F(Fe,ot)},Cn=Fe=>{var ot=ct(),In=Xe(ot);{var Tn=Le=>{var bt=we("Standard cinema/TV rate - minimal flicker");F(Le,bt)},$n=Le=>{var bt=we("Above fusion threshold - very smooth");F(Le,bt)};ae(In,Le=>{b()<62?Le(Tn):Le($n,!1)},!0)}F(Fe,ot)};ae(Sn,Fe=>{b()<58?Fe(Pn):Fe(Cn,!1)},!0)}F(pe,qe)};ae(Wt,pe=>{b()<52?pe(Nt):pe(jt,!1)},!0)}F(le,Ee)};ae(Da,le=>{b()<48?le(qa):le(Fa,!1)})}q(na),q(Ot),q(S),Te(()=>{lt(J,`padding: 8px 14px; border: 1px solid ${b()===30?"#c92a2a":"#555"}; background: ${b()===30?"#c92a2a":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),lt(Z,`padding: 8px 14px; border: 1px solid ${b()===42?"#ff6b6b":"#555"}; background: ${b()===42?"#ff6b6b":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),lt(ce,`padding: 8px 14px; border: 1px solid ${b()===50?"#ffa500":"#555"}; background: ${b()===50?"#ffa500":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),lt(He,`padding: 8px 14px; border: 1px solid ${b()===55?"#4a9eff":"#555"}; background: ${b()===55?"#4a9eff":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),lt(Qe,`padding: 8px 14px; border: 1px solid ${b()===60?"#51cf66":"#555"}; background: ${b()===60?"#51cf66":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),lt(Ue,`padding: 8px 14px; border: 1px solid ${b()===70?"#845ef7":"#555"}; background: ${b()===70?"#845ef7":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),lt(De,`padding: 8px 14px; border: 1px solid ${b()===80?"#20c997":"#555"}; background: ${b()===80?"#20c997":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),lt(et,`padding: 8px 14px; border: 1px solid ${b()===100?"#12b886":"#555"}; background: ${b()===100?"#12b886":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),Re(_n,`${b()??""} Hz`),ca(pt,b())}),W("click",J,()=>Ye.set(30)),W("click",Z,()=>Ye.set(42)),W("click",ce,()=>Ye.set(50)),W("click",He,()=>Ye.set(55)),W("click",Qe,()=>Ye.set(60)),W("click",Ue,()=>Ye.set(70)),W("click",De,()=>Ye.set(80)),W("click",et,()=>Ye.set(100)),W("input",pt,le=>Ye.set(+le.target.value)),F(f,S)};ae(mt,f=>{P()&&f(Ce)})}var _e=x(mt,2);{var st=f=>{var S=Vi(),V=D(S);{var X=De=>{var et=Bi();F(De,et)};ae(V,De=>{(e(vt)||h())&&De(X)})}var J=x(V,2),Z=D(J),ce=x(Z,2),He=D(ce),Qe=D(He);q(He),cn(2),q(ce);var Ue=x(ce,2);q(J),q(S),Te((De,et,ye)=>{fn(S,1,`speed-control ${e(vt)?"dragMode":""} ${e(gt)?"dragging":""} ${h()?"mobile":""}`,"svelte-14nyow8"),lt(S,`left: ${De??""}px; top: ${et??""}px;`),Re(Qe,`${ye??""}Â°/s`)},[()=>(e(U),Ve(()=>e(U).left??Math.round((window.innerWidth-200)/2))),()=>(e(U),Ve(()=>e(U).top??Math.round((window.innerHeight-80)/2))),()=>(d(),Ve(()=>d().toFixed(0)))]),W("pointerdown",Z,ke(()=>ne("decrease"))),W("pointerup",Z,ke(E)),W("pointerleave",Z,ke(E)),W("pointercancel",Z,ke(E)),W("pointerdown",Ue,ke(()=>ne("increase"))),W("pointerup",Ue,ke(E)),W("pointerleave",Ue,ke(E)),W("pointercancel",Ue,ke(E)),W("pointerdown",S,hn),F(f,S)};ae(_e,f=>{o()&&f(st)})}var Ge=x(_e,2),Lt=D(Ge),Rt=D(Lt),ea=x(D(Rt)),Ma=x(ea);{var ka=f=>{var S=Ji();F(f,S)},Sa=f=>{var S=Ki();F(f,S)};ae(Ma,f=>{h()?f(ka):f(Sa,!1)})}q(Rt);var ta=x(Rt,2),mn=x(D(ta),2);Gt(mn);var Pa=x(mn,2);q(ta),q(Lt);var bn=x(Lt,2),Ca=x(D(bn));q(bn);var wn=x(bn,2),Ia=x(D(wn));q(wn);var Ta=x(wn,2);{var $a=f=>{var S=Zi(),V=x(D(S));q(S),Te((X,J,Z)=>Re(V,` x=${X??""}, y=${J??""}, r=${Z??""}`),[()=>(e(A),Ve(()=>Math.round(e(A).x))),()=>(e(A),Ve(()=>Math.round(e(A).y))),()=>(e(A),Ve(()=>Math.round(e(A).r)))]),F(f,S)};ae(Ta,f=>{e(A)&&f($a)})}q(Ge),q(Mt),Te((f,S)=>{ut=fn(ve,1,oa(e(A)&&!a()?"play-highlight":""),"svelte-14nyow8",ut,{"pause-subtle":a()&&!e(A)}),ve.disabled=!r(),Re(en,a()?"Pause":"Play"),p.disabled=!e(C),H.disabled=!e(g)||e(dt),Re(K,e(dt)?"â³ Exporting...":"ðŸ’¾ Save GIF"),dn(j,"placeholder",e(w)?`Auto (${e(w)*2})`:"Auto (24)"),ca(j,M()),Mi(St,e(n)),Re(ea,` ${f??""}Â°/s | `),Re(Ca,` ${M()??12??""}`),Re(Ia,` ${S??""}Â°/s`)},[()=>(d(),Ve(()=>d().toFixed(0))),()=>(e(C),Ve(()=>e(C)?e(C).toFixed(0):"â€”"))]),W("click",ve,ie),W("click",qt,Se),W("click",p,ue),W("click",H,Ke),W("input",j,f=>Jt.set(f.target.value?Number(f.target.value):null)),ya(Y,()=>e(Je),f=>T(Je,f)),W("change",St,f=>jn.set(f.target.checked)),Pi(Pt,P,f=>ui(Yn,f)),Si(mn,()=>e(tt),f=>T(tt,f)),W("click",Pa,je),F(t,Mt),Zt(),v()}var ts=he('<span class="current-image svelte-ai08gq" title="Currently loaded image"> </span>'),ns=he("<option> </option>"),as=he('<div class="selector svelte-ai08gq"><label for="samples" class="svelte-ai08gq">Sample Images:</label> <!> <select id="samples" class="svelte-ai08gq"><option>-- Choose a sample --</option><!></select></div>');function is(t,s){Kt(s,!1);const a=()=>B(da,"$selectedImageName",o),[o,d]=pn(),r="https://raw.githubusercontent.com/tclaret/phenakistoscope-simulator/main/images",c="https://raw.githubusercontent.com/tclaret/phenaki-lab/main/img",u=[{name:"Colors",file:"colors.png",repo:"new"},{name:"Medium 1990",file:"medium_1990_5036_7181_6_1.png",repo:"new"},{name:"Cats et Donkey",file:"optical-toy-phenakistiscope-disc-avec-cats-et-donkey-ca-1830-2efx315.jpg",repo:"new"},{name:"Dancing Man Animated",file:"Optical_Toy,_Phenakistiscope_Disc_with_Dancing_Man,_ca._1835-Animated.jpg",repo:"new"},{name:"PhÃ©nakistiscope 2",file:"phÃ©nakistiscope2.png",repo:"new"},{name:"Disque Animation 29",file:"phenakistiscope-disque-animation-29.jpg",repo:"new"},{name:"S-L1600 1",file:"s-l1600_1.jpg",repo:"new"},{name:"S-L1600",file:"s-l1600.jpg",repo:"new"},{name:"Hash 045377",file:"045377654e8832d31b850c8c4b7f948b.png",repo:"new"},{name:"Hash 062901",file:"062901e866b6aca4078ae7ff0be74c24.png",repo:"new"},{name:"Hash 0a23fe",file:"0a23fe78862b095518e46a3472238510.png",repo:"new"},{name:"Hash 14ea08",file:"14ea08f701861d967d455220ea8ca7ed.jpg",repo:"new"},{name:"Hash 1928bd",file:"1928bda6cad5fd3cd27d13ce70a502dc.jpg",repo:"new"},{name:"Hash 2d003d",file:"2d003d9b4e81a933bbfbdd55c8b1e261.png",repo:"new"},{name:"Hash 2e4cd2",file:"2e4cd248fbe57af9798c7e3c1c23b58c.jpg",repo:"new"},{name:"Hash 40bd2a",file:"40bd2aead0fc9a6e77d23871555a2998.png",repo:"new"},{name:"Hash 43efde",file:"43efdef999a2fa3200506f97d9e1ef10.png",repo:"new"},{name:"Hash 494697",file:"49469753b75adf62fe324641a2869c53.png",repo:"new"},{name:"Hash 4ca70e",file:"4ca70ec79b59935fb0eed9992045e4fb.jpg",repo:"new"},{name:"Hash 4e6b0c",file:"4e6b0c0e4fde0ad2ad8f4797304b037b.jpg",repo:"new"},{name:"Hash 4f3ab9",file:"4f3ab9e63d43062d25dfc6e4108635fb.png",repo:"new"},{name:"Hash 686b5e",file:"686b5e679b990dd996d0a4a3fb943d2d.png",repo:"new"},{name:"Hash 6f5755",file:"6f57558627d849a8d2b3f9a430bacba2.jpg",repo:"new"},{name:"Hash 75fd29",file:"75fd29a0318c3cf0fdaf8a41d1406cf2.png",repo:"new"},{name:"Hash 8efd4b",file:"8efd4b2b51765d9efdde621251b08968.jpg",repo:"new"},{name:"Hash 90cbee",file:"90cbeedafdef22534d24d04bc44b518f.jpg",repo:"new"},{name:"Hash 954abf",file:"954abf22a1f89759204818d3c0592234.png",repo:"new"},{name:"Hash 9799d6",file:"9799d6d1766b1add766629adec031867.png",repo:"new"},{name:"Hash a0767f",file:"a0767fc0712f1a9eeac238e72b6b2721.png",repo:"new"},{name:"Hash b18a11",file:"b18a11d1a8355081b70a3d91347236b1.jpg",repo:"new"},{name:"Hash bf2932",file:"bf29325ee951619c061902200c8e1143.png",repo:"new"},{name:"Hash e1de4a",file:"e1de4a32cb1bafa33166d51bf8ae2f35.png",repo:"new"},{name:"Hash e59f95",file:"e59f952d6ef4e9c391ea10e143e55b23.png",repo:"new"},{name:"Hash e6582e",file:"e6582e848b0aca99c134d23365c08fdb.png",repo:"new"},{name:"Hash ebd3d3",file:"ebd3d33285d243f86e54df78b9cc69ac.png",repo:"new"},{name:"Woman Chopping Tree",file:"WomanChoppingTree.jpg",repo:"old"},{name:"Dancing",file:"Dancing.jpg",repo:"old"},{name:"Jongleur",file:"Jongleur.png",repo:"old"},{name:"a_cheval",file:"a_cheval.png",repo:"old"},{name:"McLean_1",file:"McLean_1.png",repo:"old"},{name:"Gernamy_1949",file:"Gernamy_1949_R_Balzer.png",repo:"old"},{name:"AEO175939",file:"AEO175939_PhenakistoscopeGiroux60.jpg",repo:"old"},{name:"AEO185553",file:"AEO185553_PhenakistiscopeDisc_ManInBlueAndRed.jpg",repo:"old"},{name:"medium_1990_5036_3369",file:"medium_1990_5036_3369.jpg",repo:"old"},{name:"medium_a001813b",file:"medium_a001813b.jpg",repo:"old"},{name:"tumblr_obd6fh",file:"tumblr_obd6fhGFSZ1r9jbwno1_500.png",repo:"old"},{name:"tumblr_oc1cz",file:"tumblr_oc1czn99ZM1r9jbwno1_500.png",repo:"old"},{name:"Phantasmascope Faces",file:"Phantasmascope_faces.png",repo:"old"},{name:"722a6790240569.5e126845d9b56",file:"722a6790240569.5e126845d9b56.png",repo:"old"},{name:"Fantascope Disc 1833",file:"fantascope-disc-1833.png",repo:"old"},{name:"Face",file:"a_face__.jpg",repo:"new"},{name:"Culbute",file:"culbute.jpg",repo:"new"},{name:"Grenouille",file:"Grenouille__.jpg",repo:"new"},{name:"Oh Soccer",file:"oh_soccer.jpg",repo:"new"},{name:"Un Grand Un Petit",file:"un_grand_un_petit.jpg",repo:"new"},{name:"Autre Culbutte",file:"autre_culbutte.jpg",repo:"new"},{name:"Dancing 2",file:"dancing_.jpg",repo:"new"},{name:"Il Pompe de l'eau",file:"il_pompe_de_leau.jpg",repo:"new"},{name:"Porceline",file:"porceline.jpg",repo:"new"},{name:"Volants",file:"volants_.png",repo:"new"},{name:"Ce Qui",file:"ce_qui.jpg",repo:"new"},{name:"Des Anges",file:"des_anges.jpg",repo:"new"},{name:"Moulin",file:"moulin_.jpg",repo:"new"},{name:"Rats",file:"rats__.jpg",repo:"new"},{name:"Corde Ã  Danser",file:"corde_a_denser_.jpg",repo:"new"},{name:"Ecureuil",file:"ecureuil.jpg",repo:"new"},{name:"Noel Noel",file:"noel_noel.jpg",repo:"new"},{name:"Tirreur",file:"tirreur_.jpg",repo:"new"},{name:"C Pastel",file:"c_pastel.jpg",repo:"new"},{name:"GÃ©omÃ©trique",file:"geometrique.jpg",repo:"new"},{name:"Nuages en Scie",file:"nuages_en_scie.jpg",repo:"new"},{name:"Tons Pastels",file:"tons_pastels.jpg",repo:"new"},{name:"Des Ouiseaux",file:"DesOuaisaux.png",repo:"new"},{name:"Feels Like Flying",file:"feels_like_flying.png",repo:"new"},{name:"Gros Meusieur",file:"GrosMeusieur.png",repo:"new"},{name:"Jongle avec les Otaries",file:"Jongle_avec_les_otaries.png",repo:"new"},{name:"CinÃ©mathÃ¨que 1",file:"cinemateque_francaise_1.png",repo:"new"},{name:"CinÃ©mathÃ¨que 2",file:"cinemateque_francaise_2.png",repo:"new"},{name:"CinÃ©mathÃ¨que 3",file:"cinemateque_francaise_3.png",repo:"new"},{name:"CinÃ©mathÃ¨que 4",file:"cinemateque_francaise_4.png",repo:"new"},{name:"CinÃ©mathÃ¨que 5",file:"cinemateque_francaise_5.png",repo:"new"},{name:"CinÃ©mathÃ¨que 6",file:"cinemateque_francaise_6.png",repo:"new"},{name:"CinÃ©mathÃ¨que 7",file:"cinemateque_francaise_7.png",repo:"new"},{name:"CinÃ©mathÃ¨que 8",file:"cinemateque_francaise_8.png",repo:"new"},{name:"CinÃ©mathÃ¨que 9",file:"cinemateque_francaise_9.png",repo:"new"},{name:"CinÃ©mathÃ¨que 10",file:"cinemateque_francaise_10.png",repo:"new"},{name:"CinÃ©mathÃ¨que 11",file:"cinemateque_francaise_11.png",repo:"new"},{name:"CinÃ©mathÃ¨que 12",file:"cinemateque_francaise_12.png",repo:"new"},{name:"CinÃ©mathÃ¨que 13",file:"cinemateque_francaise_13.png",repo:"new"},{name:"CinÃ©mathÃ¨que 14",file:"cinemateque_francaise_14.png",repo:"new"},{name:"CinÃ©mathÃ¨que 15",file:"cinemateque_francaise_15.png",repo:"new"},{name:"CinÃ©mathÃ¨que 16",file:"cinemateque_francaise_16.png",repo:"new"},{name:"CinÃ©mathÃ¨que 17",file:"cinemateque_francaise_17.png",repo:"new"},{name:"CinÃ©mathÃ¨que 18",file:"cinemateque_francaise_18.png",repo:"new"},{name:"CinÃ©mathÃ¨que 19",file:"cinemateque_francaise_19.png",repo:"new"},{name:"CinÃ©mathÃ¨que 20",file:"cinemateque_francaise_20.png",repo:"new"},{name:"CinÃ©mathÃ¨que 21",file:"cinemateque_francaise_21.png",repo:"new"},{name:"CinÃ©mathÃ¨que 22",file:"cinemateque_francaise_22.png",repo:"new"},{name:"CinÃ©mathÃ¨que 23",file:"cinemateque_francaise_23.png",repo:"new"},{name:"CinÃ©mathÃ¨que 24",file:"cinemateque_francaise_24.png",repo:"new"},{name:"CinÃ©mathÃ¨que 25",file:"cinemateque_francaise_25.png",repo:"new"}];let M=ee("");function h(i){const g=`${i.repo==="new"?c:r}/${i.file}`;$t.set(g),Qn.set(g),wt.set(!0),da.set(i.name),T(M,i.file)}Kn(()=>{let i=!1;if($t.subscribe(g=>{g&&(i=!0)})(),!i){const g=u[Math.floor(Math.random()*u.length)];g&&h(g)}}),un();var l=as(),_=x(D(l),2);{var m=i=>{var v=ts(),g=D(v);q(v),Te(()=>Re(g,`ðŸ“· ${a()??""}`)),F(i,v)};ae(_,i=>{a()&&i(m)})}var $=x(_,2);Te(()=>{e(M),ba(()=>{})});var P=D($);P.value=P.__value="";var b=x(P);hi(b,1,()=>u,i=>i.file,(i,v)=>{var g=ns(),y=D(g,!0);q(g);var A={};Te(()=>{Re(y,e(v).name),A!==(A=e(v).file)&&(g.value=(g.__value=e(v).file)??"")}),F(i,g)}),q($),q(l),ya($,()=>e(M),i=>T(M,i)),W("change",$,i=>{const v=i.target.selectedIndex-1;v>=0&&h(u[v])}),F(t,l),Zt(),d()}var ss=he('<div class="container svelte-1uha8ag"><h1 class="svelte-1uha8ag">Phenakistoscope Lab</h1> <p class="sub svelte-1uha8ag">Convert old phenakistoscope discs into animated GIFs</p> <div class="intro svelte-1uha8ag"><p class="svelte-1uha8ag">To create an animated GIF from a phenakistoscope image, select the correct number of frames according to the image, adjust the rotation speed, and then save it as a fast, slow, or normal animated GIF depending on your settings.</p></div> <!> <!> <!> <!> <!></div>');function ps(t){var s=ss(),a=x(D(s),6);Ii(a,{});var o=x(a,2);is(o,{});var d=x(o,2);$i(d,{});var r=x(d,2);qi(r,{});var c=x(r,2);es(c,{}),q(s),F(t,s)}export{ps as component};
