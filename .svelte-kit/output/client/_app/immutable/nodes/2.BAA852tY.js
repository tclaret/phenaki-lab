import{f as ve,a as D,c as st,t as ke}from"../chunks/DidSmI2s.js";import"../chunks/BfDn8e9k.js";import{G as qa,v as We,w as Fa,g as n,av as La,I as za,J as Ra,K as ea,L as ta,M as Cn,D as tn,a3 as Oa,aq as Wa,aa as Na,x as rt,C as Fn,B as fa,F as ja,Q as te,a1 as na,ao as ua,aI as Hn,aJ as Ga,y as da,A as Ha,aK as Ua,aL as Ya,aM as In,ak as Xa,aN as Ba,aO as Va,an as Ja,z as Ka,aP as Un,N as Za,R as Qa,aQ as ei,aR as ti,aS as ha,aT as ni,aU as ai,aV as ii,P as si,aW as ri,aX as oi,b as Je,O as pa,aG as li,p as Xt,j as Bt,s as k,k as $,l as E,aY as Pe,aZ as Yn,i as Be,U as I,t as Ce,a_ as re,ab as an,a$ as va}from"../chunks/CkcJ_p-v.js";import{e as z,s as Oe}from"../chunks/EstrOUTn.js";import{i as on}from"../chunks/BeJGQpUk.js";import{w as de,o as Xn,a as ci,g as Tn}from"../chunks/BzLubvRb.js";import{i as se,s as ln,a as Y,b as aa,d as fi}from"../chunks/CgM4jgzu.js";function ui(t,s,a){for(var o=[],d=s.length,r=0;r<d;r++)Ba(s[r].e,o,!0);Va(o,()=>{var c=o.length===0&&a!==null;if(c){var h=a,x=h.parentNode;Ja(x),x.append(h),t.items.clear(),Ve(t,s[0].prev,s[d-1].next)}for(var v=0;v<d;v++){var l=s[v];c||(t.items.delete(l.k),Ve(t,l.prev,l.next)),Ka(l.e,!c)}t.first===s[0]&&(t.first=s[0].prev)})}function di(t,s,a,o,d,r=null){var c=t,h=new Map,x=null;We&&Fa();var v=null,l=La(()=>{var i=a();return Hn(i)?i:i==null?[]:ua(i)}),b,w=!0;function P(){hi(_,b,c,s,o),v!==null&&(b.length===0?(v.fragment?(c.before(v.fragment),v.fragment=null):da(v.effect),M.first=v.effect):Ha(v.effect,()=>{v=null}))}var M=qa(()=>{b=n(l);var i=b.length;let u=!1;if(We){var m=za(c)===Ra;m!==(i===0)&&(c=ea(),ta(c),Cn(!1),u=!0)}for(var p=new Set,y=rt,e=null,j=ja(),T=0;T<i;T+=1){We&&tn.nodeType===Oa&&tn.data===Wa&&(c=tn,u=!0,Cn(!1));var ne=b[T],ce=o(ne,T),H=w?null:h.get(ce);H?(Na(H.v,ne),H.i=T,j&&y.skipped_effects.delete(H.e)):(H=pi(w?c:null,e,ne,ce,T,d,s,a),w&&(H.o=!0,e===null?x=H:e.next=H,e=H),h.set(ce,H)),p.add(ce)}if(i===0&&r&&!v)if(w)v={fragment:null,effect:Fn(()=>r(c))};else{var X=document.createDocumentFragment(),Q=fa();X.append(Q),v={fragment:X,effect:Fn(()=>r(Q))}}if(We&&i>0&&ta(ea()),!w)if(j){for(const[q,ae]of h)p.has(q)||y.skipped_effects.add(ae.e);y.oncommit(P),y.ondiscard(()=>{})}else P();u&&Cn(!0),n(l)}),_={effect:M,items:h,first:x};w=!1,We&&(c=tn)}function hi(t,s,a,o,d){var r=s.length,c=t.items,h=t.first,x,v=null,l=[],b=[],w,P,M,_;for(_=0;_<r;_+=1){if(w=s[_],P=d(w,_),M=c.get(P),t.first??=M,!M.o){M.o=!0;var i=v?v.next:h;Ve(t,v,M),Ve(t,M,i),$n(M,i,a),v=M,l=[],b=[],h=v.next;continue}if((M.e.f&In)!==0&&da(M.e),M!==h){if(x!==void 0&&x.has(M)){if(l.length<b.length){var u=b[0],m;v=u.prev;var p=l[0],y=l[l.length-1];for(m=0;m<l.length;m+=1)$n(l[m],u,a);for(m=0;m<b.length;m+=1)x.delete(b[m]);Ve(t,p.prev,y.next),Ve(t,v,p),Ve(t,y,u),h=u,v=y,_-=1,l=[],b=[]}else x.delete(M),$n(M,h,a),Ve(t,M.prev,M.next),Ve(t,M,v===null?t.first:v.next),Ve(t,v,M),v=M;continue}for(l=[],b=[];h!==null&&h.k!==P;)(h.e.f&In)===0&&(x??=new Set).add(h),b.push(h),h=h.next;if(h===null)continue;M=h}l.push(M),v=M,h=M.next}let e=c.size>r;if(h!==null||x!==void 0){for(var j=x===void 0?[]:ua(x);h!==null;)(h.e.f&In)===0&&j.push(h),h=h.next;var T=j.length;if(e=c.size-T>r,T>0){var ne=null;ui(t,j,ne)}}if(e)for(const ce of c.values())ce.o||(Ve(t,v,ce),v=ce);t.effect.last=v&&v.e}function pi(t,s,a,o,d,r,c,h){var x=(c&Ua)!==0,v=(c&Ya)===0,l=x?v?te(a,!1,!1):na(a):a,b=(c&Ga)===0?d:na(d),w={i:b,v:l,k:o,a:null,e:null,o:!1,prev:s,next:null};try{if(t===null){var P=document.createDocumentFragment();P.append(t=fa())}return w.e=Fn(()=>r(t,l,b,h)),s!==null&&(s.next=w),w}finally{}}function $n(t,s,a){for(var o=t.next?t.next.e.nodes_start:a,d=s?s.e.nodes_start:a,r=t.e.nodes_start;r!==null&&r!==o;){var c=Xa(r);d.before(r),r=c}}function Ve(t,s,a){s===null?(t.first=a,t.effect.first=a&&a.e):(s.e.next&&(s.e.next.prev=null),s.next=a,s.e.next=a&&a.e),a!==null&&(a.e.prev&&(a.e.prev.next=null),a.prev=s,a.e.prev=s&&s.e)}function ga(t){var s,a,o="";if(typeof t=="string"||typeof t=="number")o+=t;else if(typeof t=="object")if(Array.isArray(t)){var d=t.length;for(s=0;s<d;s++)t[s]&&(a=ga(t[s]))&&(o&&(o+=" "),o+=a)}else for(a in t)t[a]&&(o&&(o+=" "),o+=a);return o}function vi(){for(var t,s,a=0,o="",d=arguments.length;a<d;a++)(t=arguments[a])&&(s=ga(t))&&(o&&(o+=" "),o+=s);return o}function ia(t){return typeof t=="object"?vi(t):t??""}const sa=[...` 	
\r\f¬†\v\uFEFF`];function gi(t,s,a){var o=t==null?"":""+t;if(s&&(o=o?o+" "+s:s),a){for(var d in a)if(a[d])o=o?o+" "+d:d;else if(o.length)for(var r=d.length,c=0;(c=o.indexOf(d,c))>=0;){var h=c+r;(c===0||sa.includes(o[c-1]))&&(h===o.length||sa.includes(o[h]))?o=(c===0?"":o.substring(0,c))+o.substring(h+1):c=h}}return o===""?null:o}function mi(t,s){return t==null?null:String(t)}function sn(t,s,a,o,d,r){var c=t.__className;if(We||c!==a||c===void 0){var h=gi(a,o,r);(!We||h!==t.getAttribute("class"))&&(h==null?t.removeAttribute("class"):t.className=h),t.__className=a}else if(r&&d!==r)for(var x in r){var v=!!r[x];(d==null||v!==!!d[x])&&t.classList.toggle(x,v)}return r}function it(t,s,a,o){var d=t.__style;if(We||d!==s){var r=mi(s);(!We||r!==t.getAttribute("style"))&&(r==null?t.removeAttribute("style"):t.style.cssText=r),t.__style=s}return o}function ma(t,s,a=!1){if(t.multiple){if(s==null)return;if(!Hn(s))return ei();for(var o of t.options)o.selected=s.includes(Ht(o));return}for(o of t.options){var d=Ht(o);if(ti(d,s)){o.selected=!0;return}}(!a||s!==void 0)&&(t.selectedIndex=-1)}function _i(t){var s=new MutationObserver(()=>{ma(t,t.__value)});s.observe(t,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Qa(()=>{s.disconnect()})}function _a(t,s,a=s){var o=new WeakSet,d=!0;Un(t,"change",r=>{var c=r?"[selected]":":checked",h;if(t.multiple)h=[].map.call(t.querySelectorAll(c),Ht);else{var x=t.querySelector(c)??t.querySelector("option:not([disabled])");h=x&&Ht(x)}a(h),rt!==null&&o.add(rt)}),Za(()=>{var r=s();if(t===document.activeElement){var c=ha??rt;if(o.has(c))return}if(ma(t,r,d),d&&r===void 0){var h=t.querySelector(":checked");h!==null&&(r=Ht(h),a(r))}t.__value=r,d=!1}),_i(t)}function Ht(t){return"__value"in t?t.__value:t.value}const wi=Symbol("is custom element"),yi=Symbol("is html");function Nt(t){if(We){var s=!1,a=()=>{if(!s){if(s=!0,t.hasAttribute("value")){var o=t.value;rn(t,"value",null),t.value=o}if(t.hasAttribute("checked")){var d=t.checked;rn(t,"checked",null),t.checked=d}}};t.__on_r=a,si(a),ri()}}function ra(t,s){var a=Bn(t);a.value===(a.value=s??void 0)||t.value===s&&(s!==0||t.nodeName!=="PROGRESS")||(t.value=s??"")}function bi(t,s){var a=Bn(t);a.checked!==(a.checked=s??void 0)&&(t.checked=s)}function rn(t,s,a,o){var d=Bn(t);We&&(d[s]=t.getAttribute(s),s==="src"||s==="srcset"||s==="href"&&t.nodeName==="LINK")||d[s]!==(d[s]=a)&&(s==="loading"&&(t[oi]=a),a==null?t.removeAttribute(s):typeof a!="string"&&xi(t).includes(s)?t[s]=a:t.setAttribute(s,a))}function Bn(t){return t.__attributes??={[wi]:t.nodeName.includes("-"),[yi]:t.namespaceURI===ni}}var oa=new Map;function xi(t){var s=t.getAttribute("is")||t.nodeName,a=oa.get(s);if(a)return a;oa.set(s,a=[]);for(var o,d=t,r=Element.prototype;r!==d;){o=ii(d);for(var c in o)o[c].set&&a.push(c);d=ai(d)}return a}function ki(t,s,a=s){var o=new WeakSet;Un(t,"input",async d=>{var r=d?t.defaultValue:t.value;if(r=En(t)?Dn(r):r,a(r),rt!==null&&o.add(rt),await li(),r!==(r=s())){var c=t.selectionStart,h=t.selectionEnd,x=t.value.length;if(t.value=r??"",h!==null){var v=t.value.length;c===h&&h===x&&v>x?(t.selectionStart=v,t.selectionEnd=v):(t.selectionStart=c,t.selectionEnd=Math.min(h,v))}}}),(We&&t.defaultValue!==t.value||Je(s)==null&&t.value)&&(a(En(t)?Dn(t.value):t.value),rt!==null&&o.add(rt)),pa(()=>{var d=s();if(t===document.activeElement){var r=ha??rt;if(o.has(r))return}En(t)&&d===Dn(t.value)||t.type==="date"&&!d&&!t.value||d!==t.value&&(t.value=d??"")})}function Mi(t,s,a=s){Un(t,"change",o=>{var d=o?t.defaultChecked:t.checked;a(d)}),(We&&t.defaultChecked!==t.checked||Je(s)==null)&&a(t.checked),pa(()=>{var o=s();t.checked=!!o})}function En(t){var s=t.type;return s==="number"||s==="range"}function Dn(t){return t===""?null:+t}function Me(t){return function(...s){var a=s[0];return a.stopPropagation(),t?.apply(this,s)}}function Mt(t,s){var a=t.$$events?.[s.type],o=Hn(a)?a.slice():a==null?[]:[a];for(var d of o)d.call(this,s)}const Vn=de(null),Pt=de(null),la=de(null),vt=de(!1),ft=de(0),Ln=de(1),jt=de(!1),zn=de(null),Rn=de(0),An=de(1),wa=de([]),On=de(!1),St=de(!1),Ut=de(!1),Wn=de({translateX:0,translateY:0,scale:1}),Gt=de({active:!1,progress:0,startTime:0}),Nn=de(null),jn=de(!1),Xe=de(50),Gn=de(!1),Yt=de(null);var Si=ve('<label>Choose image: <input type="file" accept="image/*"/></label>');function Pi(t,s){Xt(s,!1);function a(r){const c=r.target.files[0];if(!c)return;const h=URL.createObjectURL(c);Vn.set(h),Pt.set(h),vt.set(!0)}on();var o=Si(),d=k($(o));E(o),z("change",d,a),D(t,o),Bt()}var Ci=ve('<div class="preview svelte-1th6cal"><img alt="Selected disc preview" class="svelte-1th6cal"/></div>');function Ii(t,s){Xt(s,!1);const a=()=>Y(Vn,"$previewUrl",o),[o,d]=ln(),r=te();Pe(()=>a(),()=>{I(r,a())}),Yn();var c=st(),h=Be(c);{var x=v=>{var l=Ci(),b=$(l);E(l),Ce(()=>rn(b,"src",n(r))),D(v,l)};se(h,v=>{n(r)&&v(x)})}D(t,c),Bt(),d()}var Ti=ve('<div class="speed-hud svelte-byh4af"> </div>'),$i=ve('<div class="edit-mode-indicator svelte-byh4af">‚öôÔ∏è EDIT MODE - Drag to position ‚Ä¢ Scroll to zoom</div> <div class="frame-counter svelte-byh4af"><div class="frame-info svelte-byh4af"><div style="font-size: 0.7em; color: #aaa; margin-bottom: 4px; text-align: center;" class="svelte-byh4af">How many scenes on the disc?</div> <div style="font-size: 0.65em; color: #888; text-align: center; margin-bottom: 8px;" class="svelte-byh4af">Set frame count = number of animation scenes</div></div> <div style="display: flex; align-items: center; gap: 8px;" class="svelte-byh4af"><button class="frame-btn svelte-byh4af" title="Decrease frame count">‚àí</button> <div class="frame-display svelte-byh4af"><div class="frame-number svelte-byh4af"> </div> <div class="frame-label svelte-byh4af">frames</div></div> <button class="frame-btn svelte-byh4af" title="Increase frame count">+</button></div></div>',1),Ei=ve('<div><canvas class="svelte-byh4af"></canvas> <!> <!></div>');function Di(t,s){Xt(s,!1);const a=()=>Y(St,"$editMode",u),o=()=>Y(vt,"$isPlaying",u),d=()=>Y(Pt,"$imageUrl",u),r=()=>Y(Yt,"$gifFrameCount",u),c=()=>Y(Gn,"$isMobile",u),h=()=>Y(ft,"$rotationSpeed",u),x=()=>Y(Gt,"$detectionAnimation",u),v=()=>Y(Ln,"$rotationDirection",u),l=()=>Y(zn,"$detectedCircle",u),b=()=>Y(On,"$overlayVisible",u),w=()=>Y(Rn,"$detectedCount",u),P=()=>Y(wa,"$detectedPositions",u),M=()=>Y(Ut,"$confirmedDetection",u),_=()=>Y(jn,"$flickerEnabled",u),i=()=>Y(Xe,"$flickerFrequency",u),[u,m]=ln();let p=te(),y=te(),e,j=0,T=te(1);const ne=1,ce=4;let H=te(0),X=te(0);const Q=new Map;let q=1,ae=0,fe=0,Se=0,he=te(),Ie=1,Ke=0,Te=te(0),et=0,gt=1,$e=te(!1),we,Ct=0,It=0,N=0,F=te(null),Ne=te(!1),Ze;function Tt(g){I(Ne,!1),I(F,new Image),re(F,n(F).crossOrigin="anonymous"),re(F,n(F).onload=()=>{console.log("Image loaded:",g,"Size:",n(F).width,"x",n(F).height),I(Ne,!0),mt(),Ee()}),re(F,n(F).onerror=C=>{console.error("Erreur chargement:",g,C),I(Ne,!1)}),re(F,n(F).src=g)}function mt(){if(!n(y)||!n(p))return;const g=n(p).getBoundingClientRect(),C=window.devicePixelRatio||1;if(n(F)&&n(F).width&&n(F).height){const U=n(F).width,ee=n(F).height,J=Math.min(1400,Math.max(150,Math.round(g.width*Math.sqrt(U*U+ee*ee)/U)));re(p,n(p).style.height=J+"px");const B=n(p).getBoundingClientRect();re(y,n(y).style.width=B.width+"px"),re(y,n(y).style.height=B.height+"px"),re(y,n(y).width=Math.round(B.width*C)),re(y,n(y).height=Math.round(B.height*C))}else re(y,n(y).style.width=g.width+"px"),re(y,n(y).style.height=g.height+"px"),re(y,n(y).width=Math.round(g.width*C)),re(y,n(y).height=Math.round(g.height*C));e&&e.setTransform(C,0,0,C,0,0),Ee()}Xn(()=>{const g=()=>{const U="ontouchstart"in window||navigator.maxTouchPoints>0||window.innerWidth<768;Gn.set(U)};if(g(),window.addEventListener("resize",g),n(y)){if(Nn.set(n(y)),e=n(y).getContext("2d"),n(p)){const C=()=>{c()?n(T)>1||a()?re(p,n(p).style.touchAction="none"):re(p,n(p).style.touchAction="pan-y"):re(p,n(p).style.touchAction="none")};C(),Wn.subscribe(C),St.subscribe(C)}n(p)&&n(p).addEventListener("wheel",Dt,{passive:!1}),mt(),Ze=new ResizeObserver(()=>mt()),n(p)&&Ze.observe(n(p)),n(p)&&(n(p).addEventListener("pointerdown",Vt),n(p).addEventListener("pointermove",$t),n(p).addEventListener("pointerup",Jt),n(p).addEventListener("pointerleave",Et))}return()=>{Ze&&Ze.disconnect(),window.removeEventListener("resize",g)}});function Vt(g){if(!n(p))return;(a()||n(T)>1)&&(g.preventDefault(),g.stopPropagation()),n(p).setPointerCapture(g.pointerId),Q.set(g.pointerId,{x:g.clientX,y:g.clientY});const C=Date.now(),U=g.clientX-It,ee=g.clientY-N,J=Math.sqrt(U*U+ee*ee);if(C-Ct<300&&J<50&&!a()){vt.update(B=>!B),Q.clear(),Ct=0;return}if(Ct=C,It=g.clientX,N=g.clientY,Q.size===1&&(fe=g.clientX,Se=g.clientY,et=g.clientY,gt=h()||1),Q.size===2){const B=Array.from(Q.values());q=n(T),Ie=n(T),ae=Math.hypot(B[0].x-B[1].x,B[0].y-B[1].y)}}function $t(g){if(n(p)){if((a()||n(T)>1)&&Q.has(g.pointerId)&&(g.preventDefault(),g.stopPropagation()),Q.has(g.pointerId)&&Q.set(g.pointerId,{x:g.clientX,y:g.clientY}),Q.size===2){const C=Array.from(Q.values()),U=C[0],ee=C[1],B=Math.hypot(U.x-ee.x,U.y-ee.y)/ae;let _e=Math.max(ne,Math.min(ce,q*B));c()&&(Ie=_e,_e=n(T)+(Ie-n(T))*.3);const tt={x:(U.x+ee.x)/2,y:(U.y+ee.y)/2},De=n(y).clientWidth,oe=n(y).clientHeight,R=n(p).getBoundingClientRect(),K=tt.x-(R.left+De/2)-n(H),O=tt.y-(R.top+oe/2)-n(X),A=n(T),L=_e;if(I(H,n(H)-(L/A-1)*K),I(X,n(X)-(L/A-1)*O),I(T,_e),c()){const ie=Date.now();ie-Ke>16&&(Ee(),Ke=ie)}else Ee();I($e,!0),clearTimeout(we);return}if(Q.size===1){if(Q.values().next().value,n(T)>1||a()){const C=g.clientX-fe,U=g.clientY-Se;I(H,n(H)+C),I(X,n(X)+U),fe=g.clientX,Se=g.clientY,Ee();return}else if(!c()){const C=et-g.clientY,ee=Math.round(C*8),J=Math.max(10,Math.min(1e4,Math.round(gt+ee)));ft.set(J),jt.set(!0),I($e,!0),clearTimeout(we)}}}}function Jt(g){if(n(p)){try{n(p).releasePointerCapture(g.pointerId)}catch{}clearTimeout(we),I($e,!0),we=setTimeout(()=>{I($e,!1)},4e3),Q.delete(g.pointerId),Q.size===0&&(clearTimeout(we),I($e,!1),ae=0,Ie=n(T))}}function Et(){clearTimeout(we),I($e,!0),we=setTimeout(()=>{I($e,!1)},4e3)}function Dt(g){if(!n(p)||!g.ctrlKey&&!g.metaKey)return;g.preventDefault();const U=1+(-g.deltaY>0?.1:-.1),ee=Math.max(ne,Math.min(ce,n(T)*U)),J=n(p).getBoundingClientRect(),B=g.clientX-(J.left+n(y).clientWidth/2)-n(H),_e=g.clientY-(J.top+n(y).clientHeight/2)-n(X);I(H,n(H)-(ee/n(T)-1)*B),I(X,n(X)-(ee/n(T)-1)*_e),I(T,ee),Ee()}ci(()=>{n(he)&&cancelAnimationFrame(n(he)),Ze&&Ze.disconnect(),we&&clearTimeout(we),n(p)&&(n(p).removeEventListener("pointerdown",Vt),n(p).removeEventListener("pointermove",$t),n(p).removeEventListener("pointerup",Jt),n(p).removeEventListener("pointerleave",Et),n(p)&&n(p).removeEventListener("wheel",Dt)),Nn.set(null)});function At(g){const C=o()||x().active||a();if(!C||!n(Ne)){I(Te,0),!C&&n(he)&&(cancelAnimationFrame(n(he)),I(he,null));return}n(Te)||I(Te,g);const U=g-n(Te);if(I(Te,g),o()&&!a()){const ee=h()||0;j+=ee*(v()||1)*(U/1e3)}Ee(),I(he,requestAnimationFrame(At))}function Ee(){if(!n(Ne)||!e||!n(F)||!n(y)){console.log("DrawFrame skipped:",{imageReady:n(Ne),ctx:!!e,htmlImg:!!n(F),canvas:!!n(y)});return}const g=n(y).clientWidth,C=n(y).clientHeight;e.clearRect(0,0,g,C),e.save();const U=n(F).width/n(F).height,ee=g/C;let J,B;U>ee?(J=g,B=g/U):(B=C,J=C*U);const _e=J*n(T),tt=B*n(T);let De=0,oe=0;if(l()){const R=J/n(F).width;De=(l().x-n(F).width/2)*R*n(T),oe=(l().y-n(F).height/2)*R*n(T)}if(e.translate(g/2+n(H),C/2+n(X)),e.translate(De,oe),e.rotate(j*Math.PI/180),e.translate(-De,-oe),e.drawImage(n(F),-_e/2,-tt/2,_e,tt),b()&&l())try{const R=l(),K=J*n(T)/n(F).width,O=(R.x-n(F).width/2)*K,A=(R.y-n(F).height/2)*K,L=R.r*K,ie=Date.now()/1e3,ge=ie*Math.PI*.5%(Math.PI*2),me=ie*.8%2,be=L*(.8+me*.4),Ue=Math.max(0,.3*(1-me/2));e.beginPath(),e.strokeStyle=`rgba(0, 255, 255, ${Ue})`,e.lineWidth=2,e.arc(O,A,be,0,Math.PI*2),e.stroke(),e.save(),e.translate(O,A),e.rotate(ge),e.strokeStyle="rgba(0, 255, 255, 0.4)",e.lineWidth=2,e.beginPath(),e.moveTo(0,0),e.lineTo(L*1.1,0),e.stroke(),e.restore(),e.strokeStyle="rgba(0, 255, 255, 0.1)",e.lineWidth=1;for(let ye=0;ye<8;ye++){const xe=ye/8*Math.PI*2;if(e.beginPath(),e.moveTo(O,A),e.lineTo(O+Math.cos(xe)*L,A+Math.sin(xe)*L),e.stroke(),ye%2===0){const nt=Math.round(xe*180/Math.PI%360),Ye=L*1.12,fn=O+Math.cos(xe)*Ye,Qt=A+Math.sin(xe)*Ye;e.font="bold 10px monospace",e.fillStyle="rgba(0, 255, 255, 0.7)",e.textAlign="center",e.textBaseline="middle",e.fillText(`${nt}¬∞`,fn,Qt)}}const ut=.6;e.font="11px monospace",e.textAlign="left";const wt=O+L*.3,yt=A-L*.8,qt=14,bt=[`r = ${Math.round(R.r)}px`,`Œ∏ = ${Math.round(ge*180/Math.PI%360)}¬∞`,`œâ = ${h()}¬∞/s`,`n = ${w()||0}`];e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(wt-2,yt-8,95,bt.length*qt),bt.forEach((ye,xe)=>{const nt=yt+xe*qt,Ye=["rgba(0, 255, 255, ","rgba(255, 0, 255, ","rgba(255, 255, 0, "];e.fillStyle=Ye[xe%3]+ut+")",e.fillText(ye,wt,nt)}),e.font="bold 10px sans-serif",e.textAlign="center";const xt=A+L+25;e.fillStyle="rgba(0, 0, 0, 0.7)",e.fillRect(O-70,xt-8,140,16),e.fillStyle="rgba(100, 255, 200, 0.8)",e.fillText("CIRCLE DETECTION",O,xt);for(let ye=0;ye<6;ye++){const xe=ye/6*Math.PI*2+ie*.3,nt=O+Math.cos(xe)*L,Ye=A+Math.sin(xe)*L;e.beginPath(),e.arc(nt,Ye,2,0,Math.PI*2),e.fillStyle=ye%2===0?"rgba(0, 255, 255, 0.8)":"rgba(255, 0, 255, 0.8)",e.fill()}e.beginPath(),e.lineWidth=2,e.strokeStyle="rgba(0, 255, 255, 0.8)",e.arc(O,A,L,0,Math.PI*2),e.stroke(),e.lineWidth=2;const dt=Math.max(15,L*.15);if(e.beginPath(),e.strokeStyle="rgba(0, 255, 255, 0.9)",e.moveTo(O-dt,A),e.lineTo(O+dt,A),e.moveTo(O,A-dt),e.lineTo(O,A+dt),e.stroke(),P()&&P().length){e.fillStyle="rgba(255, 0, 255, 0.9)";for(const ye of P()){const xe=ye.angle,nt=O+Math.cos(xe)*L,Ye=A+Math.sin(xe)*L;e.beginPath(),e.arc(nt,Ye,2.5,0,Math.PI*2),e.fill()}}}catch(R){console.warn("overlay draw failed",R)}if(a()&&!M())try{let R;if(a()){const K=x().startTime||0;R=(K>0?Date.now()-K:Date.now())%2e3/2e3}else R=Math.min(1,(Date.now()-x().startTime)/2e3);if(e.fillStyle=a()?"rgba(0, 0, 0, 0.5)":"rgba(0, 0, 0, 0.3)",e.fillRect(-J/2-100,-B/2-100,J+200,B+200),l()){const K=l(),O=J*n(T)/n(F).width,A=(K.x-n(F).width/2)*O,L=(K.y-n(F).height/2)*O,ie=K.r*O;e.strokeStyle=`rgba(100, 200, 255, ${.8*(1-R)})`,e.lineWidth=2;for(let Ue=0;Ue<3;Ue++){const ut=ie*(.3+R*1.2+Ue*.3);e.beginPath(),e.arc(A,L,ut,0,Math.PI*2),e.stroke()}e.strokeStyle="rgba(100, 200, 255, 0.9)",e.lineWidth=3;const ge=R*Math.PI*6,me=ie*1.8;e.beginPath(),e.moveTo(A,L),e.lineTo(A+Math.cos(ge)*me,L+Math.sin(ge)*me),e.stroke();const be=4+Math.sin(R*Math.PI*4)*2;e.fillStyle=`rgba(100, 200, 255, ${.9*Math.sin(R*Math.PI)})`,e.beginPath(),e.arc(A,L,be,0,Math.PI*2),e.fill(),e.fillStyle=`rgba(100, 200, 255, ${Math.sin(R*Math.PI)})`,e.font="bold 14px sans-serif",e.textAlign="center",e.fillText("SCANNING...",A,L-ie-20)}else{const K=Math.max(J,B)/2;e.strokeStyle=`rgba(100, 200, 255, ${.6})`,e.lineWidth=2;for(let A=0;A<4;A++){const L=K*(R+A*.25)%1,ie=1-L;e.strokeStyle=`rgba(100, 200, 255, ${ie*.6})`,e.beginPath(),e.arc(0,0,L*K,0,Math.PI*2),e.stroke()}e.strokeStyle="rgba(100, 200, 255, 0.8)",e.lineWidth=3;const O=R*Math.PI*4;e.beginPath(),e.moveTo(0,0),e.lineTo(Math.cos(O)*K,Math.sin(O)*K),e.stroke(),e.fillStyle=`rgba(100, 200, 255, ${.8+.2*Math.sin(R*Math.PI*4)})`,e.font="bold 18px sans-serif",e.textAlign="center",a()?(e.fillText("‚öôÔ∏è EDIT MODE - ADJUST POSITION & ZOOM",0,-60),e.font="bold 16px sans-serif",e.fillStyle="rgba(255, 200, 100, 0.95)",e.fillText("üéØ Align crosshair with rotation center",0,-20),e.font="14px sans-serif",e.fillStyle="rgba(200, 255, 200, 0.9)",e.fillText("üëÜ Drag to move  ‚Ä¢  üîç Scroll/Pinch to zoom",0,20),e.font="bold 14px sans-serif",e.fillStyle="rgba(100, 255, 100, 0.9)",e.fillText('Click "Confirm Detection" when ready',0,60)):(e.fillText("ANALYZING IMAGE...",0,-20),e.font="12px sans-serif",e.fillText(`${Math.round(R*100)}%`,0,10))}}catch(R){console.warn("radar animation failed",R)}if(_()&&o()){const R=1e3/i(),K=n(Te)%R/R,O=Math.max(0,Math.min(1,(i()-40)/30));let A;if(O<.33?A=K>.5?.85:0:O<.67?A=Math.sin(K*Math.PI*2)*.5+.5>.6?.6:0:A=(Math.sin(K*Math.PI*2)*.5+.5)*.3,A>.05){const be=e.createRadialGradient(g/2,C/2,0,g/2,C/2,Math.max(g,C)*.8);be.addColorStop(0,`rgba(0, 0, 0, ${A*.7})`),be.addColorStop(.5,`rgba(0, 0, 0, ${A})`),be.addColorStop(1,`rgba(0, 0, 0, ${A*.9})`),e.fillStyle=be,e.fillRect(-g,-C,g*3,C*3),O<.5&&(e.fillStyle=`rgba(20, 20, 40, ${A*.15})`,e.fillRect(-g,-C,g*3,C*3))}e.save(),e.translate(g/2,C/2);const L=-g/2+15,ie=-C/2+15;let ge,me;i()<50?(ge="rgba(255, 100, 100, 0.9)",me="FLICKER"):i()<60?(ge="rgba(255, 180, 50, 0.9)",me="THRESHOLD"):(ge="rgba(100, 220, 100, 0.9)",me="FUSED"),e.fillStyle="rgba(0, 0, 0, 0.75)",e.beginPath(),e.roundRect(L,ie,85,18,4),e.fill(),e.font="bold 11px monospace",e.fillStyle=ge,e.textAlign="left",e.textBaseline="middle",e.fillText(`${i()}Hz`,L+5,ie+9),e.font="9px sans-serif",e.fillStyle="rgba(255, 255, 255, 0.7)",e.fillText(me,L+42,ie+9),e.restore()}if(e.restore(),a()||M()){const R=Date.now()%1e3/1e3,K=.7+.3*Math.sin(R*Math.PI*2);e.save(),e.translate(g/2,C/2);const O=r()||w()||12;if(a()&&O>0){const L=Math.min(g,C)*.3,ie=Math.PI*2/O;for(let ge=0;ge<O;ge++){const me=ge*ie-Math.PI/2,be=me+ie,Ue=.15+.1*(ge%2*.5);e.fillStyle=`rgba(100, 200, 255, ${Ue})`,e.beginPath(),e.moveTo(0,0),e.arc(0,0,L,me,be),e.closePath(),e.fill(),e.strokeStyle=`rgba(100, 200, 255, ${.4*K})`,e.lineWidth=2,e.beginPath(),e.moveTo(0,0),e.lineTo(Math.cos(me)*L,Math.sin(me)*L),e.stroke()}e.strokeStyle=`rgba(100, 200, 255, ${.5*K})`,e.lineWidth=3,e.beginPath(),e.arc(0,0,L,0,Math.PI*2),e.stroke()}e.strokeStyle=`rgba(255, 100, 0, ${K})`,e.lineWidth=4;const A=Math.min(g,C)*.1;e.beginPath(),e.arc(0,0,A*.7,0,Math.PI*2),e.stroke(),e.lineWidth=3,e.beginPath(),e.moveTo(-A,0),e.lineTo(A,0),e.stroke(),e.beginPath(),e.moveTo(0,-A),e.lineTo(0,A),e.stroke(),e.beginPath(),e.arc(0,0,10+3*Math.sin(R*Math.PI*2),0,Math.PI*2),e.fillStyle=`rgba(255, 100, 0, ${K})`,e.fill(),e.strokeStyle="rgba(255, 255, 255, 0.9)",e.lineWidth=2,e.stroke(),e.beginPath(),e.arc(0,0,3,0,Math.PI*2),e.fillStyle="rgba(255, 255, 255, 0.95)",e.fill(),e.restore()}}Pe(()=>a(),()=>{a()&&(I(H,0),I(X,0),I(T,1),Ee())}),Pe(()=>(n(H),n(X),n(T)),()=>{Wn.set({translateX:n(H),translateY:n(X),scale:n(T)})}),Pe(()=>(o(),Ut),()=>{o()&&Ut.set(!1)}),Pe(()=>(d(),n(F)),()=>{d()?Tt(d()):(n(F)&&I(F,null),I(Ne,!1),Ee())}),Pe(()=>r(),()=>{r()!==void 0&&Ee()}),Pe(()=>(o(),x(),a(),n(he)),()=>{o()||x().active||a()?n(he)||I(he,requestAnimationFrame(At)):n(he)&&(cancelAnimationFrame(n(he)),I(he,null),I(Te,0))}),Yn(),on();var ot=Ei(),Kt=$(ot);aa(Kt,g=>I(y,g),()=>n(y));var _t=k(Kt,2);{var lt=g=>{var C=Ti(),U=$(C);E(C),Ce(ee=>Oe(U,`Speed: ${ee??""}¬∞/s`),[()=>(h(),Je(()=>h().toFixed(0)))]),D(g,C)};se(_t,g=>{(n($e)||c())&&g(lt)})}var Zt=k(_t,2);{var cn=g=>{var C=$i(),U=k(Be(C),2),ee=k($(U),2),J=$(ee),B=k(J,2),_e=$(B),tt=$(_e,!0);E(_e),an(2),E(B);var De=k(B,2);E(ee),E(U),Ce(()=>Oe(tt,r()||12)),z("click",J,Me(()=>Yt.set(Math.max(6,(r()||12)-1)))),z("pointerdown",J,Me(function(oe){Mt.call(this,s,oe)})),z("pointermove",J,Me(function(oe){Mt.call(this,s,oe)})),z("pointerup",J,Me(function(oe){Mt.call(this,s,oe)})),z("click",De,Me(()=>Yt.set(Math.min(100,(r()||12)+1)))),z("pointerdown",De,Me(function(oe){Mt.call(this,s,oe)})),z("pointermove",De,Me(function(oe){Mt.call(this,s,oe)})),z("pointerup",De,Me(function(oe){Mt.call(this,s,oe)})),D(g,C)};se(Zt,g=>{a()&&g(cn)})}E(ot),aa(ot,g=>I(p,g),()=>n(p)),Ce(()=>sn(ot,1,`canvas-wrapper ${a()?"edit-mode":""}`,"svelte-byh4af")),D(t,ot),Bt(),m()}async function Ai(t,s,a={}){const{x:o,y:d,r}=s||{x:t.width/2,y:t.height/2,r:Math.min(t.width,t.height)/2},c=a.samples||720,h=a.innerOffset||-Math.max(2,Math.round(r*.06)),x=a.outerOffset||Math.max(2,Math.round(r*.06)),v=a.thresholdFactor||.6,l=document.createElement("canvas");l.width=t.width,l.height=t.height;const b=l.getContext("2d");b.drawImage(t,0,0);const w=b.getImageData(0,0,l.width,l.height).data,P=l.width,M=l.height;function _(q,ae){const fe=Math.round(q),Se=Math.round(ae);if(fe<0||fe>=P||Se<0||Se>=M)return 0;const he=(Se*P+fe)*4,Ie=w[he],Ke=w[he+1],Te=w[he+2];return .2126*Ie+.7152*Ke+.0722*Te}const i=new Array(c);for(let q=0;q<c;q++){const ae=q/c*Math.PI*2,fe=[],Se=3;for(let Ie=0;Ie<Se;Ie++){const Ke=Ie/(Se-1),Te=r+h+(x-h)*Ke,et=o+Te*Math.cos(ae),gt=d+Te*Math.sin(ae);fe.push(_(et,gt))}const he=fe.reduce((Ie,Ke)=>Ie+Ke,0)/fe.length;i[q]=he}const u=i.reduce((q,ae)=>q+ae,0)/i.length,m=Math.sqrt(i.reduce((q,ae)=>q+(ae-u)**2,0)/i.length),p=u+m*v,y=i.map(q=>q>p);let e=0,j=!1,T=[],ne=0;for(let q=0;q<y.length*2;q++){const ae=q%y.length;if(y[ae]?(ne++,j=!0):(j&&(T.push(ne),ne=0),j=!1),q>=y.length&&!j)break}j&&ne>0&&T.push(ne);const ce=Math.max(2,Math.round(c/360*(a.minDegrees||5))),H=T.filter(q=>q>=ce);e=H.length;const X=[];let Q=0;for(const q of T){const ae=Q%c,fe=(Q+q-1)%c,Se=(ae+Math.floor(q/2))%c;X.push({start:ae,end:fe,mid:Se,angle:Se/c*2*Math.PI}),Q+=q+1}return{count:e,samples:i,mask:y,groups:H,positions:X,canvas:l}}function qi(t,s=24,a={}){const o=[],{width:d,height:r}=t,c=a.circle||{x:d/2,y:r/2,r:Math.min(d,r)/2},h=a.margin??1.05,x=Math.round(c.r*h),v=x*2,l=a.outputSize||Math.max(32,Math.round(v)),b=a.fps||24,w=typeof a.rotationSpeed=="number"?a.rotationSpeed:0,P=a.direction==null?1:a.direction,M=document.createElement("canvas");M.width=v,M.height=v;const _=M.getContext("2d"),i=Math.round(c.x-x),u=Math.round(c.y-x);try{_.drawImage(t,i,u,v,v,0,0,v,v)}catch{_.drawImage(t,0,0)}const p=w/b*Math.PI/180*P;Math.round(v*(a.zoom||1));for(let y=0;y<s;y++){const e=y*p,j=document.createElement("canvas");j.width=l,j.height=l;const T=j.getContext("2d");T.translate(l/2,l/2),T.rotate(e);const ne=Math.round(v*(a.zoom||1)),ce=ne;T.drawImage(M,-ne/2,-ce/2,ne,ce),o.push(j)}return o}function Fi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function nn(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qn={exports:{}},ca;function Li(){return ca||(ca=1,(function(t,s){(function(a){t.exports=a()})(function(){return(function a(o,d,r){function c(v,l){if(!d[v]){if(!o[v]){var b=typeof nn=="function"&&nn;if(!l&&b)return b(v,!0);if(h)return h(v,!0);var w=new Error("Cannot find module '"+v+"'");throw w.code="MODULE_NOT_FOUND",w}var P=d[v]={exports:{}};o[v][0].call(P.exports,function(M){var _=o[v][1][M];return c(_||M)},P,P.exports,a,o,d,r)}return d[v].exports}for(var h=typeof nn=="function"&&nn,x=0;x<r.length;x++)c(r[x]);return c})({1:[function(a,o,d){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}o.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(l){if(!h(l)||l<0||isNaN(l))throw TypeError("n must be a positive number");return this._maxListeners=l,this},r.prototype.emit=function(l){var b,w,P,M,_,i;if(this._events||(this._events={}),l==="error"&&(!this._events.error||x(this._events.error)&&!this._events.error.length)){if(b=arguments[1],b instanceof Error)throw b;var u=new Error('Uncaught, unspecified "error" event. ('+b+")");throw u.context=b,u}if(w=this._events[l],v(w))return!1;if(c(w))switch(arguments.length){case 1:w.call(this);break;case 2:w.call(this,arguments[1]);break;case 3:w.call(this,arguments[1],arguments[2]);break;default:M=Array.prototype.slice.call(arguments,1),w.apply(this,M)}else if(x(w))for(M=Array.prototype.slice.call(arguments,1),i=w.slice(),P=i.length,_=0;_<P;_++)i[_].apply(this,M);return!0},r.prototype.addListener=function(l,b){var w;if(!c(b))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",l,c(b.listener)?b.listener:b),this._events[l]?x(this._events[l])?this._events[l].push(b):this._events[l]=[this._events[l],b]:this._events[l]=b,x(this._events[l])&&!this._events[l].warned&&(v(this._maxListeners)?w=r.defaultMaxListeners:w=this._maxListeners,w&&w>0&&this._events[l].length>w&&(this._events[l].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[l].length),typeof console.trace=="function"&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(l,b){if(!c(b))throw TypeError("listener must be a function");var w=!1;function P(){this.removeListener(l,P),w||(w=!0,b.apply(this,arguments))}return P.listener=b,this.on(l,P),this},r.prototype.removeListener=function(l,b){var w,P,M,_;if(!c(b))throw TypeError("listener must be a function");if(!this._events||!this._events[l])return this;if(w=this._events[l],M=w.length,P=-1,w===b||c(w.listener)&&w.listener===b)delete this._events[l],this._events.removeListener&&this.emit("removeListener",l,b);else if(x(w)){for(_=M;_-- >0;)if(w[_]===b||w[_].listener&&w[_].listener===b){P=_;break}if(P<0)return this;w.length===1?(w.length=0,delete this._events[l]):w.splice(P,1),this._events.removeListener&&this.emit("removeListener",l,b)}return this},r.prototype.removeAllListeners=function(l){var b,w;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[l]&&delete this._events[l],this;if(arguments.length===0){for(b in this._events)b!=="removeListener"&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(w=this._events[l],c(w))this.removeListener(l,w);else if(w)for(;w.length;)this.removeListener(l,w[w.length-1]);return delete this._events[l],this},r.prototype.listeners=function(l){var b;return!this._events||!this._events[l]?b=[]:c(this._events[l])?b=[this._events[l]]:b=this._events[l].slice(),b},r.prototype.listenerCount=function(l){if(this._events){var b=this._events[l];if(c(b))return 1;if(b)return b.length}return 0},r.listenerCount=function(l,b){return l.listenerCount(b)};function c(l){return typeof l=="function"}function h(l){return typeof l=="number"}function x(l){return typeof l=="object"&&l!==null}function v(l){return l===void 0}},{}],2:[function(a,o,d){var r,c,h,x,v;v=navigator.userAgent.toLowerCase(),x=navigator.platform.toLowerCase(),r=v.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],h=r[1]==="ie"&&document.documentMode,c={name:r[1]==="version"?r[3]:r[1],version:h||parseFloat(r[1]==="opera"&&r[4]?r[4]:r[2]),platform:{name:v.match(/ip(?:ad|od|hone)/)?"ios":(v.match(/(?:webos|android)/)||x.match(/mac|win|linux/)||["other"])[0]}},c[c.name]=!0,c[c.name+parseInt(c.version,10)]=!0,c.platform[c.platform.name]=!0,o.exports=c},{}],3:[function(a,o,d){var r,c,h,x=function(w,P){for(var M in P)v.call(P,M)&&(w[M]=P[M]);function _(){this.constructor=w}return _.prototype=P.prototype,w.prototype=new _,w.__super__=P.prototype,w},v={}.hasOwnProperty,l=[].indexOf||function(w){for(var P=0,M=this.length;P<M;P++)if(P in this&&this[P]===w)return P;return-1},b=[].slice;r=a("events").EventEmitter,h=a("./browser.coffee"),c=(function(w){var P,M;x(_,w),P={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},M={delay:500,copy:!1};function _(i){var u,m,p;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(i);for(m in P)p=P[m],(u=this.options)[m]==null&&(u[m]=p)}return _.prototype.setOption=function(i,u){if(this.options[i]=u,this._canvas!=null&&(i==="width"||i==="height"))return this._canvas[i]=u},_.prototype.setOptions=function(i){var u,m,p;m=[];for(u in i)v.call(i,u)&&(p=i[u],m.push(this.setOption(u,p)));return m},_.prototype.addFrame=function(i,u){var m,p;u==null&&(u={}),m={},m.transparent=this.options.transparent;for(p in M)m[p]=u[p]||M[p];if(this.options.width==null&&this.setOption("width",i.width),this.options.height==null&&this.setOption("height",i.height),typeof ImageData<"u"&&ImageData!==null&&i instanceof ImageData)m.data=i.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&i instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&i instanceof WebGLRenderingContext)u.copy?m.data=this.getContextData(i):m.context=i;else if(i.childNodes!=null)u.copy?m.data=this.getImageData(i):m.image=i;else throw new Error("Invalid image");return this.frames.push(m)},_.prototype.render=function(){var i,u,m;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var p,y,e;for(e=[],p=0,y=this.frames.length;0<=y?p<y:p>y;0<=y?++p:--p)e.push(null);return e}).call(this),u=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(i=0,m=u;0<=m?i<m:i>m;0<=m?++i:--i)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},_.prototype.abort=function(){for(var i;i=this.activeWorkers.shift(),i!=null;)this.log("killing active worker"),i.terminate();return this.running=!1,this.emit("abort")},_.prototype.spawnWorkers=function(){var i,u,m;return i=Math.min(this.options.workers,this.frames.length),(function(){m=[];for(var p=u=this.freeWorkers.length;u<=i?p<i:p>i;u<=i?p++:p--)m.push(p);return m}).apply(this).forEach((function(p){return function(y){var e;return p.log("spawning worker "+y),e=new Worker(p.options.workerScript),e.onmessage=function(j){return p.activeWorkers.splice(p.activeWorkers.indexOf(e),1),p.freeWorkers.push(e),p.frameFinished(j.data)},p.freeWorkers.push(e)}})(this)),i},_.prototype.frameFinished=function(i){var u,m;if(this.log("frame "+i.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[i.index]=i,this.options.globalPalette===!0&&(this.options.globalPalette=i.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(u=1,m=this.freeWorkers.length;1<=m?u<m:u>m;1<=m?++u:--u)this.renderNextFrame();return l.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},_.prototype.finishRendering=function(){var i,u,m,p,y,e,j,T,ne,ce,H,X,Q,q,ae,fe;for(T=0,q=this.imageParts,y=0,ne=q.length;y<ne;y++)u=q[y],T+=(u.data.length-1)*u.pageSize+u.cursor;for(T+=u.pageSize-u.cursor,this.log("rendering finished - filesize "+Math.round(T/1e3)+"kb"),i=new Uint8Array(T),X=0,ae=this.imageParts,e=0,ce=ae.length;e<ce;e++)for(u=ae[e],fe=u.data,m=j=0,H=fe.length;j<H;m=++j)Q=fe[m],i.set(Q,X),m===u.data.length-1?X+=u.cursor:X+=u.pageSize;return p=new Blob([i],{type:"image/gif"}),this.emit("finished",p,i)},_.prototype.renderNextFrame=function(){var i,u,m;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return i=this.frames[this.nextFrame++],m=this.freeWorkers.shift(),u=this.getTask(i),this.log("starting frame "+(u.index+1)+" of "+this.frames.length),this.activeWorkers.push(m),m.postMessage(u)},_.prototype.getContextData=function(i){return i.getImageData(0,0,this.options.width,this.options.height).data},_.prototype.getImageData=function(i){var u;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),u=this._canvas.getContext("2d"),u.setFill=this.options.background,u.fillRect(0,0,this.options.width,this.options.height),u.drawImage(i,0,0),this.getContextData(u)},_.prototype.getTask=function(i){var u,m;if(u=this.frames.indexOf(i),m={index:u,last:u===this.frames.length-1,delay:i.delay,transparent:i.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:h.name==="chrome"},i.data!=null)m.data=i.data;else if(i.context!=null)m.data=this.getContextData(i.context);else if(i.image!=null)m.data=this.getImageData(i.image);else throw new Error("Invalid frame");return m},_.prototype.log=function(){var i;if(i=1<=arguments.length?b.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,i)},_})(r),o.exports=c},{"./browser.coffee":2,events:1}]},{},[3])(3)})})(qn)),qn.exports}var zi=Li();const Ri=Fi(zi),Oi=""+new URL("../assets/gif.worker.CjkyQP34.js",import.meta.url).href;async function Wi(t,s=24){if(!t||t.length===0)throw new Error("No frames to export");const a=new Ri({workers:2,quality:10,width:t[0].width,height:t[0].height,workerScript:Oi,repeat:0,background:null,comment:"Created with Phenakistoscope Lab - https://tclaret.github.io/phenaki-lab/"}),o=Math.round(1e3/s);for(const d of t){const r=d.width,c=d.height,h=document.createElement("canvas");h.width=r,h.height=c;const x=h.getContext("2d");x.fillStyle="#ffffff",x.fillRect(0,0,r,c),x.drawImage(d,0,0),a.addFrame(h,{delay:o,copy:!0})}return new Promise((d,r)=>{a.on("finished",function(c){const h=URL.createObjectURL(c);d(h)}),a.on("error",r),a.render()})}var Ni=ve('<div class="export-overlay svelte-14nyow8" role="status" aria-live="polite"><div class="export-box svelte-14nyow8"><div class="spinner svelte-14nyow8" aria-hidden="true"></div> <div class="export-text svelte-14nyow8">Working‚Ä¶ Exporting GIF ‚Äî please wait</div></div></div>'),ji=ve('<button class="confirm-btn svelte-14nyow8">Confirm Detection</button> <button class="svelte-14nyow8">Cancel</button>',1),Gi=ve("<button>Detect Circle & Count</button>"),Hi=ve('<span style="background: #4a9eff; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75em; font-weight: bold; margin-left: 4px;" class="svelte-14nyow8"> </span>'),Ui=ve('<div style="margin-top: 16px; padding: 12px; background: rgba(74, 158, 255, 0.08); border-radius: 6px; border: 1px solid rgba(74, 158, 255, 0.2);" class="svelte-14nyow8"><div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px;" class="svelte-14nyow8"><div style="font-weight: 600; color: #4a9eff; font-size: 0.95em;" class="svelte-14nyow8">‚ö° Flicker Fusion Threshold</div> <a href="https://en.wikipedia.org/wiki/Flicker_fusion_threshold" target="_blank" rel="noopener noreferrer" style="display: flex; align-items: center; gap: 4px; font-size: 0.75em; color: #aaa; text-decoration: none; opacity: 0.7; transition: opacity 0.2s;" title="Learn more on Wikipedia" class="svelte-14nyow8"><svg width="14" height="14" viewBox="0 0 240 240" xmlns="http://www.w3.org/2000/svg" class="svelte-14nyow8"><path fill="currentColor" d="M120 0C53.8 0 0 53.8 0 120s53.8 120 120 120 120-53.8 120-120S186.2 0 120 0zm0 217.5c-53.8 0-97.5-43.7-97.5-97.5S66.2 22.5 120 22.5s97.5 43.7 97.5 97.5-43.7 97.5-97.5 97.5zm-7.5-165h15v90h-15zm0 105h15v15h-15z" class="svelte-14nyow8"></path></svg> <span class="svelte-14nyow8">Wikipedia</span></a></div> <div style="font-size: 0.8em; color: #888; font-style: italic; margin-bottom: 10px;" class="svelte-14nyow8">Note: This test only affects visualization, not the exported GIF</div> <div style="margin-bottom: 12px;" class="svelte-14nyow8"><div style="font-size: 0.85em; color: #aaa; margin-bottom: 6px;" class="svelte-14nyow8">Quick Presets:</div> <div style="display: flex; gap: 6px; flex-wrap: wrap;" class="svelte-14nyow8"><button class="flicker-preset-btn svelte-14nyow8">30 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">42 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">50 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">55 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">60 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">70 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">80 Hz</button> <button class="flicker-preset-btn svelte-14nyow8">100 Hz</button></div></div> <div style="margin-top: 12px;" class="svelte-14nyow8"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;" class="svelte-14nyow8"><span style="font-size: 0.85em; color: #ccc;" class="svelte-14nyow8">Fine Tune:</span> <span style="font-size: 1.1em; font-weight: bold; color: #4a9eff;" class="svelte-14nyow8"> </span></div> <input type="range" min="20" max="100" step="0.5" style="width: 100%; cursor: pointer;" class="svelte-14nyow8"/> <div style="display: flex; justify-content: space-between; font-size: 0.7em; color: #666; margin-top: 4px;" class="svelte-14nyow8"><span class="svelte-14nyow8">20 Hz</span> <span style="color: #4a9eff; font-weight: 500;" class="svelte-14nyow8"><!></span> <span class="svelte-14nyow8">100 Hz</span></div></div> <div style="margin-top: 10px; padding: 8px; background: rgba(74, 158, 255, 0.12); border-radius: 4px; font-size: 0.8em;" class="svelte-14nyow8"><div style="font-weight: 500; color: #4a9eff; margin-bottom: 3px;" class="svelte-14nyow8"><!></div> <div style="color: #aaa; font-size: 0.9em;" class="svelte-14nyow8"><!></div></div></div>'),Yi=ve('<div class="drag-handle svelte-14nyow8" title="Drag to move">‚ãÆ‚ãÆ</div>'),Xi=ve('<div><!> <div style="display:flex;gap:12px;align-items:center;" class="svelte-14nyow8"><button class="speed-btn svelte-14nyow8">‚àí</button> <div style="text-align:center;min-width:120px;" class="svelte-14nyow8"><div class="speed-display svelte-14nyow8"> </div> <div style="font-size:11px;opacity:0.6;margin-top:4px;" class="svelte-14nyow8">Rotation Speed</div></div> <button class="speed-btn svelte-14nyow8">+</button></div></div>'),Bi=ve('<em style="font-size:12px;opacity:0.7;" class="svelte-14nyow8">(Use +/‚àí buttons above to adjust speed)</em>'),Vi=ve('<em style="font-size:12px;opacity:0.7;" class="svelte-14nyow8">(Touch: drag up to speed up, down to slow down)</em>'),Ji=ve('<div class="svelte-14nyow8"><strong class="svelte-14nyow8">Circle:</strong> </div>'),Ki=ve('<div class="panel svelte-14nyow8"><!> <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;" class="svelte-14nyow8"><button> </button> <button class="svelte-14nyow8">Reverse</button> <!> <button class="svelte-14nyow8">Apply Suggested Speed</button> <div class="gif-export-group svelte-14nyow8"><button class="save-gif-btn svelte-14nyow8"> </button> <label style="display:flex;align-items:center;gap:6px;" class="svelte-14nyow8"><span style="font-size:12px;opacity:0.8;" class="svelte-14nyow8">Frames:</span> <input type="number" min="6" step="1" style="width:80px;padding:4px;border-radius:4px;border:1px solid #ccc;" class="svelte-14nyow8"/> <span style="font-size:11px;opacity:0.6;" title="Leave empty for auto-detection" class="svelte-14nyow8"><!></span></label> <label style="display:flex;align-items:center;gap:6px;" class="svelte-14nyow8"><span style="font-size:12px;opacity:0.8;" class="svelte-14nyow8">FPS:</span> <select style="padding:4px;border-radius:4px;border:1px solid #ccc;background:#333;color:white;" class="svelte-14nyow8"><option class="svelte-14nyow8">3 (Ultra Slow)</option><option class="svelte-14nyow8">5 (Very Slow)</option><option class="svelte-14nyow8">8 (Slow)</option><option class="svelte-14nyow8">10 (Classic)</option><option class="svelte-14nyow8">15 (Natural)</option><option class="svelte-14nyow8">20 (Smooth)</option><option class="svelte-14nyow8">24 (Cinema)</option><option class="svelte-14nyow8">30 (Fast)</option></select></label></div> <label style="display:flex;align-items:center;gap:6px;margin-left:6px;" class="svelte-14nyow8"><input type="checkbox" class="svelte-14nyow8"/> <span class="svelte-14nyow8">Show Overlay</span></label> <label style="display:flex;align-items:center;gap:6px;margin-left:6px;" class="svelte-14nyow8"><input type="checkbox" class="svelte-14nyow8"/> <span class="svelte-14nyow8">Flicker Effect</span> <!></label></div> <!> <!> <div style="margin-top:12px;" class="svelte-14nyow8"><div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;" class="svelte-14nyow8"><div class="svelte-14nyow8"><strong class="svelte-14nyow8">Current Speed:</strong> <!></div> <div style="display:flex;gap:6px;align-items:center;" class="svelte-14nyow8"><label for="manual-speed-input" style="font-size:12px;" class="svelte-14nyow8">Type speed:</label> <input id="manual-speed-input" type="number" min="1" step="1" style="width:100px;padding:6px;border-radius:4px;border:1px solid #ccc;" class="svelte-14nyow8"/> <button class="svelte-14nyow8">Set</button></div></div> <div class="svelte-14nyow8"><strong class="svelte-14nyow8">Selected scenes count:</strong> </div> <div class="svelte-14nyow8"><strong class="svelte-14nyow8">Suggested speed:</strong> </div> <!></div></div>');function Zi(t,s){Xt(s,!1);const a=()=>Y(vt,"$isPlaying",i),o=()=>Y(zn,"$detectedCircle",i),d=()=>Y(ft,"$rotationSpeed",i),r=()=>Y(Pt,"$imageUrl",i),c=()=>Y(Wn,"$canvasTransform",i),h=()=>Y(Nn,"$playerCanvas",i),x=()=>Y(Yt,"$gifFrameCount",i),v=()=>Y(Gn,"$isMobile",i),l=()=>Y(Rn,"$detectedCount",i),b=()=>Y(An,"$suggestedRotationSpeed",i),w=()=>Y(On,"$overlayVisible",i),P=()=>Y(St,"$editMode",i),M=()=>Y(jn,"$flickerEnabled",i),_=()=>Y(Xe,"$flickerFrequency",i),[i,u]=ln(),m=te(),p=te(),y=te(),e=te(),j=te(),T=te();let ne=te(!1),ce=te(!1);async function H(){vt.update(f=>!f)}let X=null;function Q(f){f==="increase"?ae():fe(),X&&clearInterval(X),X=setInterval(()=>{f==="increase"?ae():fe()},100)}function q(){X&&(clearInterval(X),X=null)}function ae(){ft.update(f=>Math.min(1e4,f+60)),jt.set(!0)}function fe(){ft.update(f=>Math.max(10,f-60)),jt.set(!0)}function Se(){Ln.update(f=>f*-1)}async function he(){if(!r())return;const S=Date.now();Gt.set({active:!0,progress:0,startTime:S}),St.set(!0)}async function Ie(){const f=r();if(!f)return;I(ne,!0);const S=c();St.set(!1);const G=Date.now();Gt.set({active:!0,progress:0,startTime:G}),a()||requestAnimationFrame(()=>{});try{const W=await At(f);let V=null;const Z=h();if(Z){const Fe=Z.clientWidth,ht=Z.clientHeight,kt=W.width/W.height,gn=Fe/ht;let ct,Ft;kt>gn?(ct=Fe,Ft=Fe/kt):(Ft=ht,ct=ht*kt);const en=-S.translateX,mn=-S.translateY,_n=en/S.scale,wn=mn/S.scale,Lt=W.width/ct,zt=_n*Lt+W.width/2,yn=wn*Lt+W.height/2;V={x:zt,y:yn,r:Math.min(W.width,W.height)/2*.9}}V||(V={x:W.width/2,y:W.height/2,r:Math.min(W.width,W.height)/2*.9});const ue=await Ai(W,V,{samples:720}),Qe=2e3-(Date.now()-G);Qe>0&&await new Promise(Fe=>setTimeout(Fe,Qe)),zn.set(V),Rn.set(ue.count),wa.set(ue.positions||[]);const Ae=(ue.count>0?360/ue.count:1)*30;An.set(Ae),Gt.set({active:!1,progress:1,startTime:G}),Ut.set(!0),vt.set(!1)}finally{I(ne,!1)}}function Ke(){An.subscribe(f=>{f&&(ft.set(f),jt.set(!0))})()}function Te(){St.set(!1),Ut.set(!1),Gt.set({active:!1,progress:0,startTime:0})}let et=te(0);function gt(){const f=Number(n(et))||0;f<0||(ft.set(f),jt.set(!0))}let $e=te(!1),we=te(15);async function Ct(){const f=r()||Tn(Pt);if(!f)return alert("No image loaded to export.");if(!n(y))return alert("Please detect the circle before exporting the GIF.");const S=await At(f),G=document.createElement("canvas");G.width=S.width,G.height=S.height,G.getContext("2d").drawImage(S,0,0,S.width,S.height),I($e,!0);try{let V;n(p)&&n(p)!==n(e)*2?V=n(p):n(e)&&n(e)>0?V=Math.max(12,n(e)*2):V=n(p)||24;const Z=n(y),ue=Number(Tn(ft)||0),je=Number(Tn(Ln)||1),Qe=360/V,Ge=qi(G,V,{circle:Z,margin:1.1,zoom:1,fps:n(we),rotationSpeed:Qe*n(we),direction:je}),He=await Wi(Ge,n(we)),Ae=document.createElement("a");Ae.href=He;const Fe=new Date().toISOString().slice(0,19).replace(/:/g,"-");Ae.download=`phenaki-lab_${Fe}_${Ge.length}frames_${n(we)}fps.gif`,document.body.appendChild(Ae),Ae.click(),Ae.remove()}catch(V){console.error("GIF export failed",V),alert("GIF export failed: "+(V&&V.message))}finally{I($e,!1)}}const It="phenaki.speedControlPos";let N=te({left:null,top:null}),F=te(!1),Ne=te(!1),Ze={x:0,y:0},Tt={left:0,top:0},mt=0;function Vt(){try{const f=localStorage.getItem(It);f&&I(N,JSON.parse(f))}catch{}}function $t(){try{localStorage.setItem(It,JSON.stringify(n(N)))}catch{}}function Jt(f){const S=Date.now(),G=S-mt<300;if(mt=S,f.target&&f.target.closest&&f.target.closest("button"))return;const W=f.target&&f.target.closest&&f.target.closest(".drag-handle"),V=v(),Z=f.target&&f.target.closest&&(f.target.classList.contains("speed-display")||f.target.closest(".speed-display"));if(!(!W&&!G&&!V&&!Z)&&!(V&&!W&&!Z)){I(F,!0),I(Ne,!0),Ze={x:f.clientX,y:f.clientY},Tt={left:n(N).left??Math.round((window.innerWidth-200)/2),top:n(N).top??Math.round((window.innerHeight-80)/2)};try{f.target.setPointerCapture(f.pointerId)}catch{}window.addEventListener("pointermove",Et),window.addEventListener("pointerup",Dt)}}function Et(f){if(!n(Ne))return;const S=f.clientX-Ze.x,G=f.clientY-Ze.y;re(N,n(N).left=Math.round(Tt.left+S)),re(N,n(N).top=Math.round(Tt.top+G))}function Dt(f){I(Ne,!1),I(F,!1);try{f.target.releasePointerCapture&&f.target.releasePointerCapture(f.pointerId)}catch{}window.removeEventListener("pointermove",Et),window.removeEventListener("pointerup",Dt),$t()}Xn(()=>{Vt(),n(N).left==null&&re(N,n(N).left=Math.round((window.innerWidth-200)/2)),n(N).top==null&&re(N,n(N).top=Math.round((window.innerHeight-80)/2));function f(){const ue=Math.max(8,window.innerWidth-200-8),je=Math.max(8,window.innerHeight-80-8);n(N).left==null&&re(N,n(N).left=ue),n(N).top==null&&re(N,n(N).top=je),re(N,n(N).left=Math.min(Math.max(n(N).left,8),ue)),re(N,n(N).top=Math.min(Math.max(n(N).top,8),je))}f();const S=()=>{f(),$t()};return window.addEventListener("resize",S),()=>window.removeEventListener("resize",S)});function At(f){return new Promise((S,G)=>{const W=new Image;W.crossOrigin="anonymous",W.onload=()=>S(W),W.onerror=G,W.src=f})}Pe(()=>a(),()=>{a()&&I(ce,!0)}),Pe(()=>(o(),a(),d()),()=>{I(m,!!o()&&a()&&d()>0)}),Pe(()=>d(),()=>{I(et,Number(d()||0))}),Pe(()=>x(),()=>{I(p,x())}),Pe(()=>o(),()=>{I(y,o())}),Pe(()=>l(),()=>{I(e,l())}),Pe(()=>b(),()=>{I(j,b())}),Pe(()=>w(),()=>{I(T,w())}),Yn(),on();var Ee=Ki(),ot=$(Ee);{var Kt=f=>{var S=Ni();D(f,S)};se(ot,f=>{n($e)&&f(Kt)})}var _t=k(ot,2),lt=$(_t);let Zt;var cn=$(lt,!0);E(lt);var g=k(lt,2),C=k(g,2);{var U=f=>{var S=ji(),G=Be(S),W=k(G,2);Ce(()=>G.disabled=n(ne)),z("click",G,Ie),z("click",W,Te),D(f,S)},ee=f=>{var S=Gi();Ce(()=>{sn(S,1,ia(n(y)?"":"detect-btn-required"),"svelte-14nyow8"),S.disabled=n(ne)||!r()}),z("click",S,he),D(f,S)};se(C,f=>{P()?f(U):f(ee,!1)})}var J=k(C,2),B=k(J,2),_e=$(B),tt=$(_e,!0);E(_e);var De=k(_e,2),oe=k($(De),2);Nt(oe);var R=k(oe,2),K=$(R);{var O=f=>{var S=ke("Manual");D(f,S)},A=f=>{var S=st(),G=Be(S);{var W=Z=>{var ue=ke("Auto (x2)");D(Z,ue)},V=Z=>{var ue=ke("Auto");D(Z,ue)};se(G,Z=>{n(e)?Z(W):Z(V,!1)},!0)}D(f,S)};se(K,f=>{n(p)?f(O):f(A,!1)})}E(R),E(De);var L=k(De,2),ie=k($(L),2);Ce(()=>{n(we),va(()=>{})});var ge=$(ie);ge.value=ge.__value=3;var me=k(ge);me.value=me.__value=5;var be=k(me);be.value=be.__value=8;var Ue=k(be);Ue.value=Ue.__value=10;var ut=k(Ue);ut.value=ut.__value=15;var wt=k(ut);wt.value=wt.__value=20;var yt=k(wt);yt.value=yt.__value=24;var qt=k(yt);qt.value=qt.__value=30,E(ie),E(L),E(B);var bt=k(B,2),xt=$(bt);Nt(xt),an(2),E(bt);var dt=k(bt,2),ye=$(dt);Nt(ye);var xe=k(ye,4);{var nt=f=>{var S=Hi(),G=$(S);E(S),Ce(()=>Oe(G,`${_()??""} Hz`)),D(f,S)};se(xe,f=>{M()&&f(nt)})}E(dt),E(_t);var Ye=k(_t,2);{var fn=f=>{var S=Ui(),G=k($(S),4),W=k($(G),2),V=$(W),Z=k(V,2),ue=k(Z,2),je=k(ue,2),Qe=k(je,2),Ge=k(Qe,2),He=k(Ge,2),Ae=k(He,2);E(W),E(G);var Fe=k(G,2),ht=$(Fe),kt=k($(ht),2),gn=$(kt);E(kt),E(ht);var ct=k(ht,2);Nt(ct);var Ft=k(ct,2),en=k($(Ft),2),mn=$(en);{var _n=le=>{var qe=ke("üî¥ Flicker");D(le,qe)},wn=le=>{var qe=st(),Rt=Be(qe);{var Ot=pe=>{var Le=ke("üü° Fusion");D(pe,Le)},Wt=pe=>{var Le=ke("üü¢ Smooth");D(pe,Le)};se(Rt,pe=>{_()<60?pe(Ot):pe(Wt,!1)},!0)}D(le,qe)};se(mn,le=>{_()<40?le(_n):le(wn,!1)})}E(en),an(2),E(Ft),E(Fe);var Lt=k(Fe,2),zt=$(Lt),yn=$(zt);{var Ta=le=>{var qe=ke("‚ö° Strong Flicker");D(le,qe)},$a=le=>{var qe=st(),Rt=Be(qe);{var Ot=pe=>{var Le=ke("üéØ Critical Threshold");D(pe,Le)},Wt=pe=>{var Le=st(),bn=Be(Le);{var xn=ze=>{var at=ke("‚ú® Near-Fusion");D(ze,at)},kn=ze=>{var at=st(),Mn=Be(at);{var Sn=Re=>{var pt=ke("üé¨ Cinema (60 Hz)");D(Re,pt)},Pn=Re=>{var pt=ke("üåü Ultra Smooth");D(Re,pt)};se(Mn,Re=>{_()<62?Re(Sn):Re(Pn,!1)},!0)}D(ze,at)};se(bn,ze=>{_()<58?ze(xn):ze(kn,!1)},!0)}D(pe,Le)};se(Rt,pe=>{_()<52?pe(Ot):pe(Wt,!1)},!0)}D(le,qe)};se(yn,le=>{_()<48?le(Ta):le($a,!1)})}E(zt);var Qn=k(zt,2),Ea=$(Qn);{var Da=le=>{var qe=ke("Noticeable flicker - classic phenakistoscope effect");D(le,qe)},Aa=le=>{var qe=st(),Rt=Be(qe);{var Ot=pe=>{var Le=ke("Flicker begins to fuse - critical threshold");D(pe,Le)},Wt=pe=>{var Le=st(),bn=Be(Le);{var xn=ze=>{var at=ke("Subtle pulsing - artistic sweet spot");D(ze,at)},kn=ze=>{var at=st(),Mn=Be(at);{var Sn=Re=>{var pt=ke("Standard cinema/TV rate - minimal flicker");D(Re,pt)},Pn=Re=>{var pt=ke("Above fusion threshold - very smooth");D(Re,pt)};se(Mn,Re=>{_()<62?Re(Sn):Re(Pn,!1)},!0)}D(ze,at)};se(bn,ze=>{_()<58?ze(xn):ze(kn,!1)},!0)}D(pe,Le)};se(Rt,pe=>{_()<52?pe(Ot):pe(Wt,!1)},!0)}D(le,qe)};se(Ea,le=>{_()<48?le(Da):le(Aa,!1)})}E(Qn),E(Lt),E(S),Ce(()=>{it(V,`padding: 8px 14px; border: 1px solid ${_()===30?"#c92a2a":"#555"}; background: ${_()===30?"#c92a2a":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),it(Z,`padding: 8px 14px; border: 1px solid ${_()===42?"#ff6b6b":"#555"}; background: ${_()===42?"#ff6b6b":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),it(ue,`padding: 8px 14px; border: 1px solid ${_()===50?"#ffa500":"#555"}; background: ${_()===50?"#ffa500":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),it(je,`padding: 8px 14px; border: 1px solid ${_()===55?"#4a9eff":"#555"}; background: ${_()===55?"#4a9eff":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),it(Qe,`padding: 8px 14px; border: 1px solid ${_()===60?"#51cf66":"#555"}; background: ${_()===60?"#51cf66":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),it(Ge,`padding: 8px 14px; border: 1px solid ${_()===70?"#845ef7":"#555"}; background: ${_()===70?"#845ef7":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),it(He,`padding: 8px 14px; border: 1px solid ${_()===80?"#20c997":"#555"}; background: ${_()===80?"#20c997":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),it(Ae,`padding: 8px 14px; border: 1px solid ${_()===100?"#12b886":"#555"}; background: ${_()===100?"#12b886":"#333"}; color: white; border-radius: 6px; cursor: pointer; font-size: 0.9em; min-height: 40px;`),Oe(gn,`${_()??""} Hz`),ra(ct,_())}),z("click",V,()=>Xe.set(30)),z("click",Z,()=>Xe.set(42)),z("click",ue,()=>Xe.set(50)),z("click",je,()=>Xe.set(55)),z("click",Qe,()=>Xe.set(60)),z("click",Ge,()=>Xe.set(70)),z("click",He,()=>Xe.set(80)),z("click",Ae,()=>Xe.set(100)),z("input",ct,le=>Xe.set(+le.target.value)),D(f,S)};se(Ye,f=>{M()&&f(fn)})}var Qt=k(Ye,2);{var ya=f=>{var S=Xi(),G=$(S);{var W=He=>{var Ae=Yi();D(He,Ae)};se(G,He=>{(n(F)||v())&&He(W)})}var V=k(G,2),Z=$(V),ue=k(Z,2),je=$(ue),Qe=$(je);E(je),an(2),E(ue);var Ge=k(ue,2);E(V),E(S),Ce((He,Ae,Fe)=>{sn(S,1,`speed-control ${n(F)?"dragMode":""} ${n(Ne)?"dragging":""} ${v()?"mobile":""}`,"svelte-14nyow8"),it(S,`left: ${He??""}px; top: ${Ae??""}px;`),Oe(Qe,`${Fe??""}¬∞/s`)},[()=>(n(N),Je(()=>n(N).left??Math.round((window.innerWidth-200)/2))),()=>(n(N),Je(()=>n(N).top??Math.round((window.innerHeight-80)/2))),()=>(d(),Je(()=>d().toFixed(0)))]),z("pointerdown",Z,Me(()=>Q("decrease"))),z("pointerup",Z,Me(q)),z("pointerleave",Z,Me(q)),z("pointercancel",Z,Me(q)),z("pointerdown",Ge,Me(()=>Q("increase"))),z("pointerup",Ge,Me(q)),z("pointerleave",Ge,Me(q)),z("pointercancel",Ge,Me(q)),z("pointerdown",S,Jt),D(f,S)};se(Qt,f=>{o()&&f(ya)})}var Jn=k(Qt,2),un=$(Jn),dn=$(un),Kn=k($(dn)),ba=k(Kn);{var xa=f=>{var S=Bi();D(f,S)},ka=f=>{var S=Vi();D(f,S)};se(ba,f=>{v()?f(xa):f(ka,!1)})}E(dn);var Zn=k(dn,2),hn=k($(Zn),2);Nt(hn);var Ma=k(hn,2);E(Zn),E(un);var pn=k(un,2),Sa=k($(pn));E(pn);var vn=k(pn,2),Pa=k($(vn));E(vn);var Ca=k(vn,2);{var Ia=f=>{var S=Ji(),G=k($(S));E(S),Ce((W,V,Z)=>Oe(G,` x=${W??""}, y=${V??""}, r=${Z??""}`),[()=>(n(y),Je(()=>Math.round(n(y).x))),()=>(n(y),Je(()=>Math.round(n(y).y))),()=>(n(y),Je(()=>Math.round(n(y).r)))]),D(f,S)};se(Ca,f=>{n(y)&&f(Ia)})}E(Jn),E(Ee),Ce((f,S)=>{Zt=sn(lt,1,ia(n(y)&&!a()?"play-highlight":""),"svelte-14nyow8",Zt,{"pause-subtle":a()&&!n(y)}),lt.disabled=!r(),Oe(cn,a()?"Pause":"Play"),J.disabled=!n(j),_e.disabled=!n(m)||n($e),Oe(tt,n($e)?"‚è≥ Exporting...":"üíæ Save GIF"),rn(oe,"placeholder",n(e)?`Auto (${n(e)*2})`:"Auto (24)"),ra(oe,x()),bi(xt,n(T)),Oe(Kn,` ${f??""}¬∞/s | `),Oe(Sa,` ${x()??12??""}`),Oe(Pa,` ${S??""}¬∞/s`)},[()=>(d(),Je(()=>d().toFixed(0))),()=>(n(j),Je(()=>n(j)?n(j).toFixed(0):"‚Äî"))]),z("click",lt,H),z("click",g,Se),z("click",J,Ke),z("click",_e,Ct),z("input",oe,f=>Yt.set(f.target.value?Number(f.target.value):null)),_a(ie,()=>n(we),f=>I(we,f)),z("change",xt,f=>On.set(f.target.checked)),Mi(ye,M,f=>fi(jn,f)),ki(hn,()=>n(et),f=>I(et,f)),z("click",Ma,gt),D(t,Ee),Bt(),u()}var Qi=ve('<span class="current-image svelte-ai08gq" title="Currently loaded image"> </span>'),es=ve("<option> </option>"),ts=ve('<div class="selector svelte-ai08gq"><label for="samples" class="svelte-ai08gq">Sample Images:</label> <!> <select id="samples" class="svelte-ai08gq"><option>-- Choose a sample --</option><!></select></div>');function ns(t,s){Xt(s,!1);const a=()=>Y(la,"$selectedImageName",o),[o,d]=ln(),r="https://raw.githubusercontent.com/tclaret/phenakistoscope-simulator/main/images",c="https://raw.githubusercontent.com/tclaret/phenaki-lab/main/img",h=[{name:"Colors",file:"colors.png",repo:"new"},{name:"Medium 1990",file:"medium_1990_5036_7181_6_1.png",repo:"new"},{name:"Cats et Donkey",file:"optical-toy-phenakistiscope-disc-avec-cats-et-donkey-ca-1830-2efx315.jpg",repo:"new"},{name:"Dancing Man Animated",file:"Optical_Toy,_Phenakistiscope_Disc_with_Dancing_Man,_ca._1835-Animated.jpg",repo:"new"},{name:"Ph√©nakistiscope 2",file:"ph√©nakistiscope2.png",repo:"new"},{name:"Disque Animation 29",file:"phenakistiscope-disque-animation-29.jpg",repo:"new"},{name:"S-L1600 1",file:"s-l1600_1.jpg",repo:"new"},{name:"S-L1600",file:"s-l1600.jpg",repo:"new"},{name:"Woman Chopping Tree",file:"WomanChoppingTree.jpg",repo:"old"},{name:"Dancing",file:"Dancing.jpg",repo:"old"},{name:"Jongleur",file:"Jongleur.png",repo:"old"},{name:"a_cheval",file:"a_cheval.png",repo:"old"},{name:"McLean_1",file:"McLean_1.png",repo:"old"},{name:"Gernamy_1949",file:"Gernamy_1949_R_Balzer.png",repo:"old"},{name:"AEO175939",file:"AEO175939_PhenakistoscopeGiroux60.jpg",repo:"old"},{name:"AEO185553",file:"AEO185553_PhenakistiscopeDisc_ManInBlueAndRed.jpg",repo:"old"},{name:"medium_1990_5036_3369",file:"medium_1990_5036_3369.jpg",repo:"old"},{name:"medium_a001813b",file:"medium_a001813b.jpg",repo:"old"},{name:"tumblr_obd6fh",file:"tumblr_obd6fhGFSZ1r9jbwno1_500.png",repo:"old"},{name:"tumblr_oc1cz",file:"tumblr_oc1czn99ZM1r9jbwno1_500.png",repo:"old"},{name:"Phantasmascope Faces",file:"Phantasmascope_faces.png",repo:"old"},{name:"722a6790240569.5e126845d9b56",file:"722a6790240569.5e126845d9b56.png",repo:"old"},{name:"Fantascope Disc 1833",file:"fantascope-disc-1833.png",repo:"old"},{name:"Face",file:"a_face__.jpg",repo:"new"},{name:"Culbute",file:"culbute.jpg",repo:"new"},{name:"Grenouille",file:"Grenouille__.jpg",repo:"new"},{name:"Oh Soccer",file:"oh_soccer.jpg",repo:"new"},{name:"Un Grand Un Petit",file:"un_grand_un_petit.jpg",repo:"new"},{name:"Autre Culbutte",file:"autre_culbutte.jpg",repo:"new"},{name:"Dancing 2",file:"dancing_.jpg",repo:"new"},{name:"Il Pompe de l'eau",file:"il_pompe_de_leau.jpg",repo:"new"},{name:"Porceline",file:"porceline.jpg",repo:"new"},{name:"Volants",file:"volants_.png",repo:"new"},{name:"Ce Qui",file:"ce_qui.jpg",repo:"new"},{name:"Des Anges",file:"des_anges.jpg",repo:"new"},{name:"Moulin",file:"moulin_.jpg",repo:"new"},{name:"Rats",file:"rats__.jpg",repo:"new"},{name:"Corde √† Danser",file:"corde_a_denser_.jpg",repo:"new"},{name:"Ecureuil",file:"ecureuil.jpg",repo:"new"},{name:"Noel Noel",file:"noel_noel.jpg",repo:"new"},{name:"Tirreur",file:"tirreur_.jpg",repo:"new"},{name:"C Pastel",file:"c_pastel.jpg",repo:"new"},{name:"G√©om√©trique",file:"geometrique.jpg",repo:"new"},{name:"Nuages en Scie",file:"nuages_en_scie.jpg",repo:"new"},{name:"Tons Pastels",file:"tons_pastels.jpg",repo:"new"},{name:"Des Ouiseaux",file:"DesOuaisaux.png",repo:"new"},{name:"Feels Like Flying",file:"feels_like_flying.png",repo:"new"},{name:"Gros Meusieur",file:"GrosMeusieur.png",repo:"new"},{name:"Jongle avec les Otaries",file:"Jongle_avec_les_otaries.png",repo:"new"},{name:"Cin√©math√®que 1",file:"cinemateque_francaise_1.png",repo:"new"},{name:"Cin√©math√®que 2",file:"cinemateque_francaise_2.png",repo:"new"},{name:"Cin√©math√®que 3",file:"cinemateque_francaise_3.png",repo:"new"},{name:"Cin√©math√®que 4",file:"cinemateque_francaise_4.png",repo:"new"},{name:"Cin√©math√®que 5",file:"cinemateque_francaise_5.png",repo:"new"},{name:"Cin√©math√®que 6",file:"cinemateque_francaise_6.png",repo:"new"},{name:"Cin√©math√®que 7",file:"cinemateque_francaise_7.png",repo:"new"},{name:"Cin√©math√®que 8",file:"cinemateque_francaise_8.png",repo:"new"},{name:"Cin√©math√®que 9",file:"cinemateque_francaise_9.png",repo:"new"},{name:"Cin√©math√®que 10",file:"cinemateque_francaise_10.png",repo:"new"},{name:"Cin√©math√®que 11",file:"cinemateque_francaise_11.png",repo:"new"},{name:"Cin√©math√®que 12",file:"cinemateque_francaise_12.png",repo:"new"},{name:"Cin√©math√®que 13",file:"cinemateque_francaise_13.png",repo:"new"},{name:"Cin√©math√®que 14",file:"cinemateque_francaise_14.png",repo:"new"},{name:"Cin√©math√®que 15",file:"cinemateque_francaise_15.png",repo:"new"},{name:"Cin√©math√®que 16",file:"cinemateque_francaise_16.png",repo:"new"},{name:"Cin√©math√®que 17",file:"cinemateque_francaise_17.png",repo:"new"},{name:"Cin√©math√®que 18",file:"cinemateque_francaise_18.png",repo:"new"},{name:"Cin√©math√®que 19",file:"cinemateque_francaise_19.png",repo:"new"},{name:"Cin√©math√®que 20",file:"cinemateque_francaise_20.png",repo:"new"},{name:"Cin√©math√®que 21",file:"cinemateque_francaise_21.png",repo:"new"},{name:"Cin√©math√®que 22",file:"cinemateque_francaise_22.png",repo:"new"},{name:"Cin√©math√®que 23",file:"cinemateque_francaise_23.png",repo:"new"},{name:"Cin√©math√®que 24",file:"cinemateque_francaise_24.png",repo:"new"},{name:"Cin√©math√®que 25",file:"cinemateque_francaise_25.png",repo:"new"}];let x=te("");function v(i){const m=`${i.repo==="new"?c:r}/${i.file}`;Pt.set(m),Vn.set(m),vt.set(!0),la.set(i.name),I(x,i.file)}Xn(()=>{let i=!1;if(Pt.subscribe(m=>{m&&(i=!0)})(),!i){const m=h[Math.floor(Math.random()*h.length)];m&&v(m)}}),on();var l=ts(),b=k($(l),2);{var w=i=>{var u=Qi(),m=$(u);E(u),Ce(()=>Oe(m,`üì∑ ${a()??""}`)),D(i,u)};se(b,i=>{a()&&i(w)})}var P=k(b,2);Ce(()=>{n(x),va(()=>{})});var M=$(P);M.value=M.__value="";var _=k(M);di(_,1,()=>h,i=>i.file,(i,u)=>{var m=es(),p=$(m,!0);E(m);var y={};Ce(()=>{Oe(p,n(u).name),y!==(y=n(u).file)&&(m.value=(m.__value=n(u).file)??"")}),D(i,m)}),E(P),E(l),_a(P,()=>n(x),i=>I(x,i)),z("change",P,i=>{const u=i.target.selectedIndex-1;u>=0&&v(h[u])}),D(t,l),Bt(),d()}var as=ve('<div class="container svelte-1uha8ag"><h1 class="svelte-1uha8ag">Phenakistoscope Lab</h1> <p class="sub svelte-1uha8ag">Convert old phenakistoscope discs into animated GIFs</p> <div class="intro svelte-1uha8ag"><p class="svelte-1uha8ag">To create an animated GIF from a phenakistoscope image, select the correct number of frames according to the image, adjust the rotation speed, and then save it as a fast, slow, or normal animated GIF depending on your settings.</p></div> <!> <!> <!> <!> <!></div>');function us(t){var s=as(),a=k($(s),6);Pi(a,{});var o=k(a,2);ns(o,{});var d=k(o,2);Ii(d,{});var r=k(d,2);Di(r,{});var c=k(r,2);Zi(c,{}),E(s),D(t,s)}export{us as component};
