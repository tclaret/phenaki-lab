import{f as fe,a as T,c as Ge,t as pe}from"../chunks/C2OulXxV.js";import"../chunks/u-GhMVP5.js";import{G as fr,v as ke,w as dr,g as t,av as ur,I as vr,J as hr,K as Dn,L as An,M as rn,D as zt,a3 as pr,aq as gr,aa as mr,x as qe,C as vn,B as Un,F as _r,Q as ee,a1 as Ln,ao as jn,aI as Gn,aJ as yr,y as qn,A as wr,aK as br,aL as xr,aM as sn,ak as Mr,aN as kr,aO as Sr,an as Pr,z as Er,aP as bn,N as Tr,R as Ir,aQ as Cr,aR as $r,aS as Hn,aT as Dr,aU as Ar,aV as Lr,P as Fr,aW as zr,aX as Rr,aG as Or,b as De,O as Yn,p as Pt,j as Et,s as S,k as I,l as C,aY as Ae,aZ as xn,i as Re,U as E,t as Ee,a_ as ae,a$ as Wr,ab as an}from"../chunks/BmgSzj6w.js";import{e as ce,s as Ce}from"../chunks/hAALANAn.js";import{i as Nt}from"../chunks/BgyTcsX8.js";import{w as ve,o as Mn,a as Nr,g as on}from"../chunks/B3QUX6bn.js";import{i as se,s as kn,a as Z,b as Fn,d as Ur}from"../chunks/Bv2EIizG.js";function jr(e,a,r){for(var v=[],m=a.length,o=0;o<m;o++)kr(a[o].e,v,!0);Sr(v,()=>{var l=v.length===0&&r!==null;if(l){var d=r,M=d.parentNode;Pr(M),M.append(d),e.items.clear(),$e(e,a[0].prev,a[m-1].next)}for(var p=0;p<m;p++){var i=a[p];l||(e.items.delete(i.k),$e(e,i.prev,i.next)),Er(i.e,!l)}e.first===a[0]&&(e.first=a[0].prev)})}function Gr(e,a,r,v,m,o=null){var l=e,d=new Map,M=null;ke&&dr();var p=null,i=ur(()=>{var u=r();return Gn(u)?u:u==null?[]:jn(u)}),g,h=!0;function y(){qr(w,g,l,a,v),p!==null&&(g.length===0?(p.fragment?(l.before(p.fragment),p.fragment=null):qn(p.effect),b.first=p.effect):wr(p.effect,()=>{p=null}))}var b=fr(()=>{g=t(i);var u=g.length;let s=!1;if(ke){var c=vr(l)===hr;c!==(u===0)&&(l=Dn(),An(l),rn(!1),s=!0)}for(var n=new Set,D=qe,k=null,B=_r(),G=0;G<u;G+=1){ke&&zt.nodeType===pr&&zt.data===gr&&(l=zt,s=!0,rn(!1));var W=g[G],H=v(W,G),z=h?null:d.get(H);z?(mr(z.v,W),z.i=G,B&&D.skipped_effects.delete(z.e)):(z=Hr(h?l:null,k,W,H,G,m,a,r),h&&(z.o=!0,k===null?M=z:k.next=z,k=z),d.set(H,z)),n.add(H)}if(u===0&&o&&!p)if(h)p={fragment:null,effect:vn(()=>o(l))};else{var ge=document.createDocumentFragment(),me=Un();ge.append(me),p={fragment:ge,effect:vn(()=>o(me))}}if(ke&&u>0&&An(Dn()),!h)if(B){for(const[A,$]of d)n.has(A)||D.skipped_effects.add($.e);D.oncommit(y),D.ondiscard(()=>{})}else y();s&&rn(!0),t(i)}),w={effect:b,items:d,first:M};h=!1,ke&&(l=zt)}function qr(e,a,r,v,m){var o=a.length,l=e.items,d=e.first,M,p=null,i=[],g=[],h,y,b,w;for(w=0;w<o;w+=1){if(h=a[w],y=m(h,w),b=l.get(y),e.first??=b,!b.o){b.o=!0;var u=p?p.next:d;$e(e,p,b),$e(e,b,u),ln(b,u,r),p=b,i=[],g=[],d=p.next;continue}if((b.e.f&sn)!==0&&qn(b.e),b!==d){if(M!==void 0&&M.has(b)){if(i.length<g.length){var s=g[0],c;p=s.prev;var n=i[0],D=i[i.length-1];for(c=0;c<i.length;c+=1)ln(i[c],s,r);for(c=0;c<g.length;c+=1)M.delete(g[c]);$e(e,n.prev,D.next),$e(e,p,n),$e(e,D,s),d=s,p=D,w-=1,i=[],g=[]}else M.delete(b),ln(b,d,r),$e(e,b.prev,b.next),$e(e,b,p===null?e.first:p.next),$e(e,p,b),p=b;continue}for(i=[],g=[];d!==null&&d.k!==y;)(d.e.f&sn)===0&&(M??=new Set).add(d),g.push(d),d=d.next;if(d===null)continue;b=d}i.push(b),p=b,d=b.next}let k=l.size>o;if(d!==null||M!==void 0){for(var B=M===void 0?[]:jn(M);d!==null;)(d.e.f&sn)===0&&B.push(d),d=d.next;var G=B.length;if(k=l.size-G>o,G>0){var W=null;jr(e,B,W)}}if(k)for(const H of l.values())H.o||($e(e,p,H),p=H);e.effect.last=p&&p.e}function Hr(e,a,r,v,m,o,l,d){var M=(l&br)!==0,p=(l&xr)===0,i=M?p?ee(r,!1,!1):Ln(r):r,g=(l&yr)===0?m:Ln(m),h={i:g,v:i,k:v,a:null,e:null,o:!1,prev:a,next:null};try{if(e===null){var y=document.createDocumentFragment();y.append(e=Un())}return h.e=vn(()=>o(e,i,g,d)),a!==null&&(a.next=h),h}finally{}}function ln(e,a,r){for(var v=e.next?e.next.e.nodes_start:r,m=a?a.e.nodes_start:r,o=e.e.nodes_start;o!==null&&o!==v;){var l=Mr(o);m.before(o),o=l}}function $e(e,a,r){a===null?(e.first=r,e.effect.first=r&&r.e):(a.e.next&&(a.e.next.prev=null),a.next=r,a.e.next=r&&r.e),r!==null&&(r.e.prev&&(r.e.prev.next=null),r.prev=a,r.e.prev=a&&a.e)}function Xn(e){var a,r,v="";if(typeof e=="string"||typeof e=="number")v+=e;else if(typeof e=="object")if(Array.isArray(e)){var m=e.length;for(a=0;a<m;a++)e[a]&&(r=Xn(e[a]))&&(v&&(v+=" "),v+=r)}else for(r in e)e[r]&&(v&&(v+=" "),v+=r);return v}function Yr(){for(var e,a,r=0,v="",m=arguments.length;r<m;r++)(e=arguments[r])&&(a=Xn(e))&&(v&&(v+=" "),v+=a);return v}function zn(e){return typeof e=="object"?Yr(e):e??""}function Xr(e,a,r){var v=e==null?"":""+e;return a&&(v=v?v+" "+a:a),v===""?null:v}function Vr(e,a){return e==null?null:String(e)}function Ot(e,a,r,v,m,o){var l=e.__className;if(ke||l!==r||l===void 0){var d=Xr(r,v);(!ke||d!==e.getAttribute("class"))&&(d==null?e.removeAttribute("class"):e.className=d),e.__className=r}return o}function lt(e,a,r,v){var m=e.__style;if(ke||m!==a){var o=Vr(a);(!ke||o!==e.getAttribute("style"))&&(o==null?e.removeAttribute("style"):e.style.cssText=o),e.__style=a}return v}function Vn(e,a,r=!1){if(e.multiple){if(a==null)return;if(!Gn(a))return Cr();for(var v of e.options)v.selected=a.includes(kt(v));return}for(v of e.options){var m=kt(v);if($r(m,a)){v.selected=!0;return}}(!r||a!==void 0)&&(e.selectedIndex=-1)}function Br(e){var a=new MutationObserver(()=>{Vn(e,e.__value)});a.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),Ir(()=>{a.disconnect()})}function Jr(e,a,r=a){var v=new WeakSet,m=!0;bn(e,"change",o=>{var l=o?"[selected]":":checked",d;if(e.multiple)d=[].map.call(e.querySelectorAll(l),kt);else{var M=e.querySelector(l)??e.querySelector("option:not([disabled])");d=M&&kt(M)}r(d),qe!==null&&v.add(qe)}),Tr(()=>{var o=a();if(e===document.activeElement){var l=Hn??qe;if(v.has(l))return}if(Vn(e,o,m),m&&o===void 0){var d=e.querySelector(":checked");d!==null&&(o=kt(d),r(o))}e.__value=o,m=!1}),Br(e)}function kt(e){return"__value"in e?e.__value:e.value}const Zr=Symbol("is custom element"),Kr=Symbol("is html");function xt(e){if(ke){var a=!1,r=()=>{if(!a){if(a=!0,e.hasAttribute("value")){var v=e.value;Wt(e,"value",null),e.value=v}if(e.hasAttribute("checked")){var m=e.checked;Wt(e,"checked",null),e.checked=m}}};e.__on_r=r,Fr(r),zr()}}function Qr(e,a){var r=Sn(e);r.value===(r.value=a??void 0)||e.value===a&&(a!==0||e.nodeName!=="PROGRESS")||(e.value=a??"")}function es(e,a){var r=Sn(e);r.checked!==(r.checked=a??void 0)&&(e.checked=a)}function Wt(e,a,r,v){var m=Sn(e);ke&&(m[a]=e.getAttribute(a),a==="src"||a==="srcset"||a==="href"&&e.nodeName==="LINK")||m[a]!==(m[a]=r)&&(a==="loading"&&(e[Rr]=r),r==null?e.removeAttribute(a):typeof r!="string"&&ts(e).includes(a)?e[a]=r:e.setAttribute(a,r))}function Sn(e){return e.__attributes??={[Zr]:e.nodeName.includes("-"),[Kr]:e.namespaceURI===Dr}}var Rn=new Map;function ts(e){var a=e.getAttribute("is")||e.nodeName,r=Rn.get(a);if(r)return r;Rn.set(a,r=[]);for(var v,m=e,o=Element.prototype;o!==m;){v=Lr(m);for(var l in v)v[l].set&&r.push(l);m=Ar(m)}return r}function On(e,a,r=a){var v=new WeakSet;bn(e,"input",async m=>{var o=m?e.defaultValue:e.value;if(o=cn(e)?fn(o):o,r(o),qe!==null&&v.add(qe),await Or(),o!==(o=a())){var l=e.selectionStart,d=e.selectionEnd,M=e.value.length;if(e.value=o??"",d!==null){var p=e.value.length;l===d&&d===M&&p>M?(e.selectionStart=p,e.selectionEnd=p):(e.selectionStart=l,e.selectionEnd=Math.min(d,p))}}}),(ke&&e.defaultValue!==e.value||De(a)==null&&e.value)&&(r(cn(e)?fn(e.value):e.value),qe!==null&&v.add(qe)),Yn(()=>{var m=a();if(e===document.activeElement){var o=Hn??qe;if(v.has(o))return}cn(e)&&m===fn(e.value)||e.type==="date"&&!m&&!e.value||m!==e.value&&(e.value=m??"")})}function ns(e,a,r=a){bn(e,"change",v=>{var m=v?e.defaultChecked:e.checked;r(m)}),(ke&&e.defaultChecked!==e.checked||De(a)==null)&&r(e.checked),Yn(()=>{var v=a();e.checked=!!v})}function cn(e){var a=e.type;return a==="number"||a==="range"}function fn(e){return e===""?null:+e}const Pn=ve(null),ft=ve(null),dt=ve(!1),Qe=ve(360),hn=ve(1),pn=ve(null),Wn=ve(0),dn=ve(1),Bn=ve([]),gn=ve(!1),ct=ve(!1),St=ve(!1),mn=ve({translateX:0,translateY:0,scale:1}),Mt=ve({active:!1,progress:0,startTime:0}),_n=ve(null),yn=ve(!1),Ke=ve(50),wn=ve(!1);var rs=fe('<label>Choose image: <input type="file" accept="image/*"/></label>');function ss(e,a){Pt(a,!1);function r(o){const l=o.target.files[0];if(!l)return;const d=URL.createObjectURL(l);Pn.set(d),ft.set(d),dt.set(!0)}Nt();var v=rs(),m=S(I(v));C(v),ce("change",m,r),T(e,v),Et()}var as=fe('<div class="preview svelte-1th6cal"><img alt="Selected disc preview" class="svelte-1th6cal"/></div>');function is(e,a){Pt(a,!1);const r=()=>Z(Pn,"$previewUrl",v),[v,m]=kn(),o=ee();Ae(()=>r(),()=>{E(o,r())}),xn();var l=Ge(),d=Re(l);{var M=p=>{var i=as(),g=I(i);C(i),Ee(()=>Wt(g,"src",t(o))),T(p,i)};se(d,p=>{t(o)&&p(M)})}T(e,l),Et(),m()}var os=fe('<div class="speed-hud svelte-byh4af"> </div>'),ls=fe('<div class="edit-mode-indicator svelte-byh4af">‚öôÔ∏è EDIT MODE - Drag to position ‚Ä¢ Scroll to zoom</div>'),cs=fe('<div><canvas class="svelte-byh4af"></canvas> <!> <!></div>');function fs(e,a){Pt(a,!1);const r=()=>Z(ct,"$editMode",w),v=()=>Z(dt,"$isPlaying",w),m=()=>Z(ft,"$imageUrl",w),o=()=>Z(wn,"$isMobile",w),l=()=>Z(Qe,"$rotationSpeed",w),d=()=>Z(Mt,"$detectionAnimation",w),M=()=>Z(hn,"$rotationDirection",w),p=()=>Z(pn,"$detectedCircle",w),i=()=>Z(gn,"$overlayVisible",w),g=()=>Z(Bn,"$detectedPositions",w),h=()=>Z(yn,"$flickerEnabled",w),y=()=>Z(Ke,"$flickerFrequency",w),b=()=>Z(St,"$confirmedDetection",w),[w,u]=kn();let s=ee(),c=ee(),n,D=0,k=ee(1);const B=1,G=4;let W=ee(0),H=ee(0);const z=new Map;let ge=1,me=0,A=0,$=ee(),Q=ee(0),de=0,_e=1,ue=ee(!1),te,Te=0,L=0,Oe=0,F=ee(null),Le=ee(!1),Fe;function Tt(_){E(Le,!1),E(F,new Image),ae(F,t(F).crossOrigin="anonymous"),ae(F,t(F).onload=()=>{E(Le,!0),ut(),ze()}),ae(F,t(F).onerror=P=>{console.error("Erreur chargement:",_,P),E(Le,!1)}),ae(F,t(F).src=_)}function ut(){if(!t(c)||!t(s))return;const _=t(s).getBoundingClientRect(),P=window.devicePixelRatio||1;if(t(F)&&t(F).width&&t(F).height){const Y=t(F).width,X=t(F).height,ne=Math.min(1400,Math.max(150,Math.round(_.width*Math.sqrt(Y*Y+X*X)/Y)));ae(s,t(s).style.height=ne+"px");const K=t(s).getBoundingClientRect();ae(c,t(c).style.width=K.width+"px"),ae(c,t(c).style.height=K.height+"px"),ae(c,t(c).width=Math.round(K.width*P)),ae(c,t(c).height=Math.round(K.height*P))}else ae(c,t(c).style.width=_.width+"px"),ae(c,t(c).style.height=_.height+"px"),ae(c,t(c).width=Math.round(_.width*P)),ae(c,t(c).height=Math.round(_.height*P));n&&n.setTransform(P,0,0,P,0,0),ze()}Mn(()=>{const _=()=>{const P=window.innerWidth<768||"ontouchstart"in window&&window.innerWidth<1024;wn.set(P)};if(_(),window.addEventListener("resize",_),t(c)){if(_n.set(t(c)),n=t(c).getContext("2d"),t(s)){const P=()=>{o()?ae(s,t(s).style.touchAction=t(k)>1||r()?"none":"pan-y"):ae(s,t(s).style.touchAction="none")};P(),mn.subscribe(P),ct.subscribe(P)}t(s)&&t(s).addEventListener("wheel",gt,{passive:!1}),ut(),Fe=new ResizeObserver(()=>ut()),t(s)&&Fe.observe(t(s)),t(s)&&(t(s).addEventListener("pointerdown",vt),t(s).addEventListener("pointermove",rt),t(s).addEventListener("pointerup",ht),t(s).addEventListener("pointerleave",pt))}return()=>{Fe&&Fe.disconnect(),window.removeEventListener("resize",_)}});function vt(_){if(!t(s))return;(r()||t(k)>1)&&_.preventDefault(),t(s).setPointerCapture(_.pointerId),z.set(_.pointerId,{x:_.clientX,y:_.clientY});const P=Date.now(),Y=_.clientX-L,X=_.clientY-Oe,ne=Math.sqrt(Y*Y+X*X);if(P-Te<300&&ne<50&&!r()){dt.update(K=>!K),z.clear(),Te=0;return}if(Te=P,L=_.clientX,Oe=_.clientY,z.size===1&&(me=_.clientX,A=_.clientY,de=_.clientY,_e=l()||1),z.size===2){const K=Array.from(z.values());ge=t(k),rt.pinchStartDist=Math.hypot(K[0].x-K[1].x,K[0].y-K[1].y)}}function rt(_){if(t(s)){if((r()||t(k)>1)&&z.has(_.pointerId)&&_.preventDefault(),z.has(_.pointerId)&&z.set(_.pointerId,{x:_.clientX,y:_.clientY}),z.size===2){const P=Array.from(z.values()),Y=P[0],X=P[1],ne=Math.hypot(Y.x-X.x,Y.y-X.y),K=rt.pinchStartDist||ne,Ie=ne/K;let Ye=Math.max(B,Math.min(G,ge*Ie));const Xe={x:(Y.x+X.x)/2,y:(Y.y+X.y)/2},tt=t(c).clientWidth,R=t(c).clientHeight,q=t(s).getBoundingClientRect(),j=Xe.x-(q.left+tt/2)-t(W),U=Xe.y-(q.top+R/2)-t(H),V=t(k),he=Ye;E(W,t(W)-(he/V-1)*j),E(H,t(H)-(he/V-1)*U),E(k,Ye),E(ue,!0),clearTimeout(te);return}if(z.size===1){if(z.values().next().value,t(k)>1||r()){const P=_.clientX-me,Y=_.clientY-A;E(W,t(W)+P),E(H,t(H)+Y),me=_.clientX,A=_.clientY,ze();return}else if(!o()){const P=de-_.clientY,X=Math.round(P*8),ne=Math.max(10,Math.min(1e4,Math.round(_e+X)));Qe.set(ne),E(ue,!0),clearTimeout(te)}}}}function ht(_){if(t(s)){try{t(s).releasePointerCapture(_.pointerId)}catch{}clearTimeout(te),E(ue,!0),te=setTimeout(()=>{E(ue,!1)},4e3),z.delete(_.pointerId),z.size===0&&(clearTimeout(te),E(ue,!1))}}function pt(){clearTimeout(te),E(ue,!0),te=setTimeout(()=>{E(ue,!1)},4e3)}function gt(_){if(!t(s)||!_.ctrlKey&&!_.metaKey)return;_.preventDefault();const Y=1+(-_.deltaY>0?.1:-.1),X=Math.max(B,Math.min(G,t(k)*Y)),ne=t(s).getBoundingClientRect(),K=_.clientX-(ne.left+t(c).clientWidth/2)-t(W),Ie=_.clientY-(ne.top+t(c).clientHeight/2)-t(H);E(W,t(W)-(X/t(k)-1)*K),E(H,t(H)-(X/t(k)-1)*Ie),E(k,X),ze()}Nr(()=>{t($)&&cancelAnimationFrame(t($)),Fe&&Fe.disconnect(),te&&clearTimeout(te),t(s)&&(t(s).removeEventListener("pointerdown",vt),t(s).removeEventListener("pointermove",rt),t(s).removeEventListener("pointerup",ht),t(s).removeEventListener("pointerleave",pt),t(s)&&t(s).removeEventListener("wheel",gt)),_n.set(null)});function st(_){const P=v()||d().active||r();if(!P||!t(Le)){E(Q,0),!P&&t($)&&(cancelAnimationFrame(t($)),E($,null));return}t(Q)||E(Q,_);const Y=_-t(Q);if(E(Q,_),v()&&!r()){const X=l()||0;D+=X*(M()||1)*(Y/1e3)}ze(),E($,requestAnimationFrame(st))}function ze(){if(!t(Le)||!n||!t(F)||!t(c))return;const _=t(c).clientWidth,P=t(c).clientHeight;n.clearRect(0,0,_,P),n.save();const Y=t(F).width/t(F).height,X=_/P;let ne,K;Y>X?(ne=_,K=_/Y):(K=P,ne=P*Y);const Ie=ne*t(k),Ye=K*t(k);let Xe=0,tt=0;if(p()){const R=ne/t(F).width;Xe=(p().x-t(F).width/2)*R*t(k),tt=(p().y-t(F).height/2)*R*t(k)}if(n.translate(_/2+t(W),P/2+t(H)),n.translate(Xe,tt),n.rotate(D*Math.PI/180),n.translate(-Xe,-tt),n.drawImage(t(F),-Ie/2,-Ye/2,Ie,Ye),i()&&p())try{const R=p(),q=ne*t(k)/t(F).width,j=(R.x-t(F).width/2)*q,U=(R.y-t(F).height/2)*q,V=R.r*q;n.beginPath(),n.lineWidth=Math.max(2,2),n.strokeStyle="rgba(255,160,0,0.85)",n.arc(j,U,V,0,Math.PI*2),n.stroke(),n.strokeStyle="rgba(255,160,0,0.85)",n.lineWidth=Math.max(2,2);const he=Math.max(15,V*.15);if(n.beginPath(),n.moveTo(j-he,U),n.lineTo(j+he,U),n.stroke(),n.beginPath(),n.moveTo(j,U-he),n.lineTo(j,U+he),n.stroke(),g()&&g().length){n.fillStyle="rgba(0,200,255,0.9)";for(const Ve of g()){const We=Ve.angle,it=j+Math.cos(We)*V,Ne=U+Math.sin(We)*V;n.beginPath(),n.arc(it,Ne,Math.max(2,Math.round(V*.03)),0,Math.PI*2),n.fill()}}}catch(R){console.warn("overlay draw failed",R)}if(r())try{let R;if(r()){const q=d().startTime||0;R=(q>0?Date.now()-q:Date.now())%2e3/2e3}else R=Math.min(1,(Date.now()-d().startTime)/2e3);if(n.fillStyle=r()?"rgba(0, 0, 0, 0.5)":"rgba(0, 0, 0, 0.3)",n.fillRect(-ne/2-100,-K/2-100,ne+200,K+200),p()){const q=p(),j=ne*t(k)/t(F).width,U=(q.x-t(F).width/2)*j,V=(q.y-t(F).height/2)*j,he=q.r*j;n.strokeStyle=`rgba(100, 200, 255, ${.8*(1-R)})`,n.lineWidth=2;for(let Ne=0;Ne<3;Ne++){const jt=he*(.3+R*1.2+Ne*.3);n.beginPath(),n.arc(U,V,jt,0,Math.PI*2),n.stroke()}n.strokeStyle="rgba(100, 200, 255, 0.9)",n.lineWidth=3;const Ve=R*Math.PI*6,We=he*1.8;n.beginPath(),n.moveTo(U,V),n.lineTo(U+Math.cos(Ve)*We,V+Math.sin(Ve)*We),n.stroke();const it=4+Math.sin(R*Math.PI*4)*2;n.fillStyle=`rgba(100, 200, 255, ${.9*Math.sin(R*Math.PI)})`,n.beginPath(),n.arc(U,V,it,0,Math.PI*2),n.fill(),n.fillStyle=`rgba(100, 200, 255, ${Math.sin(R*Math.PI)})`,n.font="bold 14px sans-serif",n.textAlign="center",n.fillText("SCANNING...",U,V-he-20)}else{const q=Math.max(ne,K)/2;n.strokeStyle=`rgba(100, 200, 255, ${.6})`,n.lineWidth=2;for(let U=0;U<4;U++){const V=q*(R+U*.25)%1,he=1-V;n.strokeStyle=`rgba(100, 200, 255, ${he*.6})`,n.beginPath(),n.arc(0,0,V*q,0,Math.PI*2),n.stroke()}n.strokeStyle="rgba(100, 200, 255, 0.8)",n.lineWidth=3;const j=R*Math.PI*4;n.beginPath(),n.moveTo(0,0),n.lineTo(Math.cos(j)*q,Math.sin(j)*q),n.stroke(),n.fillStyle=`rgba(100, 200, 255, ${.8+.2*Math.sin(R*Math.PI*4)})`,n.font="bold 18px sans-serif",n.textAlign="center",r()?(n.fillText("‚öôÔ∏è EDIT MODE - ADJUST POSITION & ZOOM",0,-60),n.font="bold 16px sans-serif",n.fillStyle="rgba(255, 200, 100, 0.95)",n.fillText("üéØ Align crosshair with rotation center",0,-20),n.font="14px sans-serif",n.fillStyle="rgba(200, 255, 200, 0.9)",n.fillText("üëÜ Drag to move  ‚Ä¢  üîç Scroll/Pinch to zoom",0,20),n.font="bold 14px sans-serif",n.fillStyle="rgba(100, 255, 100, 0.9)",n.fillText('Click "Confirm Detection" when ready',0,60)):(n.fillText("ANALYZING IMAGE...",0,-20),n.font="12px sans-serif",n.fillText(`${Math.round(R*100)}%`,0,10))}}catch(R){console.warn("radar animation failed",R)}if(h()&&v()){const R=1e3/y(),q=t(Q)%R/R,j=Math.max(0,Math.min(1,(y()-40)/30));let U;if(j<.33?U=q>.5?.85:0:j<.67?U=Math.sin(q*Math.PI*2)*.5+.5>.6?.6:0:U=(Math.sin(q*Math.PI*2)*.5+.5)*.3,U>.05){const V=n.createRadialGradient(_/2,P/2,0,_/2,P/2,Math.max(_,P)*.8);V.addColorStop(0,`rgba(0, 0, 0, ${U*.7})`),V.addColorStop(.5,`rgba(0, 0, 0, ${U})`),V.addColorStop(1,`rgba(0, 0, 0, ${U*.9})`),n.fillStyle=V,n.fillRect(-_,-P,_*3,P*3),j<.5&&(n.fillStyle=`rgba(20, 20, 40, ${U*.15})`,n.fillRect(-_,-P,_*3,P*3))}}if(n.restore(),r()||b()){const R=Date.now()%1e3/1e3,q=.7+.3*Math.sin(R*Math.PI*2);n.save(),n.translate(_/2,P/2),n.strokeStyle=`rgba(255, 100, 0, ${q})`,n.lineWidth=4;const j=Math.min(_,P)*.1;n.beginPath(),n.arc(0,0,j*.7,0,Math.PI*2),n.stroke(),n.lineWidth=3,n.beginPath(),n.moveTo(-j,0),n.lineTo(j,0),n.stroke(),n.beginPath(),n.moveTo(0,-j),n.lineTo(0,j),n.stroke(),n.beginPath(),n.arc(0,0,10+3*Math.sin(R*Math.PI*2),0,Math.PI*2),n.fillStyle=`rgba(255, 100, 0, ${q})`,n.fill(),n.strokeStyle="rgba(255, 255, 255, 0.9)",n.lineWidth=2,n.stroke(),n.beginPath(),n.arc(0,0,3,0,Math.PI*2),n.fillStyle="rgba(255, 255, 255, 0.95)",n.fill(),n.restore()}}Ae(()=>r(),()=>{r()&&(E(W,0),E(H,0),E(k,1),ze())}),Ae(()=>(t(W),t(H),t(k)),()=>{mn.set({translateX:t(W),translateY:t(H),scale:t(k)})}),Ae(()=>(v(),St),()=>{v()&&St.set(!1)}),Ae(()=>(m(),t(F)),()=>{m()?Tt(m()):(t(F)&&E(F,null),E(Le,!1),ze())}),Ae(()=>(v(),d(),r(),t($)),()=>{v()||d().active||r()?t($)||E($,requestAnimationFrame(st)):t($)&&(cancelAnimationFrame(t($)),E($,null),E(Q,0))}),xn(),Nt();var et=cs(),at=I(et);Fn(at,_=>E(c,_),()=>t(c));var He=S(at,2);{var Ut=_=>{var P=os(),Y=I(P);C(P),Ee(X=>Ce(Y,`Speed: ${X??""}¬∞/s`),[()=>(l(),De(()=>l().toFixed(0)))]),T(_,P)};se(He,_=>{t(ue)&&_(Ut)})}var It=S(He,2);{var Ct=_=>{var P=ls();T(_,P)};se(It,_=>{r()&&_(Ct)})}C(et),Fn(et,_=>E(s,_),()=>t(s)),Ee(()=>Ot(et,1,`canvas-wrapper ${r()?"edit-mode":""}`,"svelte-byh4af")),T(e,et),Et(),u()}async function ds(e,a,r={}){const{x:v,y:m,r:o}=a||{x:e.width/2,y:e.height/2,r:Math.min(e.width,e.height)/2},l=r.samples||720,d=r.innerOffset||-Math.max(2,Math.round(o*.06)),M=r.outerOffset||Math.max(2,Math.round(o*.06)),p=r.thresholdFactor||.6,i=document.createElement("canvas");i.width=e.width,i.height=e.height;const g=i.getContext("2d");g.drawImage(e,0,0);const h=g.getImageData(0,0,i.width,i.height).data,y=i.width,b=i.height;function w(A,$){const Q=Math.round(A),de=Math.round($);if(Q<0||Q>=y||de<0||de>=b)return 0;const _e=(de*y+Q)*4,ue=h[_e],te=h[_e+1],Te=h[_e+2];return .2126*ue+.7152*te+.0722*Te}const u=new Array(l);for(let A=0;A<l;A++){const $=A/l*Math.PI*2,Q=[],de=3;for(let ue=0;ue<de;ue++){const te=ue/(de-1),Te=o+d+(M-d)*te,L=v+Te*Math.cos($),Oe=m+Te*Math.sin($);Q.push(w(L,Oe))}const _e=Q.reduce((ue,te)=>ue+te,0)/Q.length;u[A]=_e}const s=u.reduce((A,$)=>A+$,0)/u.length,c=Math.sqrt(u.reduce((A,$)=>A+($-s)**2,0)/u.length),n=s+c*p,D=u.map(A=>A>n);let k=0,B=!1,G=[],W=0;for(let A=0;A<D.length*2;A++){const $=A%D.length;if(D[$]?(W++,B=!0):(B&&(G.push(W),W=0),B=!1),A>=D.length&&!B)break}B&&W>0&&G.push(W);const H=Math.max(2,Math.round(l/360*(r.minDegrees||5))),z=G.filter(A=>A>=H);k=z.length;const ge=[];let me=0;for(const A of G){const $=me%l,Q=(me+A-1)%l,de=($+Math.floor(A/2))%l;ge.push({start:$,end:Q,mid:de,angle:de/l*2*Math.PI}),me+=A+1}return{count:k,samples:u,mask:D,groups:z,positions:ge,canvas:i}}function us(e,a=24,r={}){const v=[],{width:m,height:o}=e,l=r.circle||{x:m/2,y:o/2,r:Math.min(m,o)/2},d=Math.round(l.r*2),M=r.margin??1.05,p=r.outputSize||Math.max(32,Math.round(d*M)),i=r.fps||24,g=typeof r.rotationSpeed=="number"?r.rotationSpeed:0,h=r.direction==null?1:r.direction,y=document.createElement("canvas");y.width=d,y.height=d;const b=y.getContext("2d"),w=Math.round(l.x-l.r),u=Math.round(l.y-l.r);try{b.drawImage(e,w,u,d,d,0,0,d,d)}catch{b.drawImage(e,0,0)}b.globalCompositeOperation="destination-in",b.beginPath(),b.arc(d/2,d/2,d/2,0,Math.PI*2),b.fillStyle="black",b.fill(),b.globalCompositeOperation="source-over";const c=g/i*Math.PI/180*h;Math.round(d*(r.zoom||1));for(let n=0;n<a;n++){const D=n*c,k=document.createElement("canvas");k.width=p,k.height=p;const B=k.getContext("2d");B.translate(p/2,p/2),B.rotate(D);const G=Math.round(d*(r.zoom||1)),W=G;B.drawImage(y,-G/2,-W/2,G,W),v.push(k)}return v}function vs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function Rt(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var un={exports:{}},Nn;function hs(){return Nn||(Nn=1,(function(e,a){(function(r){e.exports=r()})(function(){return(function r(v,m,o){function l(p,i){if(!m[p]){if(!v[p]){var g=typeof Rt=="function"&&Rt;if(!i&&g)return g(p,!0);if(d)return d(p,!0);var h=new Error("Cannot find module '"+p+"'");throw h.code="MODULE_NOT_FOUND",h}var y=m[p]={exports:{}};v[p][0].call(y.exports,function(b){var w=v[p][1][b];return l(w||b)},y,y.exports,r,v,m,o)}return m[p].exports}for(var d=typeof Rt=="function"&&Rt,M=0;M<o.length;M++)l(o[M]);return l})({1:[function(r,v,m){function o(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}v.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.prototype.setMaxListeners=function(i){if(!d(i)||i<0||isNaN(i))throw TypeError("n must be a positive number");return this._maxListeners=i,this},o.prototype.emit=function(i){var g,h,y,b,w,u;if(this._events||(this._events={}),i==="error"&&(!this._events.error||M(this._events.error)&&!this._events.error.length)){if(g=arguments[1],g instanceof Error)throw g;var s=new Error('Uncaught, unspecified "error" event. ('+g+")");throw s.context=g,s}if(h=this._events[i],p(h))return!1;if(l(h))switch(arguments.length){case 1:h.call(this);break;case 2:h.call(this,arguments[1]);break;case 3:h.call(this,arguments[1],arguments[2]);break;default:b=Array.prototype.slice.call(arguments,1),h.apply(this,b)}else if(M(h))for(b=Array.prototype.slice.call(arguments,1),u=h.slice(),y=u.length,w=0;w<y;w++)u[w].apply(this,b);return!0},o.prototype.addListener=function(i,g){var h;if(!l(g))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",i,l(g.listener)?g.listener:g),this._events[i]?M(this._events[i])?this._events[i].push(g):this._events[i]=[this._events[i],g]:this._events[i]=g,M(this._events[i])&&!this._events[i].warned&&(p(this._maxListeners)?h=o.defaultMaxListeners:h=this._maxListeners,h&&h>0&&this._events[i].length>h&&(this._events[i].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[i].length),typeof console.trace=="function"&&console.trace())),this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(i,g){if(!l(g))throw TypeError("listener must be a function");var h=!1;function y(){this.removeListener(i,y),h||(h=!0,g.apply(this,arguments))}return y.listener=g,this.on(i,y),this},o.prototype.removeListener=function(i,g){var h,y,b,w;if(!l(g))throw TypeError("listener must be a function");if(!this._events||!this._events[i])return this;if(h=this._events[i],b=h.length,y=-1,h===g||l(h.listener)&&h.listener===g)delete this._events[i],this._events.removeListener&&this.emit("removeListener",i,g);else if(M(h)){for(w=b;w-- >0;)if(h[w]===g||h[w].listener&&h[w].listener===g){y=w;break}if(y<0)return this;h.length===1?(h.length=0,delete this._events[i]):h.splice(y,1),this._events.removeListener&&this.emit("removeListener",i,g)}return this},o.prototype.removeAllListeners=function(i){var g,h;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[i]&&delete this._events[i],this;if(arguments.length===0){for(g in this._events)g!=="removeListener"&&this.removeAllListeners(g);return this.removeAllListeners("removeListener"),this._events={},this}if(h=this._events[i],l(h))this.removeListener(i,h);else if(h)for(;h.length;)this.removeListener(i,h[h.length-1]);return delete this._events[i],this},o.prototype.listeners=function(i){var g;return!this._events||!this._events[i]?g=[]:l(this._events[i])?g=[this._events[i]]:g=this._events[i].slice(),g},o.prototype.listenerCount=function(i){if(this._events){var g=this._events[i];if(l(g))return 1;if(g)return g.length}return 0},o.listenerCount=function(i,g){return i.listenerCount(g)};function l(i){return typeof i=="function"}function d(i){return typeof i=="number"}function M(i){return typeof i=="object"&&i!==null}function p(i){return i===void 0}},{}],2:[function(r,v,m){var o,l,d,M,p;p=navigator.userAgent.toLowerCase(),M=navigator.platform.toLowerCase(),o=p.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0],d=o[1]==="ie"&&document.documentMode,l={name:o[1]==="version"?o[3]:o[1],version:d||parseFloat(o[1]==="opera"&&o[4]?o[4]:o[2]),platform:{name:p.match(/ip(?:ad|od|hone)/)?"ios":(p.match(/(?:webos|android)/)||M.match(/mac|win|linux/)||["other"])[0]}},l[l.name]=!0,l[l.name+parseInt(l.version,10)]=!0,l.platform[l.platform.name]=!0,v.exports=l},{}],3:[function(r,v,m){var o,l,d,M=function(h,y){for(var b in y)p.call(y,b)&&(h[b]=y[b]);function w(){this.constructor=h}return w.prototype=y.prototype,h.prototype=new w,h.__super__=y.prototype,h},p={}.hasOwnProperty,i=[].indexOf||function(h){for(var y=0,b=this.length;y<b;y++)if(y in this&&this[y]===h)return y;return-1},g=[].slice;o=r("events").EventEmitter,d=r("./browser.coffee"),l=(function(h){var y,b;M(w,h),y={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},b={delay:500,copy:!1};function w(u){var s,c,n;this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(u);for(c in y)n=y[c],(s=this.options)[c]==null&&(s[c]=n)}return w.prototype.setOption=function(u,s){if(this.options[u]=s,this._canvas!=null&&(u==="width"||u==="height"))return this._canvas[u]=s},w.prototype.setOptions=function(u){var s,c,n;c=[];for(s in u)p.call(u,s)&&(n=u[s],c.push(this.setOption(s,n)));return c},w.prototype.addFrame=function(u,s){var c,n;s==null&&(s={}),c={},c.transparent=this.options.transparent;for(n in b)c[n]=s[n]||b[n];if(this.options.width==null&&this.setOption("width",u.width),this.options.height==null&&this.setOption("height",u.height),typeof ImageData<"u"&&ImageData!==null&&u instanceof ImageData)c.data=u.data;else if(typeof CanvasRenderingContext2D<"u"&&CanvasRenderingContext2D!==null&&u instanceof CanvasRenderingContext2D||typeof WebGLRenderingContext<"u"&&WebGLRenderingContext!==null&&u instanceof WebGLRenderingContext)s.copy?c.data=this.getContextData(u):c.context=u;else if(u.childNodes!=null)s.copy?c.data=this.getImageData(u):c.image=u;else throw new Error("Invalid image");return this.frames.push(c)},w.prototype.render=function(){var u,s,c;if(this.running)throw new Error("Already running");if(this.options.width==null||this.options.height==null)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=(function(){var n,D,k;for(k=[],n=0,D=this.frames.length;0<=D?n<D:n>D;0<=D?++n:--n)k.push(null);return k}).call(this),s=this.spawnWorkers(),this.options.globalPalette===!0)this.renderNextFrame();else for(u=0,c=s;0<=c?u<c:u>c;0<=c?++u:--u)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},w.prototype.abort=function(){for(var u;u=this.activeWorkers.shift(),u!=null;)this.log("killing active worker"),u.terminate();return this.running=!1,this.emit("abort")},w.prototype.spawnWorkers=function(){var u,s,c;return u=Math.min(this.options.workers,this.frames.length),(function(){c=[];for(var n=s=this.freeWorkers.length;s<=u?n<u:n>u;s<=u?n++:n--)c.push(n);return c}).apply(this).forEach((function(n){return function(D){var k;return n.log("spawning worker "+D),k=new Worker(n.options.workerScript),k.onmessage=function(B){return n.activeWorkers.splice(n.activeWorkers.indexOf(k),1),n.freeWorkers.push(k),n.frameFinished(B.data)},n.freeWorkers.push(k)}})(this)),u},w.prototype.frameFinished=function(u){var s,c;if(this.log("frame "+u.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[u.index]=u,this.options.globalPalette===!0&&(this.options.globalPalette=u.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(s=1,c=this.freeWorkers.length;1<=c?s<c:s>c;1<=c?++s:--s)this.renderNextFrame();return i.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},w.prototype.finishRendering=function(){var u,s,c,n,D,k,B,G,W,H,z,ge,me,A,$,Q;for(G=0,A=this.imageParts,D=0,W=A.length;D<W;D++)s=A[D],G+=(s.data.length-1)*s.pageSize+s.cursor;for(G+=s.pageSize-s.cursor,this.log("rendering finished - filesize "+Math.round(G/1e3)+"kb"),u=new Uint8Array(G),ge=0,$=this.imageParts,k=0,H=$.length;k<H;k++)for(s=$[k],Q=s.data,c=B=0,z=Q.length;B<z;c=++B)me=Q[c],u.set(me,ge),c===s.data.length-1?ge+=s.cursor:ge+=s.pageSize;return n=new Blob([u],{type:"image/gif"}),this.emit("finished",n,u)},w.prototype.renderNextFrame=function(){var u,s,c;if(this.freeWorkers.length===0)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return u=this.frames[this.nextFrame++],c=this.freeWorkers.shift(),s=this.getTask(u),this.log("starting frame "+(s.index+1)+" of "+this.frames.length),this.activeWorkers.push(c),c.postMessage(s)},w.prototype.getContextData=function(u){return u.getImageData(0,0,this.options.width,this.options.height).data},w.prototype.getImageData=function(u){var s;return this._canvas==null&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),s=this._canvas.getContext("2d"),s.setFill=this.options.background,s.fillRect(0,0,this.options.width,this.options.height),s.drawImage(u,0,0),this.getContextData(s)},w.prototype.getTask=function(u){var s,c;if(s=this.frames.indexOf(u),c={index:s,last:s===this.frames.length-1,delay:u.delay,transparent:u.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:d.name==="chrome"},u.data!=null)c.data=u.data;else if(u.context!=null)c.data=this.getContextData(u.context);else if(u.image!=null)c.data=this.getImageData(u.image);else throw new Error("Invalid frame");return c},w.prototype.log=function(){var u;if(u=1<=arguments.length?g.call(arguments,0):[],!!this.options.debug)return console.log.apply(console,u)},w})(o),v.exports=l},{"./browser.coffee":2,events:1}]},{},[3])(3)})})(un)),un.exports}var ps=hs();const gs=vs(ps),ms=""+new URL("../assets/gif.worker.CjkyQP34.js",import.meta.url).href;async function _s(e,a=24){if(!e||e.length===0)throw new Error("No frames to export");const r=new gs({workers:2,quality:10,width:e[0].width,height:e[0].height,workerScript:ms,repeat:0,background:null}),v=Math.round(1e3/a);for(const m of e){const o=m.width,l=m.height,d=document.createElement("canvas");d.width=o,d.height=l;const M=d.getContext("2d");M.fillStyle="#ffffff",M.fillRect(0,0,o,l),M.drawImage(m,0,0),r.addFrame(d,{delay:v,copy:!0})}return new Promise((m,o)=>{r.on("finished",function(l){const d=URL.createObjectURL(l);m(d)}),r.on("error",o),r.render()})}var ys=fe('<div class="export-overlay svelte-14nyow8" role="status" aria-live="polite"><div class="export-box svelte-14nyow8"><div class="spinner svelte-14nyow8" aria-hidden="true"></div> <div class="export-text svelte-14nyow8">Working‚Ä¶ Exporting GIF ‚Äî please wait</div></div></div>'),ws=fe('<button class="confirm-btn svelte-14nyow8">Confirm Detection</button> <button class="svelte-14nyow8">Cancel</button>',1),bs=fe("<button>Detect Circle & Count</button>"),xs=fe('<span style="background: #4a9eff; color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.75em; font-weight: bold; margin-left: 4px;" class="svelte-14nyow8"> </span>'),Ms=fe('<div style="margin-top: 16px; padding: 12px; background: rgba(74, 158, 255, 0.08); border-radius: 6px; border: 1px solid rgba(74, 158, 255, 0.2);" class="svelte-14nyow8"><div style="font-weight: 600; margin-bottom: 10px; color: #4a9eff; font-size: 0.95em;" class="svelte-14nyow8">‚ö° Flicker Fusion Threshold</div> <div style="margin-bottom: 12px;" class="svelte-14nyow8"><div style="font-size: 0.85em; color: #aaa; margin-bottom: 6px;" class="svelte-14nyow8">Quick Presets:</div> <div style="display: flex; gap: 6px; flex-wrap: wrap;" class="svelte-14nyow8"><button class="svelte-14nyow8">42 Hz</button> <button class="svelte-14nyow8">50 Hz</button> <button class="svelte-14nyow8">55 Hz</button> <button class="svelte-14nyow8">60 Hz</button> <button class="svelte-14nyow8">70 Hz</button></div></div> <div style="margin-top: 12px;" class="svelte-14nyow8"><div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px;" class="svelte-14nyow8"><span style="font-size: 0.85em; color: #ccc;" class="svelte-14nyow8">Fine Tune:</span> <span style="font-size: 1.1em; font-weight: bold; color: #4a9eff;" class="svelte-14nyow8"> </span></div> <input type="range" min="40" max="70" step="0.5" style="width: 100%; cursor: pointer;" class="svelte-14nyow8"/> <div style="display: flex; justify-content: space-between; font-size: 0.7em; color: #666; margin-top: 4px;" class="svelte-14nyow8"><span class="svelte-14nyow8">40 Hz</span> <span style="color: #4a9eff; font-weight: 500;" class="svelte-14nyow8"><!></span> <span class="svelte-14nyow8">70 Hz</span></div></div> <div style="margin-top: 10px; padding: 8px; background: rgba(74, 158, 255, 0.12); border-radius: 4px; font-size: 0.8em;" class="svelte-14nyow8"><div style="font-weight: 500; color: #4a9eff; margin-bottom: 3px;" class="svelte-14nyow8"><!></div> <div style="color: #aaa; font-size: 0.9em;" class="svelte-14nyow8"><!></div></div></div>'),ks=fe('<div class="drag-handle svelte-14nyow8" title="Drag to move"></div>'),Ss=fe('<div><!> <div style="display:flex;gap:12px;align-items:center;" class="svelte-14nyow8"><button class="speed-btn svelte-14nyow8">‚àí</button> <div style="text-align:center;min-width:120px;" class="svelte-14nyow8"><div class="speed-display svelte-14nyow8"> </div> <div style="font-size:11px;opacity:0.6;margin-top:4px;" class="svelte-14nyow8">Rotation Speed</div></div> <button class="speed-btn svelte-14nyow8">+</button></div></div>'),Ps=fe('<em style="font-size:12px;opacity:0.7;" class="svelte-14nyow8">(Use +/‚àí buttons above to adjust speed)</em>'),Es=fe('<em style="font-size:12px;opacity:0.7;" class="svelte-14nyow8">(Touch: drag up to speed up, down to slow down)</em>'),Ts=fe('<div class="svelte-14nyow8"><strong class="svelte-14nyow8">Circle:</strong> </div>'),Is=fe('<div class="panel svelte-14nyow8"><!> <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;" class="svelte-14nyow8"><button> </button> <button class="svelte-14nyow8">Reverse</button> <!> <button class="svelte-14nyow8">Apply Suggested Speed</button> <button class="svelte-14nyow8"> </button> <label style="display:flex;align-items:center;gap:6px;" class="svelte-14nyow8"><span style="font-size:12px;opacity:0.8;" class="svelte-14nyow8">Frames:</span> <input type="number" min="6" step="1" style="width:80px;padding:4px;border-radius:4px;border:1px solid #ccc;" class="svelte-14nyow8"/> <span style="font-size:11px;opacity:0.6;" title="Leave empty for auto-detection" class="svelte-14nyow8"><!></span></label> <label style="display:flex;align-items:center;gap:6px;" class="svelte-14nyow8"><span style="font-size:12px;opacity:0.8;" class="svelte-14nyow8">FPS:</span> <select style="padding:4px;border-radius:4px;border:1px solid #ccc;background:#333;color:white;" class="svelte-14nyow8"><option class="svelte-14nyow8">24 (Cinema)</option><option class="svelte-14nyow8">30 (Smooth)</option><option class="svelte-14nyow8">60 (Ultra)</option></select></label> <label style="display:flex;align-items:center;gap:6px;margin-left:6px;" class="svelte-14nyow8"><input type="checkbox" class="svelte-14nyow8"/> <span class="svelte-14nyow8">Show Overlay</span></label> <label style="display:flex;align-items:center;gap:6px;margin-left:6px;" class="svelte-14nyow8"><input type="checkbox" class="svelte-14nyow8"/> <span class="svelte-14nyow8">Flicker Effect</span> <!></label></div> <!> <!> <div style="margin-top:12px;" class="svelte-14nyow8"><div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;" class="svelte-14nyow8"><div class="svelte-14nyow8"><strong class="svelte-14nyow8">Current Speed:</strong> <!></div> <div style="display:flex;gap:6px;align-items:center;" class="svelte-14nyow8"><label for="manual-speed-input" style="font-size:12px;" class="svelte-14nyow8">Type speed:</label> <input id="manual-speed-input" type="number" min="1" step="1" style="width:100px;padding:6px;border-radius:4px;border:1px solid #ccc;" class="svelte-14nyow8"/> <button class="svelte-14nyow8">Set</button></div></div> <div class="svelte-14nyow8"><strong class="svelte-14nyow8">Detected count:</strong> </div> <div class="svelte-14nyow8"><strong class="svelte-14nyow8">Suggested speed:</strong> </div> <!></div></div>');function Cs(e,a){Pt(a,!1);const r=()=>Z(ft,"$imageUrl",w),v=()=>Z(mn,"$canvasTransform",w),m=()=>Z(dt,"$isPlaying",w),o=()=>Z(_n,"$playerCanvas",w),l=()=>Z(Qe,"$rotationSpeed",w),d=()=>Z(pn,"$detectedCircle",w),M=()=>Z(Wn,"$detectedCount",w),p=()=>Z(dn,"$suggestedRotationSpeed",w),i=()=>Z(gn,"$overlayVisible",w),g=()=>Z(ct,"$editMode",w),h=()=>Z(yn,"$flickerEnabled",w),y=()=>Z(Ke,"$flickerFrequency",w),b=()=>Z(wn,"$isMobile",w),[w,u]=kn(),s=ee(),c=ee(),n=ee(),D=ee();let k=ee(!1);async function B(){dt.update(f=>!f)}function G(){Qe.update(f=>Math.min(1e4,f+60))}function W(){Qe.update(f=>Math.max(10,f-60))}function H(){hn.update(f=>f*-1)}async function z(){if(!r())return;const x=Date.now();Mt.set({active:!0,progress:0,startTime:x}),ct.set(!0)}async function ge(){const f=r();if(!f)return;E(k,!0);const x=v();ct.set(!1);const N=Date.now();Mt.set({active:!0,progress:0,startTime:N}),m()||requestAnimationFrame(()=>{});try{const O=await gt(f);let J=null;const re=o();if(re){const we=re.clientWidth,Ze=re.clientHeight,ot=O.width/O.height,$t=we/Ze;let mt,Dt;ot>$t?(mt=we,Dt=we/ot):(Dt=Ze,mt=Ze*ot);const Vt=-x.translateX,At=-x.translateY,_t=Vt/x.scale,Bt=At/x.scale,Lt=O.width/mt,Jt=_t*Lt+O.width/2,Ft=Bt*Lt+O.height/2;J={x:Jt,y:Ft,r:Math.min(O.width,O.height)/2*.9}}J||(J={x:O.width/2,y:O.height/2,r:Math.min(O.width,O.height)/2*.9});const oe=await ds(O,J,{samples:720}),Ue=2e3-(Date.now()-N);Ue>0&&await new Promise(we=>setTimeout(we,Ue)),pn.set(J),Wn.set(oe.count),Bn.set(oe.positions||[]);const Je=(oe.count>0?360/oe.count:1)*30;dn.set(Je),Mt.set({active:!1,progress:1,startTime:N}),St.set(!0)}finally{E(k,!1)}}function me(){dn.subscribe(f=>{f&&Qe.set(f)})()}function A(){ct.set(!1),St.set(!1),Mt.set({active:!1,progress:0,startTime:0})}let $=ee(0);function Q(){const f=Number(t($))||0;f<=0||Qe.set(f)}let de=ee(!1),_e=ee(30);async function ue(){const f=r()||on(ft);if(!f)return alert("No image loaded to export.");if(!t(s))return alert("Please detect the circle before exporting the GIF.");const x=await gt(f),N=document.createElement("canvas");N.width=x.width,N.height=x.height,N.getContext("2d").drawImage(x,0,0,x.width,x.height),E(de,!0);try{let J;t(te)&&t(te)!==t(c)*2?J=t(te):t(c)&&t(c)>0?J=Math.max(12,t(c)*2):J=t(te)||24;const re=t(s),oe=re.r*2*1.1,Se=Math.min(480,Math.round(oe)),Ue=Number(on(Qe)||0),Be=Number(on(hn)||1),Pe=us(N,J,{circle:re,outputSize:Se,margin:1.05,zoom:1,fps:t(_e),rotationSpeed:Ue,direction:Be}),Je=await _s(Pe,t(_e)),we=document.createElement("a");we.href=Je,we.download="phenaki-export.gif",document.body.appendChild(we),we.click(),we.remove()}catch(J){console.error("GIF export failed",J),alert("GIF export failed: "+(J&&J.message))}finally{E(de,!1)}}let te=ee(null);const Te="phenaki.speedControlPos";let L=ee({left:null,top:null}),Oe=ee(!1),F=ee(!1),Le={x:0,y:0},Fe={left:0,top:0},Tt=0;function ut(){try{const f=localStorage.getItem(Te);f&&E(L,JSON.parse(f))}catch{}}function vt(){try{localStorage.setItem(Te,JSON.stringify(t(L)))}catch{}}function rt(f){const x=Date.now(),N=x-Tt<300;if(Tt=x,f.target&&f.target.closest&&f.target.closest("button"))return;const O=f.target&&f.target.closest&&f.target.closest(".drag-handle");if(!(!N&&!O)){E(Oe,!0),E(F,!0),Le={x:f.clientX,y:f.clientY},Fe={left:t(L).left??Math.round((window.innerWidth-200)/2),top:t(L).top??Math.round((window.innerHeight-80)/2)};try{f.target.setPointerCapture(f.pointerId)}catch{}window.addEventListener("pointermove",ht),window.addEventListener("pointerup",pt)}}function ht(f){if(!t(F))return;const x=f.clientX-Le.x,N=f.clientY-Le.y;ae(L,t(L).left=Math.round(Fe.left+x)),ae(L,t(L).top=Math.round(Fe.top+N))}function pt(f){E(F,!1),E(Oe,!1);try{f.target.releasePointerCapture&&f.target.releasePointerCapture(f.pointerId)}catch{}window.removeEventListener("pointermove",ht),window.removeEventListener("pointerup",pt),vt()}Mn(()=>{ut(),t(L).left==null&&ae(L,t(L).left=Math.round((window.innerWidth-200)/2)),t(L).top==null&&ae(L,t(L).top=Math.round((window.innerHeight-80)/2));function f(){const oe=Math.max(8,window.innerWidth-200-8),Se=Math.max(8,window.innerHeight-80-8);t(L).left==null&&ae(L,t(L).left=oe),t(L).top==null&&ae(L,t(L).top=Se),ae(L,t(L).left=Math.min(Math.max(t(L).left,8),oe)),ae(L,t(L).top=Math.min(Math.max(t(L).top,8),Se))}f();const x=()=>{f(),vt()};return window.addEventListener("resize",x),()=>window.removeEventListener("resize",x)});function gt(f){return new Promise((x,N)=>{const O=new Image;O.crossOrigin="anonymous",O.onload=()=>x(O),O.onerror=N,O.src=f})}Ae(()=>l(),()=>{E($,Number(l()||0))}),Ae(()=>d(),()=>{E(s,d())}),Ae(()=>M(),()=>{E(c,M())}),Ae(()=>p(),()=>{E(n,p())}),Ae(()=>i(),()=>{E(D,i())}),xn(),Nt();var st=Is(),ze=I(st);{var et=f=>{var x=ys();T(f,x)};se(ze,f=>{t(de)&&f(et)})}var at=S(ze,2),He=I(at),Ut=I(He,!0);C(He);var It=S(He,2),Ct=S(It,2);{var _=f=>{var x=ws(),N=Re(x),O=S(N,2);Ee(()=>N.disabled=t(k)),ce("click",N,ge),ce("click",O,A),T(f,x)},P=f=>{var x=bs();Ee(()=>{Ot(x,1,zn(t(s)?"":"detect-btn-required"),"svelte-14nyow8"),x.disabled=t(k)||!r()}),ce("click",x,z),T(f,x)};se(Ct,f=>{g()?f(_):f(P,!1)})}var Y=S(Ct,2),X=S(Y,2),ne=I(X,!0);C(X);var K=S(X,2),Ie=S(I(K),2);xt(Ie);var Ye=S(Ie,2),Xe=I(Ye);{var tt=f=>{var x=pe("Manual");T(f,x)},R=f=>{var x=Ge(),N=Re(x);{var O=re=>{var oe=pe("Auto (x2)");T(re,oe)},J=re=>{var oe=pe("Auto");T(re,oe)};se(N,re=>{t(c)?re(O):re(J,!1)},!0)}T(f,x)};se(Xe,f=>{t(te)?f(tt):f(R,!1)})}C(Ye),C(K);var q=S(K,2),j=S(I(q),2);Ee(()=>{t(_e),Wr(()=>{})});var U=I(j);U.value=U.__value=24;var V=S(U);V.value=V.__value=30;var he=S(V);he.value=he.__value=60,C(j),C(q);var Ve=S(q,2),We=I(Ve);xt(We),an(2),C(Ve);var it=S(Ve,2),Ne=I(it);xt(Ne);var jt=S(Ne,4);{var Jn=f=>{var x=xs(),N=I(x);C(x),Ee(()=>Ce(N,`${y()??""} Hz`)),T(f,x)};se(jt,f=>{h()&&f(Jn)})}C(it),C(at);var En=S(at,2);{var Zn=f=>{var x=Ms(),N=S(I(x),2),O=S(I(N),2),J=I(O),re=S(J,2),oe=S(re,2),Se=S(oe,2),Ue=S(Se,2);C(O),C(N);var Be=S(N,2),Pe=I(Be),Je=S(I(Pe),2),we=I(Je);C(Je),C(Pe);var Ze=S(Pe,2);xt(Ze);var ot=S(Ze,2),$t=S(I(ot),2),mt=I($t);{var Dt=ie=>{var ye=pe("üî¥ Visible");T(ie,ye)},Vt=ie=>{var ye=Ge(),yt=Re(ye);{var wt=le=>{var be=pe("üü° Fusion");T(le,be)},bt=le=>{var be=pe("üü¢ Smooth");T(le,be)};se(yt,le=>{y()<58?le(wt):le(bt,!1)},!0)}T(ie,ye)};se(mt,ie=>{y()<48?ie(Dt):ie(Vt,!1)})}C($t),an(2),C(ot),C(Be);var At=S(Be,2),_t=I(At),Bt=I(_t);{var Lt=ie=>{var ye=pe("‚ö° Strong Flicker");T(ie,ye)},Jt=ie=>{var ye=Ge(),yt=Re(ye);{var wt=le=>{var be=pe("üéØ Critical Threshold");T(le,be)},bt=le=>{var be=Ge(),Zt=Re(be);{var Kt=xe=>{var je=pe("‚ú® Near-Fusion");T(xe,je)},Qt=xe=>{var je=Ge(),en=Re(je);{var tn=Me=>{var nt=pe("üé¨ Cinema (60 Hz)");T(Me,nt)},nn=Me=>{var nt=pe("üåü Ultra Smooth");T(Me,nt)};se(en,Me=>{y()<62?Me(tn):Me(nn,!1)},!0)}T(xe,je)};se(Zt,xe=>{y()<58?xe(Kt):xe(Qt,!1)},!0)}T(le,be)};se(yt,le=>{y()<52?le(wt):le(bt,!1)},!0)}T(ie,ye)};se(Bt,ie=>{y()<48?ie(Lt):ie(Jt,!1)})}C(_t);var Ft=S(_t,2),or=I(Ft);{var lr=ie=>{var ye=pe("Noticeable flicker - classic phenakistoscope effect");T(ie,ye)},cr=ie=>{var ye=Ge(),yt=Re(ye);{var wt=le=>{var be=pe("Flicker begins to fuse - critical threshold");T(le,be)},bt=le=>{var be=Ge(),Zt=Re(be);{var Kt=xe=>{var je=pe("Subtle pulsing - artistic sweet spot");T(xe,je)},Qt=xe=>{var je=Ge(),en=Re(je);{var tn=Me=>{var nt=pe("Standard cinema/TV rate - minimal flicker");T(Me,nt)},nn=Me=>{var nt=pe("Above fusion threshold - very smooth");T(Me,nt)};se(en,Me=>{y()<62?Me(tn):Me(nn,!1)},!0)}T(xe,je)};se(Zt,xe=>{y()<58?xe(Kt):xe(Qt,!1)},!0)}T(le,be)};se(yt,le=>{y()<52?le(wt):le(bt,!1)},!0)}T(ie,ye)};se(or,ie=>{y()<48?ie(lr):ie(cr,!1)})}C(Ft),C(At),C(x),Ee(()=>{lt(J,`padding: 6px 10px; border: 1px solid ${y()===42?"#ff6b6b":"#555"}; background: ${y()===42?"#ff6b6b":"#333"}; color: white; border-radius: 4px; cursor: pointer; font-size: 0.8em;`),lt(re,`padding: 6px 10px; border: 1px solid ${y()===50?"#ffa500":"#555"}; background: ${y()===50?"#ffa500":"#333"}; color: white; border-radius: 4px; cursor: pointer; font-size: 0.8em;`),lt(oe,`padding: 6px 10px; border: 1px solid ${y()===55?"#4a9eff":"#555"}; background: ${y()===55?"#4a9eff":"#333"}; color: white; border-radius: 4px; cursor: pointer; font-size: 0.8em;`),lt(Se,`padding: 6px 10px; border: 1px solid ${y()===60?"#51cf66":"#555"}; background: ${y()===60?"#51cf66":"#333"}; color: white; border-radius: 4px; cursor: pointer; font-size: 0.8em;`),lt(Ue,`padding: 6px 10px; border: 1px solid ${y()===70?"#845ef7":"#555"}; background: ${y()===70?"#845ef7":"#333"}; color: white; border-radius: 4px; cursor: pointer; font-size: 0.8em;`),Ce(we,`${y()??""} Hz`),Qr(Ze,y())}),ce("click",J,()=>Ke.set(42)),ce("click",re,()=>Ke.set(50)),ce("click",oe,()=>Ke.set(55)),ce("click",Se,()=>Ke.set(60)),ce("click",Ue,()=>Ke.set(70)),ce("input",Ze,ie=>Ke.set(+ie.target.value)),T(f,x)};se(En,f=>{h()&&f(Zn)})}var Tn=S(En,2);{var Kn=f=>{var x=Ss(),N=I(x);{var O=Pe=>{var Je=ks();T(Pe,Je)};se(N,Pe=>{t(Oe)&&Pe(O)})}var J=S(N,2),re=I(J),oe=S(re,2),Se=I(oe),Ue=I(Se);C(Se),an(2),C(oe);var Be=S(oe,2);C(J),C(x),Ee(Pe=>{Ot(x,1,`speed-control ${t(Oe)?"dragMode":""} ${t(F)?"dragging":""}`,"svelte-14nyow8"),lt(x,`left: ${t(L),De(()=>t(L).left??16)??""}px; top: ${t(L),De(()=>t(L).top??16)??""}px;`),Ce(Ue,`${Pe??""}¬∞/s`)},[()=>(l(),De(()=>l().toFixed(0)))]),ce("click",re,W),ce("click",Be,G),ce("pointerdown",x,rt),T(f,x)};se(Tn,f=>{d()&&f(Kn)})}var In=S(Tn,2),Gt=I(In),qt=I(Gt),Cn=S(I(qt)),Qn=S(Cn);{var er=f=>{var x=Ps();T(f,x)},tr=f=>{var x=Es();T(f,x)};se(Qn,f=>{b()?f(er):f(tr,!1)})}C(qt);var $n=S(qt,2),Ht=S(I($n),2);xt(Ht);var nr=S(Ht,2);C($n),C(Gt);var Yt=S(Gt,2),rr=S(I(Yt));C(Yt);var Xt=S(Yt,2),sr=S(I(Xt));C(Xt);var ar=S(Xt,2);{var ir=f=>{var x=Ts(),N=S(I(x));C(x),Ee((O,J,re)=>Ce(N,` x=${O??""}, y=${J??""}, r=${re??""}`),[()=>(t(s),De(()=>Math.round(t(s).x))),()=>(t(s),De(()=>Math.round(t(s).y))),()=>(t(s),De(()=>Math.round(t(s).r)))]),T(f,x)};se(ar,f=>{t(s)&&f(ir)})}C(In),C(st),Ee((f,x)=>{Ot(He,1,zn(t(s)&&!m()?"play-highlight":""),"svelte-14nyow8"),Ce(Ut,m()?"Pause":"Play"),Y.disabled=!t(n),X.disabled=t(de)||!o(),Ce(ne,t(de)?"Exporting...":"Save GIF"),Wt(Ie,"placeholder",t(c)?`Auto (${t(c)*2})`:"Auto (24)"),es(We,t(D)),Ce(Cn,` ${f??""}¬∞/s | `),Ce(rr,` ${t(c)??0??""}`),Ce(sr,` ${x??""}¬∞/s`)},[()=>(l(),De(()=>l().toFixed(0))),()=>(t(n),De(()=>t(n)?t(n).toFixed(0):"‚Äî"))]),ce("click",He,B),ce("click",It,H),ce("click",Y,me),ce("click",X,ue),On(Ie,()=>t(te),f=>E(te,f)),Jr(j,()=>t(_e),f=>E(_e,f)),ce("change",We,f=>gn.set(f.target.checked)),ns(Ne,h,f=>Ur(yn,f)),On(Ht,()=>t($),f=>E($,f)),ce("click",nr,Q),T(e,st),Et(),u()}var $s=fe("<option> </option>"),Ds=fe('<div class="selector svelte-ai08gq"><label for="samples" class="svelte-ai08gq">Sample Images:</label> <select id="samples" class="svelte-ai08gq"><option>-- Choose a sample --</option><!></select></div>');function As(e,a){Pt(a,!1);const r="https://raw.githubusercontent.com/tclaret/phenakistoscope-simulator/main/images",v="https://raw.githubusercontent.com/tclaret/phenaki-lab/main/img",m=[{name:"Woman Chopping Tree",file:"WomanChoppingTree.jpg",repo:"old"},{name:"Dancing",file:"Dancing.jpg",repo:"old"},{name:"Jongleur",file:"Jongleur.png",repo:"old"},{name:"a_cheval",file:"a_cheval.png",repo:"old"},{name:"McLean_1",file:"McLean_1.png",repo:"old"},{name:"Gernamy_1949",file:"Gernamy_1949_R_Balzer.png",repo:"old"},{name:"AEO175939",file:"AEO175939_PhenakistoscopeGiroux60.jpg",repo:"old"},{name:"AEO185553",file:"AEO185553_PhenakistiscopeDisc_ManInBlueAndRed.jpg",repo:"old"},{name:"medium_1990_5036_3369",file:"medium_1990_5036_3369.jpg",repo:"old"},{name:"medium_a001813b",file:"medium_a001813b.jpg",repo:"old"},{name:"tumblr_obd6fh",file:"tumblr_obd6fhGFSZ1r9jbwno1_500.png",repo:"old"},{name:"tumblr_oc1cz",file:"tumblr_oc1czn99ZM1r9jbwno1_500.png",repo:"old"},{name:"Phantasmascope Faces",file:"Phantasmascope_faces.png",repo:"old"},{name:"722a6790240569.5e126845d9b56",file:"722a6790240569.5e126845d9b56.png",repo:"old"},{name:"Fantascope Disc 1833",file:"fantascope-disc-1833.png",repo:"old"},{name:"Face",file:"_face__.jpg",repo:"new"},{name:"Culbute",file:"culbute.jpg",repo:"new"},{name:"Grenouille",file:"Grenouille__.jpg",repo:"new"},{name:"Oh Soccer",file:"oh_soccer.jpg",repo:"new"},{name:"Un Grand Un Petit",file:"un_grand_un_petit.jpg",repo:"new"},{name:"Autre Culbutte",file:"autre_culbutte.jpg",repo:"new"},{name:"Dancing 2",file:"dancing_.jpg",repo:"new"},{name:"Il Pompe de l'eau",file:"il_pompe_de_leau.jpg",repo:"new"},{name:"Porceline",file:"porceline.jpg",repo:"new"},{name:"Volants",file:"volants_.png",repo:"new"},{name:"Ce Qui",file:"ce_qui.jpg",repo:"new"},{name:"Des Anges",file:"des_anges.jpg",repo:"new"},{name:"Moulin",file:"moulin_.jpg",repo:"new"},{name:"Rats",file:"rats__.jpg",repo:"new"},{name:"Corde √† Danser",file:"corde_a_denser_.jpg",repo:"new"},{name:"Ecureuil",file:"ecureuil.jpg",repo:"new"},{name:"Noel Noel",file:"noel_noel.jpg",repo:"new"},{name:"Tirreur",file:"tirreur_.jpg",repo:"new"},{name:"C Pastel",file:"c_pastel.jpg",repo:"new"},{name:"G√©om√©trique",file:"geometrique.jpg",repo:"new"},{name:"Nuages en Scie",file:"nuages_en_scie.jpg",repo:"new"},{name:"Tons Pastels",file:"tons_pastels.jpg",repo:"new"}];function o(i){const h=`${i.repo==="new"?v:r}/${i.file}`;ft.set(h),Pn.set(h),dt.set(!0)}Mn(()=>{let i=!1;if(ft.subscribe(h=>{h&&(i=!0)})(),!i){const h=m[Math.floor(Math.random()*m.length)];h&&o(h)}}),Nt();var l=Ds(),d=S(I(l),2),M=I(d);M.value=M.__value="";var p=S(M);Gr(p,1,()=>m,i=>i.file,(i,g)=>{var h=$s(),y=I(h,!0);C(h);var b={};Ee(()=>{Ce(y,t(g).name),b!==(b=t(g).file)&&(h.value=(h.__value=t(g).file)??"")}),T(i,h)}),C(d),C(l),ce("change",d,i=>{const g=i.target.selectedIndex-1;g>=0&&o(m[g])}),T(e,l),Et()}var Ls=fe('<div class="container svelte-1uha8ag"><h1 class="svelte-1uha8ag">Phenakistoscope Lab</h1> <p class="sub svelte-1uha8ag">Convert old phenakistoscope discs into animated GIFs</p> <!> <!> <!> <!> <!></div>');function js(e){var a=Ls(),r=S(I(a),4);ss(r,{});var v=S(r,2);As(v,{});var m=S(v,2);is(m,{});var o=S(m,2);fs(o,{});var l=S(o,2);Cs(l,{}),C(a),T(e,a)}export{js as component};
